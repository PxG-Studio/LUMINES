"use strict";(()=>{var e={};e.id=9575,e.ids=[9575],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},84984:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var t={};s.r(t),s.d(t,{POST:()=>c,PUT:()=>m});var o=s(49303),n=s(88716),a=s(60670),i=s(87070),u=s(91585),d=s(26033),l=s(17176),h=s(5110),p=s(93016);let f=u.Ry({refresh_token:u.Z_().min(1)});async function c(e){try{let r=await e.json(),s=f.parse(r),t=await (0,l.PZ)(s.refresh_token);if(!t)return i.NextResponse.json({error:"Invalid or expired refresh token"},{status:401});let o=await (0,h.SQ)(t.sub,t.roles||["user"],"15m");return p.k.info("Access token refreshed",{userId:t.sub,email:t.email}),i.NextResponse.json({access_token:o,expires_in:900,token_type:"Bearer",refresh_token:s.refresh_token,user:{id:t.sub,email:t.email,roles:t.roles||["user"]}})}catch(e){if(e instanceof d.jm)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Token refresh error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e){let r=(0,l.jl)(e);if(!r)return i.NextResponse.json({error:"Missing refresh token"},{status:401});let s=await (0,l.PZ)(r);if(!s)return i.NextResponse.json({error:"Invalid or expired refresh token"},{status:401});let t=await (0,h.SQ)(s.sub,s.roles||["user"],"15m");return p.k.info("Access token refreshed (via PUT)",{userId:s.sub,email:s.email}),i.NextResponse.json({access_token:t,expires_in:900,token_type:"Bearer",refresh_token:r,user:{id:s.sub,email:s.email,roles:s.roles||["user"]}})}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/refresh/route",pathname:"/api/auth/refresh",filename:"route",bundlePath:"app/api/auth/refresh/route"},resolvedPagePath:"/home/cursor-dev/Documents/Lumines/src/app/api/auth/refresh/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:k}=g,b="/api/auth/refresh/route";function y(){return(0,a.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}},93016:(e,r,s)=>{s.d(r,{k:()=>o});class t{constructor(){this.isDevelopment=!1,this.minLevel=process.env.LOG_LEVEL||"info"}shouldLog(e){let r=["debug","info","warn","error"];return r.indexOf(e)>=r.indexOf(this.minLevel)}formatMessage(e,r,s){let t=new Date().toISOString(),o=s?` ${JSON.stringify(s)}`:"";return`[${t}] [${e.toUpperCase()}] ${r}${o}`}debug(e,r){this.shouldLog("debug")}info(e,r){this.shouldLog("info")}warn(e,r){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e,r))}error(e,r,s){if(this.shouldLog("error")){let t={...s,error:r instanceof Error?{name:r.name,message:r.message,stack:r.stack}:String(r)};console.error(this.formatMessage("error",e,t))}}logRequest(e){this.info("HTTP Request",{requestId:e.requestId,method:e.method,path:e.path,query:e.query,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logResponse(e){this[e.statusCode>=500?"error":e.statusCode>=400?"warn":"info"]("HTTP Response",{requestId:e.requestId,statusCode:e.statusCode,statusText:e.statusText,duration:`${e.duration}ms`,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logQuery(e,r,s){this.debug("Database Query",{query:e,params:r,...s&&{duration:`${s}ms`}})}logCache(e,r,s){this.debug("Cache Operation",{operation:e,key:r,hit:s})}logEvent(e,r){this.info("Event Published",{event:e,...r&&{data:r}})}}let o=new t}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[9276,5972,1585,9766,7176],()=>s(84984));module.exports=t})();