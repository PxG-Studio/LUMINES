"use strict";(()=>{var e={};e.id=8449,e.ids=[8449],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},66083:e=>{e.exports=require("stream/web")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},29686:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>j,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>y,PATCH:()=>x});var o=r(49303),a=r(88716),n=r(60670),i=r(87070),p=r(41567),d=r(86420),u=r(97875),l=r(91585),c=r(26033);let m=l.Ry({status:l.Km(["pending","deploying","live","failed","rolled_back"]).optional(),url:l.Z_().url().optional(),error:l.Z_().optional()});async function y(e,{params:t}){let r=await (0,u.mk)(e);if(r.error)return i.NextResponse.json({error:r.error.message},{status:r.error.status});try{let e=await p.SX.findById(t.id);if(!e)return i.NextResponse.json({error:"Deployment not found"},{status:404});return i.NextResponse.json(e)}catch(e){return console.error("Error fetching deployment:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function x(e,{params:t}){let r=await (0,u.mk)(e);if(r.error)return i.NextResponse.json({error:r.error.message},{status:r.error.status});try{let r=await e.json(),s=m.parse(r),o=await p.SX.findById(t.id);if(!o)return i.NextResponse.json({error:"Deployment not found"},{status:404});let a=await p.SX.update(t.id,{...s,..."live"===s.status&&{deployedAt:new Date}});return"live"===s.status&&s.url?await d.O4.completed({deploymentId:t.id,projectId:o.projectId,url:s.url}):"failed"===s.status&&await d.O4.failed({deploymentId:t.id,projectId:o.projectId,error:s.error||"Deployment failed"}),await p.nI.create({type:`deployment.${s.status||"updated"}`,subsystem:"waypoint",deploymentId:t.id,projectId:o.projectId,userId:o.userId,payload:s}),i.NextResponse.json(a)}catch(e){if(e instanceof c.jm)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error updating deployment:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let w=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/deployments/[id]/route",pathname:"/api/deployments/[id]",filename:"route",bundlePath:"app/api/deployments/[id]/route"},resolvedPagePath:"/home/cursor-dev/Documents/Lumines/src/app/api/deployments/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:j}=w,b="/api/deployments/[id]/route";function q(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:f})}},86420:(e,t,r)=>{let s,o;r.d(t,{HS:()=>w,Os:()=>y,O4:()=>x,aN:()=>h});var a={};r.r(a),r.d(a,{j:()=>p});var n=r(51870),i=r(60114);let p={url:(0,i.xw)(),host:i.OB.NATS_HOST,port:i.OB.NATS_PORT,cluster:i.OB.NATS_CLUSTER,user:i.OB.NATS_USER,password:i.OB.NATS_PASSWORD,reconnect:!0,maxReconnectAttempts:10,reconnectTimeWait:2e3,jetstream:{maxPending:1024,ackWait:3e4}},d=globalThis;(0,n.StringCodec)();let u=(0,n.JSONCodec)();async function l(){if(d.nc&&d.js)return{connection:d.nc,jetstream:d.js};try{let e=(0,a.getNatsUrl)();new URL(e);let t={servers:[e],reconnect:p.reconnect,maxReconnectAttempts:p.maxReconnectAttempts,reconnectTimeWait:p.reconnectTimeWait};return p.user&&p.password&&(t.user=p.user,t.pass=p.password),o=(s=await (0,n.connect)(t)).jetstream(),s.closed().then(()=>{}),{connection:s,jetstream:o}}catch(e){throw console.error("âŒ NATS connection failed:",e),e}}async function c(){return s&&o?{nc:s,js:o}:d.nc&&d.js?(s=d.nc,o=d.js,{nc:s,js:o}):await l()}let m={publish:async(e,t)=>{try{let{js:r}=await c(),s=u.encode(t);await r.publish(e,s)}catch(t){throw console.error(`NATS publish error for subject ${e}:`,t),t}}},y={created:async e=>{await m.publish("component.created",e)},updated:async e=>{await m.publish("component.updated",e)},deleted:async e=>{await m.publish("component.deleted",e)}},x={started:async e=>{await m.publish("deployment.started",e)},completed:async e=>{await m.publish("deployment.completed",e)},failed:async e=>{await m.publish("deployment.failed",e)},rolledBack:async e=>{await m.publish("deployment.rolledBack",e)}},w={started:async e=>{await m.publish("build.started",e)},progress:async e=>{await m.publish("build.progress",e)},completed:async e=>{await m.publish("build.completed",e)},failed:async e=>{await m.publish("build.failed",e)}},h={updated:async e=>{await m.publish("token.updated",e)},synced:async e=>{await m.publish("token.synced",e)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,1585,9766,2197,1870,7176,7875],()=>r(29686));module.exports=s})();