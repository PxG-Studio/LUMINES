"use strict";(()=>{var e={};e.id=1996,e.ids=[1996],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},39858:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>$,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>d});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),h=r(93016),u=r(12657);class l{constructor(){this.thresholds=new Map,this.metrics=[],this.maxMetrics=1e3,this.setDefaultThresholds()}setDefaultThresholds(){this.setThreshold({name:"api_response_time",warning:500,critical:1e3,unit:"ms"}),this.setThreshold({name:"database_query_time",warning:100,critical:500,unit:"ms"}),this.setThreshold({name:"cache_operation_time",warning:10,critical:50,unit:"ms"}),this.setThreshold({name:"memory_usage",warning:80,critical:90,unit:"percentage"})}setThreshold(e){this.thresholds.set(e.name,e)}recordMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&this.metrics.shift(),u.qI.recordHistogram(e.name,e.value,e.labels||{});let t=this.thresholds.get(e.name);if(t&&t.unit===e.unit){let r=this.checkThreshold(e.value,t);"critical"===r?h.k.error("Performance threshold exceeded (critical)",void 0,{metric:e.name,value:e.value,threshold:t.critical,unit:e.unit}):"warning"===r&&h.k.warn("Performance threshold exceeded (warning)",{metric:e.name,value:e.value,threshold:t.warning,unit:e.unit})}}checkThreshold(e,t){return e>=t.critical?"critical":e>=t.warning?"warning":"ok"}async measureExecution(e,t,r){let s=performance.now();try{let a=await t(),i=performance.now()-s;return this.recordMetric({name:e,value:i,unit:"ms",timestamp:Date.now(),labels:r}),a}catch(a){let t=performance.now()-s;throw this.recordMetric({name:`${e}_error`,value:t,unit:"ms",timestamp:Date.now(),labels:{...r,error:"true"}}),a}}getStats(e,t){let r=this.metrics.filter(t=>t.name===e);if(t&&(r=r.filter(e=>!!e.labels&&Object.entries(t).every(([t,r])=>e.labels?.[t]===r))),0===r.length)return null;let s=r.map(e=>e.value).sort((e,t)=>e-t),a=s.reduce((e,t)=>e+t,0)/s.length;return{count:s.length,avg:a,min:s[0],max:s[s.length-1],p50:s[Math.floor(.5*s.length)],p95:s[Math.floor(.95*s.length)],p99:s[Math.floor(.99*s.length)]}}getMemoryUsage(){return"undefined"!=typeof process&&process.memoryUsage?process.memoryUsage():{heapUsed:0,heapTotal:0,external:0,rss:0}}recordMemoryUsage(){if("undefined"!=typeof process&&process.memoryUsage){let e=process.memoryUsage(),t=e.heapTotal||1,r=e.heapUsed/t*100;this.recordMetric({name:"memory_usage",value:r,unit:"percentage",timestamp:Date.now()}),this.recordMetric({name:"memory_heap_used",value:e.heapUsed,unit:"bytes",timestamp:Date.now()})}}clear(){this.metrics=[]}}let c=new l;var m=r(89708),p=r(17176);async function d(e){let t=await (0,p.YR)(e);if(t)return t;try{let e=c.getMemoryUsage(),t={memory:{heapUsed:e.heapUsed,heapTotal:e.heapTotal,external:e.external,rss:e.rss,heapUsedPercentage:e.heapTotal>0?e.heapUsed/e.heapTotal*100:0},api:{responseTime:c.getStats("api_response_time"),requestDuration:c.getStats("http_request_duration_ms")},database:{queryTime:c.getStats("database_query_time"),queryDuration:c.getStats("database_query_duration_ms")},cache:{operationTime:c.getStats("cache_operation_time")}},r=o.NextResponse.json(t);return(0,m.vm)(r)}catch(t){console.error("Error fetching performance metrics:",t);let e=o.NextResponse.json({error:"Internal server error"},{status:500});return(0,m.vm)(e)}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/performance/route",pathname:"/api/performance",filename:"route",bundlePath:"app/api/performance/route"},resolvedPagePath:"/home/cursor-dev/Documents/Lumines/src/app/api/performance/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:v}=g,$="/api/performance/route";function b(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},89708:(e,t,r)=>{r.d(t,{af:()=>i,vm:()=>n});let s={"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Referrer-Policy":"strict-origin-when-cross-origin","Permissions-Policy":"geolocation=(), microphone=(), camera=()"},a={...s,"Strict-Transport-Security":"max-age=31536000; includeSubDomains","Content-Security-Policy":"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"};function i(e,t=3600,r=!1,s=!1){let a=[];return r?a.push("public"):a.push("private"),a.push(`max-age=${t}`),s&&a.push("must-revalidate"),e.headers.set("Cache-Control",a.join(", ")),e}function n(e,t={}){let{isProduction:r=!0,version:n="1.0.0",noCache:o=!0,cacheMaxAge:h=0}=t;return(function(e,t=!1){for(let[r,i]of Object.entries(t?a:s))i&&e.headers.set(r,i)}(e,r),function(e,t="1.0.0"){e.headers.set("X-API-Version",t)}(e,n),o)?(e.headers.set("Cache-Control","no-store, no-cache, must-revalidate, proxy-revalidate"),e.headers.set("Pragma","no-cache"),e.headers.set("Expires","0")):h>0&&i(e,h,!1,!0),e}},93016:(e,t,r)=>{r.d(t,{k:()=>a});class s{constructor(){this.isDevelopment=!1,this.minLevel=process.env.LOG_LEVEL||"info"}shouldLog(e){let t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(this.minLevel)}formatMessage(e,t,r){let s=new Date().toISOString(),a=r?` ${JSON.stringify(r)}`:"";return`[${s}] [${e.toUpperCase()}] ${t}${a}`}debug(e,t){this.shouldLog("debug")}info(e,t){this.shouldLog("info")}warn(e,t){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e,t))}error(e,t,r){if(this.shouldLog("error")){let s={...r,error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:String(t)};console.error(this.formatMessage("error",e,s))}}logRequest(e){this.info("HTTP Request",{requestId:e.requestId,method:e.method,path:e.path,query:e.query,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logResponse(e){this[e.statusCode>=500?"error":e.statusCode>=400?"warn":"info"]("HTTP Response",{requestId:e.requestId,statusCode:e.statusCode,statusText:e.statusText,duration:`${e.duration}ms`,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logQuery(e,t,r){this.debug("Database Query",{query:e,params:t,...r&&{duration:`${r}ms`}})}logCache(e,t,r){this.debug("Cache Operation",{operation:e,key:t,hit:r})}logEvent(e,t){this.info("Event Published",{event:e,...t&&{data:t}})}}let a=new s},12657:(e,t,r)=>{r.d(t,{qI:()=>a});class s{incrementCounter(e,t,r=1){let s=this.getMetricKey(e,t),a=this.counters.get(s);a?a.value+=r:this.counters.set(s,{name:e,value:r,labels:t})}recordHistogram(e,t,r){let s=this.getMetricKey(e,r),a=this.histograms.get(s)||[];a.push({name:e,value:t,labels:r}),a.length>1e3&&a.shift(),this.histograms.set(s,a)}setGauge(e,t,r){let s=this.getMetricKey(e,r);this.gauges.set(s,t)}getCounter(e,t){let r=this.getMetricKey(e,t);return this.counters.get(r)?.value||0}getHistogramStats(e,t){let r=this.getMetricKey(e,t),s=this.histograms.get(r)||[];if(0===s.length)return null;let a=s.map(e=>e.value),i=a.reduce((e,t)=>e+t,0);return{count:s.length,sum:i,min:Math.min(...a),max:Math.max(...a),avg:i/s.length}}exportPrometheus(){let e=[];for(let[t,r]of this.counters.entries()){let t=this.formatLabels(r.labels);e.push(`# TYPE ${r.name} counter`),e.push(`${r.name}${t} ${r.value}`)}for(let[t,r]of this.histograms.entries()){if(0===r.length)continue;let t=this.formatLabels(r[0].labels),s=this.getHistogramStats(r[0].name,r[0].labels);s&&(e.push(`# TYPE ${r[0].name} histogram`),e.push(`${r[0].name}_count${t} ${s.count}`),e.push(`${r[0].name}_sum${t} ${s.sum}`),e.push(`${r[0].name}_min${t} ${s.min}`),e.push(`${r[0].name}_max${t} ${s.max}`),e.push(`${r[0].name}_avg${t} ${s.avg}`))}for(let[t,r]of this.gauges.entries()){let s=t.split("{")[0],a=t.includes("{")?`{${t.split("{")[1]}`:"";e.push(`# TYPE ${s} gauge`),e.push(`${s}${a} ${r}`)}return e.join("\n")+"\n"}reset(){this.counters.clear(),this.histograms.clear(),this.gauges.clear()}getMetricKey(e,t){if(!t||0===Object.keys(t).length)return e;let r=Object.entries(t).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}="${t}"`).join(",");return`${e}{${r}}`}formatLabels(e){if(!e||0===Object.keys(e).length)return"";let t=Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}="${t}"`).join(",");return`{${t}}`}constructor(){this.counters=new Map,this.histograms=new Map,this.gauges=new Map}}let a=new s}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,1585,9766,7176],()=>r(39858));module.exports=s})();