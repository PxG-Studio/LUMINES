"use strict";(()=>{var e={};e.id=6412,e.ids=[6412],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},41806:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>_,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>j,staticGenerationAsyncStorage:()=>q});var s={};r.r(s),r.d(s,{GET:()=>h,POST:()=>x});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),l=r(41567),u=r(97875),p=r(27793),c=r(68367),d=r(89708),m=r(91585),f=r(26033);let g=m.Ry({name:m.Z_().min(1),slug:m.Z_().min(1),description:m.Z_().optional(),engine:m.Z_().default("unity"),category:m.Z_().optional(),structure:m.Yj(),metadata:m.Yj().optional()});async function h(e){try{let t=e.nextUrl.searchParams,s=t.get("engine");if(s&&!t.has("page")&&!t.has("sort")){let e=await l.yu.findAll(s),t=o.NextResponse.json(e);return(0,d.af)(t,3600,!0),(0,d.vm)(t,{noCache:!1,cacheMaxAge:3600})}let a=(0,p.dr)(e),i=(0,c.ik)(e),n=(0,c.gX)(e);s&&(i.engine=s);let u=(0,c.Ye)(i,["engine","category","name","slug","createdAt","updatedAt"]);if(!u.valid){let e=o.NextResponse.json({error:"Invalid filter parameters",details:u.errors},{status:400});return(0,d.vm)(e)}let m=(0,c.M1)(i),f=(0,c.SI)(n,{field:"createdAt",direction:"desc"}),{prisma:g}=await Promise.resolve().then(r.bind(r,64199)),h=await g.template.count({where:m}),x=await g.template.findMany({where:m,orderBy:f,skip:a.offset,take:a.limit}),y=(0,p.q6)(x,h,a),v=o.NextResponse.json(y);return(0,p.jM)(v,a,h),(0,d.af)(v,3600,!0),(0,d.vm)(v,{noCache:!1,cacheMaxAge:3600})}catch(t){console.error("Error fetching templates:",t);let e=o.NextResponse.json({error:"Internal server error"},{status:500});return(0,d.vm)(e)}}async function x(e){let t=await (0,u.mk)(e);if(t.error)return o.NextResponse.json({error:t.error.message},{status:t.error.status});let r=await (0,u.rateLimit)(e,t.request.user?.id);if(r.error)return o.NextResponse.json({error:r.error.message},{status:r.error.status,headers:r.error.headers});try{let t=await e.json(),r=g.parse(t);if(await l.yu.findBySlug(r.slug))return o.NextResponse.json({error:"Template with this slug already exists"},{status:409});let s=await l.yu.create({name:r.name,slug:r.slug,description:r.description,engine:r.engine,category:r.category,structure:r.structure,metadata:r.metadata});await l.nI.create({type:"template.created",subsystem:"ignition",payload:{templateId:s.id,name:s.name,engine:s.engine}});let a=o.NextResponse.json(s,{status:201});return(0,d.vm)(a)}catch(t){if(t instanceof f.jm){let e=o.NextResponse.json({error:"Validation error",details:t.errors},{status:400});return(0,d.vm)(e)}console.error("Error creating template:",t);let e=o.NextResponse.json({error:"Internal server error"},{status:500});return(0,d.vm)(e)}}m.Ry({name:m.Z_().min(1).optional(),description:m.Z_().optional(),category:m.Z_().optional(),structure:m.Yj().optional(),metadata:m.Yj().optional()});let y=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/templates/route",pathname:"/api/templates",filename:"route",bundlePath:"app/api/templates/route"},resolvedPagePath:"/home/cursor-dev/Documents/Lumines/src/app/api/templates/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:q,serverHooks:j}=y,P="/api/templates/route";function _(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:q})}},68367:(e,t,r)=>{function s(e){let t=e.nextUrl.searchParams,r={};for(let[e,s]of t.entries())if("page"!==e&&"limit"!==e&&"sort"!==e&&"order"!==e){if(r[e]){let t=r[e];Array.isArray(t)?t.push(s):r[e]=[t,s]}else r[e]=s}return r}function a(e){let t=e.nextUrl.searchParams,r=t.get("sort"),s=t.get("order")||"asc";return r?{field:r,direction:"desc"===s.toLowerCase()?"desc":"asc"}:null}function i(e){let t={};for(let[r,s]of Object.entries(e))if(null!=s){if(Array.isArray(s))t[r]={in:s};else if(r.endsWith("_from")){let e=r.replace("_from","");t[e]||(t[e]={}),t[e].gte=new Date(s)}else if(r.endsWith("_to")){let e=r.replace("_to","");t[e]||(t[e]={}),t[e].lte=new Date(s)}else r.endsWith("_search")?t[r.replace("_search","")]={contains:s,mode:"insensitive"}:t[r]=s}return t}function n(e,t){if(!e&&!t)return{createdAt:"desc"};let r=e||t;return r?{[r.field]:r.direction}:{}}function o(e,t){let r=[];for(let s of Object.keys(e)){let e=s.replace(/_from$|_to$|_search$/,"");t.includes(e)||r.push(`Invalid filter field: ${s}`)}return{valid:0===r.length,errors:r}}r.d(t,{M1:()=>i,SI:()=>n,Ye:()=>o,gX:()=>a,ik:()=>s})},89708:(e,t,r)=>{r.d(t,{af:()=>i,vm:()=>n});let s={"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Referrer-Policy":"strict-origin-when-cross-origin","Permissions-Policy":"geolocation=(), microphone=(), camera=()"},a={...s,"Strict-Transport-Security":"max-age=31536000; includeSubDomains","Content-Security-Policy":"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"};function i(e,t=3600,r=!1,s=!1){let a=[];return r?a.push("public"):a.push("private"),a.push(`max-age=${t}`),s&&a.push("must-revalidate"),e.headers.set("Cache-Control",a.join(", ")),e}function n(e,t={}){let{isProduction:r=!0,version:n="1.0.0",noCache:o=!0,cacheMaxAge:l=0}=t;return(function(e,t=!1){for(let[r,i]of Object.entries(t?a:s))i&&e.headers.set(r,i)}(e,r),function(e,t="1.0.0"){e.headers.set("X-API-Version",t)}(e,n),o)?(e.headers.set("Cache-Control","no-store, no-cache, must-revalidate, proxy-revalidate"),e.headers.set("Pragma","no-cache"),e.headers.set("Expires","0")):l>0&&i(e,l,!1,!0),e}},27793:(e,t,r)=>{function s(e){let t=e.nextUrl.searchParams,r=t.get("page")?parseInt(t.get("page"),10):1,s=t.get("limit")?parseInt(t.get("limit"),10):20,a=Math.max(1,r),i=Math.min(100,Math.max(1,s));return{page:a,limit:i,offset:(a-1)*i}}function a(e,t,r){let s=Math.ceil(t/r.limit);return{data:e,pagination:{page:r.page,limit:r.limit,total:t,totalPages:s,hasNext:r.page<s,hasPrev:r.page>1}}}function i(e,t,r){let s=Math.ceil(r/t.limit);e.headers.set("X-Page",t.page.toString()),e.headers.set("X-Limit",t.limit.toString()),e.headers.set("X-Total",r.toString()),e.headers.set("X-Total-Pages",s.toString()),e.headers.set("X-Has-Next",(t.page<s).toString()),e.headers.set("X-Has-Prev",(t.page>1).toString())}r.d(t,{dr:()=>s,jM:()=>i,q6:()=>a})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,1585,9766,2197,7176,7875],()=>r(41806));module.exports=s})();