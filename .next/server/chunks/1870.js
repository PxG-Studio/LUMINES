exports.id=1870,exports.ids=[1870],exports.modules={51870:(e,t,r)=>{"use strict";e.exports=r(18048)},19172:function(e,t,r){"use strict";var s,i,n,o,a,c,u=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},l=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrderedPullConsumerImpl=t.PullConsumerImpl=t.OrderedConsumerMessages=t.PullConsumerMessagesImpl=t.ConsumerDebugEvents=t.ConsumerEvents=void 0;let h=r(3009),d=r(27723),f=r(82577),p=r(35611),m=r(45067),y=r(44013),b=r(46263),g=r(13858),v=r(72569);(s=o||(o={}))[s.Unset=-1]="Unset",s[s.Consume=0]="Consume",s[s.Fetch=1]="Fetch",(i=a||(t.ConsumerEvents=a={})).HeartbeatsMissed="heartbeats_missed",i.ConsumerNotFound="consumer_not_found",i.StreamNotFound="stream_not_found",i.ConsumerDeleted="consumer_deleted",i.OrderedConsumerRecreated="ordered_consumer_recreated",i.NoResponders="no_responders",(n=c||(t.ConsumerDebugEvents=c={})).DebugEvent="debug",n.Discard="discard",n.Reset="reset",n.Next="next";class _ extends p.QueuedIteratorImpl{constructor(e,t,r=!1){super(),this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.timeout=null,this.inbox=(0,m.createInbox)(e.api.nc.options.inboxPrefix),this.listeners=[],this.forOrderedConsumer=!1,this.abortOnMissingResource=!0===t.abort_on_missing_resource,this.bind=!0===t.bind,this.inBackOff=!1,this.start()}start(){let{max_messages:e,max_bytes:t,idle_heartbeat:r,threshold_bytes:s,threshold_messages:i}=this.opts;this.closed().then(e=>{if(this.cleanupHandler)try{this.cleanupHandler(e)}catch(e){}});let{sub:n}=this;n&&n.unsubscribe(),this.sub=this.consumer.api.nc.subscribe(this.inbox,{callback:(r,n)=>{var o,u,l,h;if(r){this.stop(r);return}if(null===(o=this.monitor)||void 0===o||o.work(),n.subject===this.inbox){if((0,f.isHeartbeatMsg)(n))return;let e=null===(u=n.headers)||void 0===u?void 0:u.code,t=(null===(h=null===(l=n.headers)||void 0===l?void 0:l.description)||void 0===h?void 0:h.toLowerCase())||"unknown",{msgsLeft:r,bytesLeft:s}=this.parseDiscard(n.headers);if(r>0||s>0)this.pending.msgs-=r,this.pending.bytes-=s,this.pending.requests--,this.notify(c.Discard,{msgsLeft:r,bytesLeft:s});else{if(400===e){this.stop(new m.NatsError(t,`${e}`));return}if(409===e&&"consumer deleted"===t){if(this.notify(a.ConsumerDeleted,`${e} ${t}`),!this.refilling||this.abortOnMissingResource){let r=new m.NatsError(t,`${e}`);this.stop(r);return}}else if(503===e){if(this.notify(a.NoResponders,`${e} No Responders`),!this.refilling||this.abortOnMissingResource){let t=new m.NatsError("no responders",`${e}`);this.stop(t);return}}else this.notify(c.DebugEvent,`${e} ${t}`)}}else this._push((0,b.toJsMsg)(n,this.consumer.api.timeout)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=n.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(e&&this.pending.msgs<=i||t&&this.pending.bytes<=s){let e=this.pullOptions();this.pull(e)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),r&&(this.monitor=new y.IdleHeartbeatMonitor(r,e=>(this.notify(a.HeartbeatsMissed,e),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),u(this,void 0,void 0,function*(){let e=this.consumer.api.nc.status();this.statusIterator=e;try{for(var t,r,s,i,n,o,a=!0,c=l(e);!(t=(o=yield c.next()).done);a=!0)switch(i=o.value,a=!1,i.type){case m.Events.Disconnect:null===(n=this.monitor)||void 0===n||n.cancel();break;case m.Events.Reconnect:this.resetPending().then(e=>{var t;e&&(null===(t=this.monitor)||void 0===t||t.restart())}).catch(()=>{})}}catch(e){r={error:e}}finally{try{!a&&!t&&(s=c.return)&&(yield s.call(c))}finally{if(r)throw r.error}}}),this.pull(this.pullOptions())}_push(e){if(this.callback){let t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(e){this.stop(e)}}else super.push(e)}notify(e,t){this.listeners.length>0&&(()=>{this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})})()}resetPending(){return this.bind?this.resetPendingNoInfo():this.resetPendingWithInfo()}resetPendingNoInfo(){return this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),Promise.resolve(!0)}resetPendingWithInfo(){return u(this,void 0,void 0,function*(){if(this.inBackOff)return!1;let e=0,t=0,r=(0,h.backoff)([this.opts.expires]),s=0;for(;;){if(this.done)return!1;if(this.consumer.api.nc.isClosed())return console.error("aborting resetPending - connection is closed"),!1;try{return yield this.consumer.info(),this.inBackOff=!1,e=0,this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0}catch(o){if("stream not found"===o.message){if(t++,this.notify(a.StreamNotFound,t),!this.refilling||this.abortOnMissingResource)return this.stop(o),!1}else if("consumer not found"===o.message){if(e++,this.notify(a.ConsumerNotFound,e),this.resetHandler)try{this.resetHandler()}catch(e){}if(!this.refilling||this.abortOnMissingResource)return this.stop(o),!1;if(this.forOrderedConsumer)return!1}else e=0,t=0;this.inBackOff=!0;let i=r.backoff(s),n=(0,h.delay)(i);yield Promise.race([n,this.consumer.api.nc.closed()]),n.cancel(),s++}}})}pull(e){var t,r;this.pending.bytes+=null!==(t=e.max_bytes)&&void 0!==t?t:0,this.pending.msgs+=null!==(r=e.batch)&&void 0!==r?r:0,this.pending.requests++;let s=this.consumer.api.nc;this._push(()=>{s.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(c.Next,e)})}pullOptions(){let e=this.opts.max_messages-this.pending.msgs;return{batch:e,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:(0,h.nanos)(this.opts.idle_heartbeat),expires:(0,h.nanos)(this.opts.expires)}}parseDiscard(e){let t={msgsLeft:0,bytesLeft:0},r=null==e?void 0:e.get(v.JsHeaders.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));let s=null==e?void 0:e.get(v.JsHeaders.PendingBytesHdr);return s&&(t.bytesLeft=parseInt(s)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){var e,t;null===(e=this.monitor)||void 0===e||e.cancel(),this.monitor=null,null===(t=this.timeout)||void 0===t||t.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){var t,r;this.done||(null===(t=this.sub)||void 0===t||t.unsubscribe(),this.clearTimers(),null===(r=this.statusIterator)||void 0===r||r.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(e=>{e.stop()})}))}parseOptions(e,t=!1){let r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){let e=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||e;let t=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||t}return r}status(){let e=new p.QueuedIteratorImpl;return this.listeners.push(e),Promise.resolve(e)}}t.PullConsumerMessagesImpl=_;class E extends p.QueuedIteratorImpl{constructor(){super(),this.listeners=[]}setSource(e){this.src&&(this.src.resetHandler=void 0,this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(e=>{this.stop(e||void 0)}),u(this,void 0,void 0,function*(){var e,t,r,s;let i=yield this.src.status();try{for(var n,o=!0,a=l(i);!(e=(n=yield a.next()).done);o=!0)s=n.value,o=!1,this.notify(s.type,s.data)}catch(e){t={error:e}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(t)throw t.error}}}).catch(()=>{})}notify(e,t){this.listeners.length>0&&(()=>{this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})})()}stop(e){var t;this.done||(null===(t=this.src)||void 0===t||t.stop(e),super.stop(e),this.listeners.forEach(e=>{e.stop()}))}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}status(){let e=new p.QueuedIteratorImpl;return this.listeners.push(e),Promise.resolve(e)}}t.OrderedConsumerMessages=E;class S{constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new _(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){let t=new _(this,e,!1),r=Math.round(1.05*t.opts.expires),s=(0,h.timeout)(r);return t.closed().catch(()=>{}).finally(()=>{s.cancel()}),s.catch(()=>{t.close().catch()}),t.trackTimeout(s),Promise.resolve(t)}next(e={expires:3e4}){let t=(0,h.deferred)();e.max_messages=1;let r=new _(this,e,!1),s=Math.round(1.05*r.opts.expires);s>=6e4&&u(this,void 0,void 0,function*(){var e,s,i,n;try{for(var o,c=!0,u=l((yield r.status()));!(e=(o=yield u.next()).done);c=!0)if(n=o.value,c=!1,n.type===a.HeartbeatsMissed&&n.data>=2){t.reject(Error("consumer missed heartbeats"));break}}catch(e){s={error:e}}finally{try{!c&&!e&&(i=u.return)&&(yield i.call(u))}finally{if(s)throw s.error}}}).catch(),u(this,void 0,void 0,function*(){var e,s,i,n;try{for(var o,a=!0,c=l(r);!(e=(o=yield c.next()).done);a=!0){n=o.value,a=!1,t.resolve(n);break}}catch(e){s={error:e}}finally{try{!a&&!e&&(i=c.return)&&(yield i.call(c))}finally{if(s)throw s.error}}}).catch(()=>{});let i=(0,h.timeout)(s);return r.closed().then(e=>{e?t.reject(e):t.resolve(null)}).catch(e=>{t.reject(e)}).finally(()=>{i.cancel()}),i.catch(e=>{t.resolve(null),r.close().catch()}),r.trackTimeout(i),t}delete(){let{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);let{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(e=>(this._info=e,this._info))}}t.PullConsumerImpl=S;class P{constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=d.nuid.next(),"string"==typeof r.name_prefix&&((0,f.minValidation)("name_prefix",r.name_prefix),this.namePrefix=r.name_prefix+this.namePrefix),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=o.Unset,this.consumerOpts=r,this.maxInitialReset=30,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;let t=`${this.namePrefix}_${this.serial}`;e=0===e?1:e;let r={name:t,deliver_policy:g.DeliverPolicy.StartSequence,opt_start_seq:e,ack_policy:g.AckPolicy.None,inactive_threshold:(0,h.nanos)(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),this.consumerOpts.replay_policy&&(r.replay_policy=this.consumerOpts.replay_policy),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||g.DeliverPolicy.StartSequence,(this.consumerOpts.deliver_policy===g.DeliverPolicy.LastPerSubject||this.consumerOpts.deliver_policy===g.DeliverPolicy.New||this.consumerOpts.deliver_policy===g.DeliverPolicy.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===g.DeliverPolicy.LastPerSubject&&void 0===r.filter_subjects&&void 0===r.filter_subject&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=g.DeliverPolicy.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=(0,h.nanos)(this.consumerOpts.inactive_threshold))),r}resetConsumer(){return u(this,arguments,void 0,function*(e=0){var t,r,s,i,n;let c;d.nuid.next();let u=0===this.serial;null===(t=this.consumer)||void 0===t||t.delete().catch(()=>{}),e=0===e?1:e,this.cursor.deliver_seq=0;let l=this.getConsumerOpts(e);l.max_deliver=1,l.mem_storage=!0;let f=(0,h.backoff)([(null===(r=this.opts)||void 0===r?void 0:r.expires)||3e4]);for(let e=0;;e++)try{c=yield this.api.add(this.stream,l),null===(s=this.iter)||void 0===s||s.notify(a.OrderedConsumerRecreated,c.name);break}catch(t){if("stream not found"===t.message&&(null===(i=this.iter)||void 0===i||i.notify(a.StreamNotFound,e),this.type===o.Fetch||!0===this.opts.abort_on_missing_resource))return null===(n=this.iter)||void 0===n||n.stop(t),Promise.reject(t);if(u&&e>=this.maxInitialReset)throw t;yield(0,h.delay)(f.backoff(e+1))}return c})}internalHandler(e){return t=>{var r;if(this.serial!==e)return;let s=t.info.deliverySequence;if(s!==this.cursor.deliver_seq+1){this.notifyOrderedResetAndReset();return}this.cursor.deliver_seq=s,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):null===(r=this.iter)||void 0===r||r.push(t)}}reset(){return u(this,arguments,void 0,function*(e={max_messages:100,expires:3e4},t){var r,s;let i=(t=t||{}).fromFetch||!1,n=t.orderedReset||!1;if(this.type===o.Fetch&&n){null===(r=this.iter)||void 0===r||r.src.stop(),yield null===(s=this.iter)||void 0===s?void 0:s.closed(),this.currentConsumer=null;return}(null===this.currentConsumer||n)&&(this.currentConsumer=yield this.resetConsumer(this.cursor.stream_seq+1)),(null===this.iter||i)&&(this.iter=new E),this.consumer=new S(this.api,this.currentConsumer),e.callback=this.internalHandler(this.serial);let a=null;this.type===o.Fetch&&i?a=yield this.consumer.fetch(e):this.type===o.Consume&&(a=yield this.consumer.consume(e));let c=a;c.forOrderedConsumer=!0,c.resetHandler=()=>{this.notifyOrderedResetAndReset()},this.iter.setSource(c)})}notifyOrderedResetAndReset(){var e;null===(e=this.iter)||void 0===e||e.notify(c.Reset,""),this.reset(this.opts,{orderedReset:!0})}consume(){return u(this,arguments,void 0,function*(e={max_messages:100,expires:3e4}){if(e.bind)return Promise.reject(Error("bind is not supported"));if(this.type===o.Fetch)return Promise.reject(Error("ordered consumer initialized as fetch"));if(this.type===o.Consume)return Promise.reject(Error("ordered consumer doesn't support concurrent consume"));let{callback:t}=e;return t&&(this.userCallback=t),this.type=o.Consume,this.opts=e,yield this.reset(e),this.iter})}fetch(){return u(this,arguments,void 0,function*(e={max_messages:100,expires:3e4}){var t;if(e.bind)return Promise.reject(Error("bind is not supported"));if(this.type===o.Consume)return Promise.reject(Error("ordered consumer already initialized as consume"));if((null===(t=this.iter)||void 0===t?void 0:t.done)===!1)return Promise.reject(Error("ordered consumer doesn't support concurrent fetch"));let{callback:r}=e;return r&&(this.userCallback=r),this.type=o.Fetch,this.opts=e,yield this.reset(e,{fromFetch:!0}),this.iter})}next(){return u(this,arguments,void 0,function*(e={expires:3e4}){if(e.bind)return Promise.reject(Error("bind is not supported"));e.max_messages=1;let t=(0,h.deferred)();return e.callback=e=>{this.userCallback=null,t.resolve(e)},(yield this.fetch(e)).iterClosed.then(e=>{e&&t.reject(e),t.resolve(null)}).catch(e=>{t.reject(e)}),t})}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){return u(this,void 0,void 0,function*(){return null==this.currentConsumer?(this.currentConsumer=yield this.resetConsumer(this.startSeq),Promise.resolve(this.currentConsumer)):e&&this.currentConsumer?Promise.resolve(this.currentConsumer):this.api.info(this.stream,this.currentConsumer.name)})}}t.OrderedPullConsumerImpl=P},78172:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumerEvents=t.ConsumerDebugEvents=t.StoreCompression=t.StorageType=t.RetentionPolicy=t.ReplayPolicy=t.DiscardPolicy=t.DeliverPolicy=t.AckPolicy=t.RepublishHeaders=t.KvWatchInclude=t.JsHeaders=t.isConsumerOptsBuilder=t.DirectMsgHeaders=t.consumerOpts=t.AdvisoryKind=t.isHeartbeatMsg=t.isFlowControlMsg=t.checkJsError=void 0;var s=r(82577);Object.defineProperty(t,"checkJsError",{enumerable:!0,get:function(){return s.checkJsError}}),Object.defineProperty(t,"isFlowControlMsg",{enumerable:!0,get:function(){return s.isFlowControlMsg}}),Object.defineProperty(t,"isHeartbeatMsg",{enumerable:!0,get:function(){return s.isHeartbeatMsg}});var i=r(72569);Object.defineProperty(t,"AdvisoryKind",{enumerable:!0,get:function(){return i.AdvisoryKind}}),Object.defineProperty(t,"consumerOpts",{enumerable:!0,get:function(){return i.consumerOpts}}),Object.defineProperty(t,"DirectMsgHeaders",{enumerable:!0,get:function(){return i.DirectMsgHeaders}}),Object.defineProperty(t,"isConsumerOptsBuilder",{enumerable:!0,get:function(){return i.isConsumerOptsBuilder}}),Object.defineProperty(t,"JsHeaders",{enumerable:!0,get:function(){return i.JsHeaders}}),Object.defineProperty(t,"KvWatchInclude",{enumerable:!0,get:function(){return i.KvWatchInclude}}),Object.defineProperty(t,"RepublishHeaders",{enumerable:!0,get:function(){return i.RepublishHeaders}});var n=r(13858);Object.defineProperty(t,"AckPolicy",{enumerable:!0,get:function(){return n.AckPolicy}}),Object.defineProperty(t,"DeliverPolicy",{enumerable:!0,get:function(){return n.DeliverPolicy}}),Object.defineProperty(t,"DiscardPolicy",{enumerable:!0,get:function(){return n.DiscardPolicy}}),Object.defineProperty(t,"ReplayPolicy",{enumerable:!0,get:function(){return n.ReplayPolicy}}),Object.defineProperty(t,"RetentionPolicy",{enumerable:!0,get:function(){return n.RetentionPolicy}}),Object.defineProperty(t,"StorageType",{enumerable:!0,get:function(){return n.StorageType}}),Object.defineProperty(t,"StoreCompression",{enumerable:!0,get:function(){return n.StoreCompression}});var o=r(19172);Object.defineProperty(t,"ConsumerDebugEvents",{enumerable:!0,get:function(){return o.ConsumerDebugEvents}}),Object.defineProperty(t,"ConsumerEvents",{enumerable:!0,get:function(){return o.ConsumerEvents}})},13858:(e,t,r)=>{"use strict";var s,i,n,o,a,c,u,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumerApiAction=t.StoreCompression=t.ReplayPolicy=t.AckPolicy=t.DeliverPolicy=t.StorageType=t.DiscardPolicy=t.RetentionPolicy=void 0,t.defaultConsumer=function(e,t={}){return Object.assign({name:e,deliver_policy:o.All,ack_policy:a.Explicit,ack_wait:(0,h.nanos)(3e4),replay_policy:c.Instant},t)};let h=r(3009);(function(e){e.Limits="limits",e.Interest="interest",e.Workqueue="workqueue"})(s||(t.RetentionPolicy=s={})),function(e){e.Old="old",e.New="new"}(i||(t.DiscardPolicy=i={})),function(e){e.File="file",e.Memory="memory"}(n||(t.StorageType=n={})),function(e){e.All="all",e.Last="last",e.New="new",e.StartSequence="by_start_sequence",e.StartTime="by_start_time",e.LastPerSubject="last_per_subject"}(o||(t.DeliverPolicy=o={})),function(e){e.None="none",e.All="all",e.Explicit="explicit",e.NotSet=""}(a||(t.AckPolicy=a={})),function(e){e.Instant="instant",e.Original="original"}(c||(t.ReplayPolicy=c={})),function(e){e.None="none",e.S2="s2"}(u||(t.StoreCompression=u={})),function(e){e.CreateOrUpdate="",e.Update="update",e.Create="create"}(l||(t.ConsumerApiAction=l={}))},18231:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseApiClient=void 0,t.defaultJsOptions=u;let i=r(97636),n=r(25952),o=r(3009),a=r(82577),c=r(45067);function u(e){return(e=e||{}).domain&&(e.apiPrefix=`$JS.${e.domain}.API`,delete e.domain),(0,o.extend)({apiPrefix:"$JS.API",timeout:5e3},e)}class l{constructor(e,t){this.nc=e,this.opts=u(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=(0,n.JSONCodec)()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e){return s(this,arguments,void 0,function*(e,t=null,r){(r=r||{}).timeout=this.timeout;let s=i.Empty;t&&(s=this.jc.encode(t));let{retries:n}=r;n=-1===(n=n||1)?Number.MAX_SAFE_INTEGER:n;let a=(0,o.backoff)();for(let t=0;t<n;t++)try{let t=yield this.nc.request(e,s,r);return this.parseJsResponse(t)}catch(e){if(("503"===e.code||e.code===c.ErrorCode.Timeout)&&t+1<n)yield(0,o.delay)(a.backoff(t));else throw e}})}findStream(e){return s(this,void 0,void 0,function*(){let t=yield this._request(`${this.prefix}.STREAM.NAMES`,{subject:e});if(!t.streams||1!==t.streams.length)throw Error("no stream matches subject");return t.streams[0]})}getConnection(){return this.nc}parseJsResponse(e){let t=this.jc.decode(e.data);if(t.error){let e=(0,a.checkJsErrorCode)(t.error.code,t.error.description);if(null!==e)throw e.api_error=t.error,e}return t}}t.BaseApiClient=l},66426:function(e,t,r){"use strict";var s,i,n=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.JetStreamSubscriptionImpl=t.JetStreamClientImpl=t.PubHeaders=void 0;let o=r(91530),a=r(18231),c=r(82577),u=r(7773),l=r(46263),h=r(91837),d=r(35611),f=r(3009),p=r(24725),m=r(18791),y=r(63248),b=r(3086),g=r(44013),v=r(575),_=r(72569),E=r(45067),S=r(13858),P=r(27723);(s=i||(t.PubHeaders=i={})).MsgIdHdr="Nats-Msg-Id",s.ExpectedStreamHdr="Nats-Expected-Stream",s.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",s.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",s.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class w{constructor(e){this.js=e}kv(e,t={}){let{ok:r,min:s}=this.js.nc.features.get(y.Feature.JS_KV);return r?t.bindOnly?m.Bucket.bind(this.js,e,t):m.Bucket.create(this.js,e,t):Promise.reject(Error(`kv is only supported on servers ${s} or better`))}os(e,t={}){var r;if("function"!=typeof(null===(r=null==crypto?void 0:crypto.subtle)||void 0===r?void 0:r.digest))return Promise.reject(Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));let{ok:s,min:i}=this.js.nc.features.get(y.Feature.JS_OBJECTSTORE);return s?b.ObjectStoreImpl.create(this.js,e,t):Promise.reject(Error(`objectstore is only supported on servers ${i} or better`))}}class C extends a.BaseApiClient{constructor(e,t){super(e,t),this.consumerAPI=new u.ConsumerAPIImpl(e,t),this.streamAPI=new v.StreamAPIImpl(e,t),this.consumers=new v.ConsumersImpl(this.consumerAPI),this.streams=new v.StreamsImpl(this.streamAPI)}jetstreamManager(e){void 0===e&&(e=this.opts.checkAPI);let t=Object.assign({},this.opts,{checkAPI:e});return this.nc.jetstreamManager(t)}get apiPrefix(){return this.prefix}get views(){return new w(this)}publish(e){return n(this,arguments,void 0,function*(e,t=o.Empty,r){let s;(r=r||{}).expect=r.expect||{};let n=(null==r?void 0:r.headers)||(0,p.headers)();r&&(r.msgID&&n.set(i.MsgIdHdr,r.msgID),r.expect.lastMsgID&&n.set(i.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&n.set(i.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&n.set(i.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&n.set(i.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));let a=r.timeout||this.timeout,c={};a&&(c.timeout=a),r&&(c.headers=n);let{retries:u,retry_delay:l}=r;u=u||1,l=l||250;for(let r=0;r<u;r++)try{s=yield this.nc.request(e,t,c);break}catch(e){if("503"===e.code&&r+1<u)yield(0,f.delay)(l);else throw e}let h=this.parseJsResponse(s);if(""===h.stream)throw o.NatsError.errorForCode(E.ErrorCode.JetStreamInvalidAck);return h.duplicate=!!h.duplicate&&h.duplicate,h})}pull(e,t){return n(this,arguments,void 0,function*(e,t,r=0){(0,c.validateStreamName)(e),(0,c.validateDurableName)(t);let s=this.timeout;r>s&&(s=r);let i={batch:1,no_wait:0===(r=r<0?0:(0,f.nanos)(r)),expires:r},n=yield this.nc.request(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(i),{noMux:!0,timeout:s}),o=(0,c.checkJsError)(n);if(o)throw o;return(0,l.toJsMsg)(n,this.timeout)})}fetch(e,t,r={}){var s;(0,c.validateStreamName)(e),(0,c.validateDurableName)(t);let i=null,a=(null!==(s=r.max_bytes)&&void 0!==s?s:0)>0,u=0,h=a?r.max_bytes:0,p=null,m={};if(m.batch=r.batch||1,h){let e=this.nc.features.get(y.Feature.JS_PULL_MAX_BYTES);if(!e.ok)throw Error(`max_bytes is only supported on servers ${e.min} or better`);m.max_bytes=h}m.no_wait=r.no_wait||!1,m.no_wait&&m.expires&&(m.expires=0);let b=r.expires||0;if(b&&(m.expires=(0,f.nanos)(b)),0===b&&!1===m.no_wait)throw Error("expires or no_wait is required");let v=r.idle_heartbeat||0;v&&(m.idle_heartbeat=(0,f.nanos)(v),!0===r.delay_heartbeat&&(m.idle_heartbeat=(0,f.nanos)(4*v)));let _=new d.QueuedIteratorImpl,S=m.batch,P=0;_.protocolFilterFn=(e,t=!1)=>!(0,c.isHeartbeatMsg)(e.msg)||(null==p||p.work(),!1),_.dispatchedFn=e=>{e&&(a&&(u+=e.data.length),P++,(!i||0!==e.info.pending)&&(1===_.getPending()&&0===e.info.pending||S===P||h>0&&u>=h)&&_.stop())};let w=(0,E.createInbox)(this.nc.options.inboxPrefix),C=this.nc.subscribe(w,{max:r.batch,callback:(e,t)=>{null===e&&(e=(0,c.checkJsError)(t)),null!==e?(i&&(i.cancel(),i=null),(0,E.isNatsError)(e)?_.stop(null===x(e)?void 0:e):_.stop(e)):(null==p||p.work(),_.received++,_.push((0,l.toJsMsg)(t,this.timeout)))}});return b&&(i=(0,f.timeout)(b)).catch(()=>{C.isClosed()||(C.drain().catch(()=>{}),i=null),p&&p.cancel()}),n(this,void 0,void 0,function*(){try{v&&(p=new g.IdleHeartbeatMonitor(v,e=>(_.push(()=>{_.err=new o.NatsError(`${c.Js409Errors.IdleHeartbeatMissed}: ${e}`,E.ErrorCode.JetStreamIdleHeartBeat)}),!0)))}catch(e){}yield C.closed,null!==i&&(i.cancel(),i=null),p&&p.cancel(),_.stop()}).catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(m),{reply:w}),_}pullSubscribe(e){return n(this,arguments,void 0,function*(e,t=(0,_.consumerOpts)()){let r=yield this._processOptions(e,t);if(r.ordered)throw Error("pull subscribers cannot be be ordered");if(r.config.deliver_subject)throw Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");let s=r.config.ack_policy;if(s===S.AckPolicy.None||s===S.AckPolicy.All)throw Error("ack policy for pull consumers must be explicit");let i=this._buildTypedSubscriptionOpts(r),n=new A(this,r.deliver,i);n.info=r;try{yield this._maybeCreateConsumer(r)}catch(e){throw n.unsubscribe(),e}return n})}subscribe(e){return n(this,arguments,void 0,function*(e,t=(0,_.consumerOpts)()){let r=yield this._processOptions(e,t);if(!r.isBind&&!r.config.deliver_subject)throw Error("push consumer requires deliver_subject");let s=this._buildTypedSubscriptionOpts(r),i=new O(this,r.deliver,s);i.info=r;try{yield this._maybeCreateConsumer(r)}catch(e){throw i.unsubscribe(),e}return i._maybeSetupHbMonitoring(),i})}_processOptions(e){return n(this,arguments,void 0,function*(e,t=(0,_.consumerOpts)()){var r,s;let i=(0,_.isConsumerOptsBuilder)(t)?t.getOpts():t;if(i.isBind=!!(0,_.isConsumerOptsBuilder)(t)&&t.isBind,i.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},i.ordered){if(i.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},i.config.ack_policy!==S.AckPolicy.NotSet&&i.config.ack_policy!==S.AckPolicy.None)throw new o.NatsError("ordered consumer: ack_policy can only be set to 'none'",E.ErrorCode.ApiError);if(i.config.durable_name&&i.config.durable_name.length>0)throw new o.NatsError("ordered consumer: durable_name cannot be set",E.ErrorCode.ApiError);if(i.config.deliver_subject&&i.config.deliver_subject.length>0)throw new o.NatsError("ordered consumer: deliver_subject cannot be set",E.ErrorCode.ApiError);if(void 0!==i.config.max_deliver&&i.config.max_deliver>1)throw new o.NatsError("ordered consumer: max_deliver cannot be set",E.ErrorCode.ApiError);if(i.config.deliver_group&&i.config.deliver_group.length>0)throw new o.NatsError("ordered consumer: deliver_group cannot be set",E.ErrorCode.ApiError);i.config.deliver_subject=(0,E.createInbox)(this.nc.options.inboxPrefix),i.config.ack_policy=S.AckPolicy.None,i.config.max_deliver=1,i.config.flow_control=!0,i.config.idle_heartbeat=i.config.idle_heartbeat||(0,f.nanos)(5e3),i.config.ack_wait=(0,f.nanos)(792e5),i.config.mem_storage=!0,i.config.num_replicas=1}if(i.config.ack_policy===S.AckPolicy.NotSet&&(i.config.ack_policy=S.AckPolicy.All),i.api=this,i.config=i.config||{},i.stream=i.stream?i.stream:yield this.findStream(e),i.attached=!1,i.config.durable_name)try{let t=yield this.consumerAPI.info(i.stream,i.config.durable_name);if(t){if(t.config.filter_subject&&t.config.filter_subject!==e)throw Error("subject does not match consumer");let n=null!==(r=i.config.deliver_group)&&void 0!==r?r:"";if(""===n&&!0===t.push_bound)throw Error("duplicate subscription");let o=null!==(s=t.config.deliver_group)&&void 0!==s?s:"";if(n!==o){if(""===o)throw Error("durable requires no queue group");throw Error(`durable requires queue group '${o}'`)}i.last=t,i.config=t.config,i.attached=!0,i.config.durable_name||(i.name=t.name)}}catch(e){if("404"!==e.code)throw e}return i.attached||void 0!==i.config.filter_subject||void 0!==i.config.filter_subjects||(i.config.filter_subject=e),i.deliver=i.config.deliver_subject||(0,E.createInbox)(this.nc.options.inboxPrefix),i})}_buildTypedSubscriptionOpts(e){var t,r;let s={};return s.adapter=(t=void 0===e.callbackFn,r=this.timeout,t?(e,t)=>{if(e)return[e,null];let s=(0,c.checkJsError)(t);return null!==s?[x(s),null]:[null,(0,l.toJsMsg)(t,r)]}:(e,t)=>e||(e=(0,c.checkJsError)(t))?[e,null]:[null,(0,l.toJsMsg)(t,r)]),s.ingestionFilterFn=C.ingestionFn(e.ordered),s.protocolFilterFn=(e,t=!1)=>!(0,c.isFlowControlMsg)(e.msg)||(t||e.msg.respond(),!1),e.mack||e.config.ack_policy===S.AckPolicy.None||(s.dispatchedFn=j),e.callbackFn&&(s.callback=e.callbackFn),s.max=e.max||0,s.queue=e.queue,s}_maybeCreateConsumer(e){return n(this,void 0,void 0,function*(){if(e.attached)return;if(e.isBind)throw Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:S.DeliverPolicy.All,ack_policy:S.AckPolicy.Explicit,ack_wait:(0,f.nanos)(3e4),replay_policy:S.ReplayPolicy.Instant},e.config);let t=yield this.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(t.config.filter_subjects)))throw Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=t.name,e.config=t.config,e.last=t})}static ingestionFn(e){return(t,r)=>{var s;if(!t)return{ingest:!1,protocol:!1};if((0,c.checkJsError)(t.msg)||null===(s=r.monitor)||void 0===s||s.work(),(0,c.isHeartbeatMsg)(t.msg)){let s=!e||r._checkHbOrderConsumer(t.msg);return!e&&r.info.flow_control.heartbeat_count++,{ingest:s,protocol:!0}}return(0,c.isFlowControlMsg)(t.msg)?(r.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||r._checkOrderedConsumer(t),protocol:!1}}}}t.JetStreamClientImpl=C;class O extends h.TypedSubscription{constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;let t=(0,E.createInbox)(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);let r=this.info;r.config.name=P.nuid.next(),r.ordered_consumer_sequence.delivery_seq=0,r.flow_control.heartbeat_count=0,r.flow_control.fc_count=0,r.flow_control.consumer_restarts++,r.deliver=t,r.config.deliver_subject=t,r.config.deliver_policy=S.DeliverPolicy.StartSequence,r.config.opt_start_seq=e;let s={};s.stream_name=this.info.stream,s.config=r.config;let i=`${r.api.prefix}.CONSUMER.CREATE.${r.stream}`;this.js._request(i,s,{retries:-1}).then(e=>{this.sub.info.last=e,this.info.config=e.config,this.info.name=e.name}).catch(t=>{let s=new o.NatsError(`unable to recreate ordered consumer ${r.stream} at seq ${e}`,E.ErrorCode.RequestError,t);this.sub.callback(s,{})})}_maybeSetupHbMonitoring(){var e,t;let r=(null===(t=null===(e=this.info)||void 0===e?void 0:e.config)||void 0===t?void 0:t.idle_heartbeat)||0;r&&this._setupHbMonitoring((0,f.millis)(r))}_setupHbMonitoring(e,t=0){let r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);let s=this.sub;this.monitor=new g.IdleHeartbeatMonitor(e,e=>{var t,r,i,n;let o=(0,c.newJsErrorMsg)(409,`${c.Js409Errors.IdleHeartbeatMissed}: ${e}`,this.sub.subject);if(null===(t=this.info)||void 0===t?void 0:t.ordered){if(!this.js.nc.protocol.connected)return!1;let e=(null===(i=null===(r=this.info)||void 0===r?void 0:r.ordered_consumer_sequence)||void 0===i?void 0:i.stream_seq)||0;return this._resetOrderedConsumer(e+1),null===(n=this.monitor)||void 0===n||n.restart(),!1}return this.sub.callback(null,o),!s.noIterator},r)}_checkHbOrderConsumer(e){let t=e.headers.get(_.JsHeaders.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);let r=parseInt(e.headers.get(_.JsHeaders.LastConsumerSeqHdr),10),s=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==s.delivery_seq&&this._resetOrderedConsumer(s.stream_seq+1),!1}_checkOrderedConsumer(e){let t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,s=e.info.deliverySequence;return s!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=s,t.stream_seq=r,!0)}destroy(){return n(this,void 0,void 0,function*(){this.isClosed()||(yield this.drain());let e=this.sub.info,t=e.config.durable_name||e.name,r=`${e.api.prefix}.CONSUMER.DELETE.${e.stream}.${t}`;yield e.api._request(r)})}consumerInfo(){return n(this,void 0,void 0,function*(){let e=this.sub.info,t=e.config.durable_name||e.name,r=`${e.api.prefix}.CONSUMER.INFO.${e.stream}.${t}`,s=yield e.api._request(r);return e.last=s,s})}}t.JetStreamSubscriptionImpl=O;class A extends O{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){var t,r;let{stream:s,config:i,name:n}=this.sub.info,o=null!==(t=i.durable_name)&&void 0!==t?t:n,a={};if(a.batch=e.batch||1,a.no_wait=e.no_wait||!1,(null!==(r=e.max_bytes)&&void 0!==r?r:0)>0){let t=this.js.nc.features.get(y.Feature.JS_PULL_MAX_BYTES);if(!t.ok)throw Error(`max_bytes is only supported on servers ${t.min} or better`);a.max_bytes=e.max_bytes}let c=0;e.expires&&e.expires>0&&(c=e.expires,a.expires=(0,f.nanos)(c));let u=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(u=e.idle_heartbeat,a.idle_heartbeat=(0,f.nanos)(u)),u&&0===c)throw Error("idle_heartbeat requires expires");if(u>c)throw Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),c&&u&&(this.monitor?this.monitor._change(u,c):this._setupHbMonitoring(u,c));let e=this.info.api,t=`${e.prefix}.CONSUMER.MSG.NEXT.${s}.${o}`,r=this.sub.subject;e.nc.publish(t,e.jc.encode(a),{reply:r})}}}function x(e){if(null!==e)switch(e.code){case E.ErrorCode.JetStream404NoMessages:case E.ErrorCode.JetStream408RequestTimeout:break;case E.ErrorCode.JetStream409:if((0,c.isTerminal409)(e))return e;break;default:return e}return null}function j(e){e&&e.ack()}},49170:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},i=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){n[e]&&(i[e]=function(t){return new Promise(function(r,s){o.push([e,t,r,s])>1||c(e,t)})},t&&(i[e]=t(i[e])))}function c(e,t){try{var r;(r=n[e](t)).value instanceof s?Promise.resolve(r.value.v).then(u,l):h(o[0][2],r)}catch(e){h(o[0][3],e)}}function u(e){c("next",e)}function l(e){c("throw",e)}function h(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListerImpl=void 0;class n{constructor(e,t,r,s){if(!e)throw Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=s||{}}next(){return r(this,void 0,void 0,function*(){if(this.err||this.pageInfo&&this.offset>=this.pageInfo.total)return[];let e={offset:this.offset};this.payload&&Object.assign(e,this.payload);try{let t=yield this.jsm._request(this.subject,e,{timeout:this.jsm.timeout});this.pageInfo=t;let r=this.countResponse(t);if(0===r)return[];return this.offset+=r,this.filter(t)}catch(e){throw this.err=e,e}})}countResponse(e){var t,r,s;switch(null==e?void 0:e.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return(null===(t=e.streams)||void 0===t?void 0:t.length)||0;case"io.nats.jetstream.api.v1.consumer_list_response":return(null===(r=e.consumers)||void 0===r?void 0:r.length)||0;default:return console.error(`jslister.ts: unknown API response for paged output: ${null==e?void 0:e.type}`),(null===(s=e.streams)||void 0===s?void 0:s.length)||0}return 0}[Symbol.asyncIterator](){return i(this,arguments,function*(){let e=yield s(this.next());for(;e.length>0;){for(let t of e)yield yield s(t);e=yield s(this.next())}})}}t.ListerImpl=n},36677:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.JetStreamManagerImpl=t.DirectMsgImpl=t.DirectStreamAPIImpl=void 0;let n=r(18231),o=r(575),a=r(7773),c=r(35611),u=r(72569),l=r(45067),h=r(82577),d=r(97636),f=r(25952);class p extends n.BaseApiClient{constructor(e,t){super(e,t)}getMessage(e,t){return s(this,void 0,void 0,function*(){(0,h.validateStreamName)(e);let r=t,{last_by_subj:s}=r;s&&(r=null);let i=r?this.jc.encode(r):d.Empty,n=this.opts.apiPrefix||"$JS.API",o=s?`${n}.DIRECT.GET.${e}.${s}`:`${n}.DIRECT.GET.${e}`,a=yield this.nc.request(o,i,{timeout:this.timeout}),c=(0,h.checkJsError)(a);return c?Promise.reject(c):Promise.resolve(new m(a))})}getBatch(e,t){return s(this,void 0,void 0,function*(){(0,h.validateStreamName)(e);let r=this.opts.apiPrefix||"$JS.API",n=`${r}.DIRECT.GET.${e}`;if(!Array.isArray(t.multi_last)||0===t.multi_last.length)return Promise.reject("multi_last is required");let o=JSON.stringify(t,(e,t)=>"up_to_time"===e&&t instanceof Date?t.toISOString():t),a=new c.QueuedIteratorImpl,u=yield this.nc.requestMany(n,o,{strategy:l.RequestStrategy.SentinelMsg});return s(this,void 0,void 0,function*(){let e;let t=!1,r=!1;try{for(var s,n,o,c,l,h,d,f,p=!0,y=i(u);!(s=(f=yield y.next()).done);p=!0){if(c=f.value,p=!1,!t){t=!0;let s=(null===(l=c.headers)||void 0===l?void 0:l.code)||0;if(0!==s&&s<200||s>299){e=null===(h=c.headers)||void 0===h?void 0:h.description.toLowerCase();break}let i=null===(d=c.headers)||void 0===d?void 0:d.get("Nats-Num-Pending");if(""===i){r=!0;break}}if(0===c.data.length)break;a.push(new m(c))}}catch(e){n={error:e}}finally{try{!p&&!s&&(o=y.return)&&(yield o.call(y))}finally{if(n)throw n.error}}a.push(()=>{if(r)throw Error("batch direct get not supported by the server");if(e)throw Error(`bad request: ${e}`);a.stop()})}),Promise.resolve(a)})}}t.DirectStreamAPIImpl=p;class m{constructor(e){if(!e.headers)throw Error("headers expected");this.data=e.data,this.header=e.headers}get subject(){return this.header.last(u.DirectMsgHeaders.Subject)}get seq(){let e=this.header.last(u.DirectMsgHeaders.Sequence);return"string"==typeof e?parseInt(e):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.last(u.DirectMsgHeaders.TimeStamp)}get stream(){return this.header.last(u.DirectMsgHeaders.Stream)}json(e){return(0,f.JSONCodec)(e).decode(this.data)}string(){return d.TD.decode(this.data)}}t.DirectMsgImpl=m;class y extends n.BaseApiClient{constructor(e,t){super(e,t),this.streams=new o.StreamAPIImpl(e,t),this.consumers=new a.ConsumerAPIImpl(e,t),this.direct=new p(e,t)}getAccountInfo(){return s(this,void 0,void 0,function*(){return yield this._request(`${this.prefix}.INFO`)})}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){let e=new c.QueuedIteratorImpl;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{let t=this.parseJsResponse(r),s=t.type.split("."),i=s[s.length-1];e.push({kind:i,data:t})}catch(t){e.stop(t)}}}),e}}t.JetStreamManagerImpl=y},7773:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumerAPIImpl=void 0;let i=r(18231),n=r(49170),o=r(82577),a=r(63248),c=r(13858);class u extends i.BaseApiClient{constructor(e,t){super(e,t)}add(e,t){return s(this,arguments,void 0,function*(e,t,r=c.ConsumerApiAction.Create){var s,i,n;let u;if((0,o.validateStreamName)(e),t.deliver_group&&t.flow_control)throw Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw Error("jetstream idle heartbeat is not supported with queue groups");let l={};l.config=t,l.stream_name=e,l.action=r,l.config.durable_name&&(0,o.validateDurableName)(l.config.durable_name);let h=this.nc,{min:d,ok:f}=h.features.get(a.Feature.JS_NEW_CONSUMER_CREATE_API),p=""===t.name?void 0:t.name;if(p&&!f)throw Error(`consumer 'name' requires server ${d}`);if(p)try{(0,o.minValidation)("name",p)}catch(r){let e=r.message,t=e.indexOf("cannot contain");if(-1!==t)throw Error(`consumer 'name' ${e.substring(t)}`);throw r}let m="";if(Array.isArray(t.filter_subjects)){let{min:e,ok:t}=h.features.get(a.Feature.JS_MULTIPLE_CONSUMER_FILTER);if(!t)throw Error(`consumer 'filter_subjects' requires server ${e}`);f=!1}if(t.metadata){let{min:e,ok:t}=h.features.get(a.Feature.JS_STREAM_CONSUMER_METADATA);if(!t)throw Error(`consumer 'metadata' requires server ${e}`)}if(f&&(m=null!==(i=null!==(s=t.name)&&void 0!==s?s:t.durable_name)&&void 0!==i?i:""),""!==m){let r=null!==(n=t.filter_subject)&&void 0!==n?n:void 0;">"===r&&(r=void 0),u=void 0!==r?`${this.prefix}.CONSUMER.CREATE.${e}.${m}.${r}`:`${this.prefix}.CONSUMER.CREATE.${e}.${m}`}else u=t.durable_name?`${this.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${this.prefix}.CONSUMER.CREATE.${e}`;return yield this._request(u,l)})}update(e,t,r){return s(this,void 0,void 0,function*(){let s=yield this.info(e,t);return this.add(e,Object.assign(s.config,r),c.ConsumerApiAction.Update)})}info(e,t){return s(this,void 0,void 0,function*(){return(0,o.validateStreamName)(e),(0,o.validateDurableName)(t),yield this._request(`${this.prefix}.CONSUMER.INFO.${e}.${t}`)})}delete(e,t){return s(this,void 0,void 0,function*(){return(0,o.validateStreamName)(e),(0,o.validateDurableName)(t),(yield this._request(`${this.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})}list(e){(0,o.validateStreamName)(e);let t=`${this.prefix}.CONSUMER.LIST.${e}`;return new n.ListerImpl(t,e=>e.consumers,this)}pause(e,t,r){let s=`${this.prefix}.CONSUMER.PAUSE.${e}.${t}`,i={pause_until:r.toISOString()};return this._request(s,i)}resume(e,t){return this.pause(e,t,new Date(0))}}t.ConsumerAPIImpl=u},46263:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.JsMsgImpl=t.ACK=void 0,t.toJsMsg=function(e,t=5e3){return new m(e,t)},t.parseInfo=p;let i=r(5364),n=r(25952),o=r(55102),a=r(31606),c=r(3009);t.ACK=Uint8Array.of(43,65,67,75);let u=Uint8Array.of(45,78,65,75),l=Uint8Array.of(43,87,80,73),h=Uint8Array.of(43,78,88,84),d=Uint8Array.of(43,84,69,82,77),f=Uint8Array.of(32);function p(e){let t=e.split(".");if(9===t.length&&t.splice(2,0,"_",""),t.length<11||"$JS"!==t[0]||"ACK"!==t[1])throw Error("not js message");let r={};return r.domain="_"===t[2]?"":t[2],r.account_hash=t[3],r.stream=t[4],r.consumer=t[5],r.deliveryCount=parseInt(t[6],10),r.redeliveryCount=r.deliveryCount,r.redelivered=r.deliveryCount>1,r.streamSequence=parseInt(t[7],10),r.deliverySequence=parseInt(t[8],10),r.timestampNanos=parseInt(t[9],10),r.pending=parseInt(t[10],10),r}class m{constructor(e,t){this.msg=e,this.didAck=!1,this.timeout=t}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=p(this.reply)),this.di}get redelivered(){return this.info.deliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===l[0]&&e[1]===l[1]&&e[2]===l[2]&&e[3]===l[3]}ackAck(e){return s(this,void 0,void 0,function*(){var r;(e=e||{}).timeout=e.timeout||this.timeout;let s=(0,a.deferred)();if(this.didAck)s.resolve(!1);else if(this.didAck=!0,this.msg.reply){let i=this.msg.publisher,n=!(null===(r=i.options)||void 0===r?void 0:r.noAsyncTraces),a=new o.RequestOne(i.muxSubscriptions,this.msg.reply,{timeout:e.timeout},n);i.request(a);try{i.publish(this.msg.reply,t.ACK,{reply:`${i.muxSubscriptions.baseInbox}${a.token}`})}catch(e){a.cancel(e)}try{yield Promise.race([a.timer,a.deferred]),s.resolve(!0)}catch(e){a.cancel(e),s.reject(e)}}else s.resolve(!1);return s})}ack(){this.doAck(t.ACK)}nak(e){let t=u;e&&(t=(0,n.StringCodec)().encode(`-NAK ${JSON.stringify({delay:(0,c.nanos)(e)})}`)),this.doAck(t)}working(){this.doAck(l)}next(e,t={batch:1}){let r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=(0,c.nanos)(t.expires));let s=(0,n.JSONCodec)().encode(r),o=i.DataBuffer.concat(h,f,s);this.msg.respond(o,e?{reply:e}:void 0)}term(e=""){let t=d;(null==e?void 0:e.length)>0&&(t=(0,n.StringCodec)().encode(`+TERM ${e}`)),this.doAck(t)}json(){return this.msg.json()}string(){return this.msg.string()}}t.JsMsgImpl=m},575:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.StreamsImpl=t.StoredMsgImpl=t.StreamAPIImpl=t.StreamImpl=t.ConsumersImpl=void 0,t.convertStreamSourceDomain=b;let i=r(91530),n=r(18231),o=r(49170),a=r(82577),c=r(24725),u=r(18791),l=r(3086),h=r(25952),d=r(97636),f=r(63248),p=r(72569),m=r(19172),y=r(7773);function b(e){if(void 0===e)return;let{domain:t}=e;if(void 0===t)return e;let r=Object.assign({},e);if(delete r.domain,""===t)return r;if(r.external)throw Error("domain and external are both set");return r.external={api:`$JS.${t}.API`},r}class g{constructor(e){this.api=e,this.notified=!1}checkVersion(){let e=this.api.nc.features.get(f.Feature.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(Error(`consumers framework is only supported on servers ${e.min} or better`))}getPullConsumerFor(e){if(void 0!==e.config.deliver_subject)throw Error("push consumer not supported");return new m.PullConsumerImpl(this.api,e)}get(e){return s(this,arguments,void 0,function*(e,t={}){return"object"==typeof t?this.ordered(e,t):(yield this.checkVersion(),this.api.info(e,t).then(e=>void 0!==e.config.deliver_subject?Promise.reject(Error("push consumer not supported")):new m.PullConsumerImpl(this.api,e)).catch(e=>Promise.reject(e)))})}ordered(e,t){return s(this,void 0,void 0,function*(){yield this.checkVersion();let r=this.api;return new _(r.nc,r.opts).info(e).then(r=>Promise.resolve(new m.OrderedPullConsumerImpl(this.api,e,t))).catch(e=>Promise.reject(e))})}}t.ConsumersImpl=g;class v{constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){return s(this,void 0,void 0,function*(){if(yield this.info(),!this._info.alternates)return this;{let e=yield this.api.info(this._info.alternates[0].name);return new v(this.api,e)}})}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(e=>(this._info=e,this._info))}getConsumerFromInfo(e){return new g(new y.ConsumerAPIImpl(this.api.nc,this.api.opts)).getPullConsumerFor(e)}getConsumer(e){return new g(new y.ConsumerAPIImpl(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}t.StreamImpl=v;class _ extends n.BaseApiClient{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){let t=this.nc;if(e.metadata){let{min:e,ok:r}=t.features.get(f.Feature.JS_STREAM_CONSUMER_METADATA);if(!r)throw Error(`stream 'metadata' requires server ${e}`)}if(e.first_seq){let{min:e,ok:r}=t.features.get(f.Feature.JS_STREAM_FIRST_SEQ);if(!r)throw Error(`stream 'first_seq' requires server ${e}`)}if(e.subject_transform){let{min:e,ok:r}=t.features.get(f.Feature.JS_STREAM_SUBJECT_TRANSFORM);if(!r)throw Error(`stream 'subject_transform' requires server ${e}`)}if(e.compression){let{min:e,ok:r}=t.features.get(f.Feature.JS_STREAM_COMPRESSION);if(!r)throw Error(`stream 'compression' requires server ${e}`)}if(e.consumer_limits){let{min:e,ok:r}=t.features.get(f.Feature.JS_DEFAULT_CONSUMER_LIMITS);if(!r)throw Error(`stream 'consumer_limits' requires server ${e}`)}function r(e,r){var s;if(((null===(s=null==r?void 0:r.subject_transforms)||void 0===s?void 0:s.length)||0)>0){let{min:r,ok:s}=t.features.get(f.Feature.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!s)throw Error(`${e} 'subject_transforms' requires server ${r}`)}}e.sources&&e.sources.forEach(e=>{r("stream sources",e)}),e.mirror&&r("stream mirror",e.mirror)}add(){return s(this,arguments,void 0,function*(e={}){var t;this.checkStreamConfigVersions(e),(0,a.validateStreamName)(e.name),e.mirror=b(e.mirror),e.sources=null===(t=e.sources)||void 0===t?void 0:t.map(b);let r=yield this._request(`${this.prefix}.STREAM.CREATE.${e.name}`,e);return this._fixInfo(r),r})}delete(e){return s(this,void 0,void 0,function*(){return(0,a.validateStreamName)(e),(yield this._request(`${this.prefix}.STREAM.DELETE.${e}`)).success})}update(e){return s(this,arguments,void 0,function*(e,t={}){var r;if("object"==typeof e){let r=e;e=r.name,t=r,console.trace(`\u001B[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \u001B[0m`)}this.checkStreamConfigVersions(t),(0,a.validateStreamName)(e);let s=Object.assign((yield this.info(e)).config,t);s.mirror=b(s.mirror),s.sources=null===(r=s.sources)||void 0===r?void 0:r.map(b);let i=yield this._request(`${this.prefix}.STREAM.UPDATE.${e}`,s);return this._fixInfo(i),i})}info(e,t){return s(this,void 0,void 0,function*(){(0,a.validateStreamName)(e);let r=`${this.prefix}.STREAM.INFO.${e}`,s=yield this._request(r,t),{total:i,limit:n}=s,o=s.state.subjects?Object.getOwnPropertyNames(s.state.subjects).length:1;if(i&&i>o){let e=[s],a=t||{},c=0;for(;i>o;){c++,a.offset=n*c;let t=yield this._request(r,a);i=t.total,e.push(t);let s=Object.getOwnPropertyNames(t.state.subjects).length;if(o+=s,s<n)break}let u={};for(let t=0;t<e.length;t++)(s=e[t]).state.subjects&&(u=Object.assign(u,s.state.subjects));s.offset=0,s.total=0,s.limit=0,s.state.subjects=u}return this._fixInfo(s),s})}list(e=""){let t=(null==e?void 0:e.length)?{subject:e}:{},r=`${this.prefix}.STREAM.LIST`;return new o.ListerImpl(r,e=>(e.streams.forEach(e=>{this._fixInfo(e)}),e.streams),this,t)}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){return s(this,void 0,void 0,function*(){if(t){let{keep:e,seq:r}=t;if("number"==typeof e&&"number"==typeof r)throw Error("can specify one of keep or seq")}return(0,a.validateStreamName)(e),yield this._request(`${this.prefix}.STREAM.PURGE.${e}`,t)})}deleteMessage(e,t){return s(this,arguments,void 0,function*(e,t,r=!0){(0,a.validateStreamName)(e);let s={seq:t};return r||(s.no_erase=!0),(yield this._request(`${this.prefix}.STREAM.MSG.DELETE.${e}`,s)).success})}getMessage(e,t){return s(this,void 0,void 0,function*(){return(0,a.validateStreamName)(e),new E((yield this._request(`${this.prefix}.STREAM.MSG.GET.${e}`,t)))})}find(e){return this.findStream(e)}listKvs(){let e=`${this.prefix}.STREAM.LIST`;return new o.ListerImpl(e,e=>{var t,r;let s=e.streams.filter(e=>e.config.name.startsWith(p.kvPrefix));s.forEach(e=>{this._fixInfo(e)});let i="";return s.length&&(i=null!==(r=null===(t=this.nc.info)||void 0===t?void 0:t.cluster)&&void 0!==r?r:""),s.map(e=>new u.KvStatusImpl(e,i))},this)}listObjectStores(){let e=`${this.prefix}.STREAM.LIST`;return new o.ListerImpl(e,e=>{let t=e.streams.filter(e=>e.config.name.startsWith(l.osPrefix));return t.forEach(e=>{this._fixInfo(e)}),t.map(e=>new l.ObjectStoreStatusImpl(e))},this)}names(e=""){let t=(null==e?void 0:e.length)?{subject:e}:{},r=`${this.prefix}.STREAM.NAMES`;return new o.ListerImpl(r,e=>e.streams,this,t)}get(e){return s(this,void 0,void 0,function*(){return Promise.resolve(new v(this,(yield this.info(e))))})}}t.StreamAPIImpl=_;class E{constructor(e){this.smr=e}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):i.Empty}get header(){if(!this._header){if(this.smr.message.hdrs){let e=this._parse(this.smr.message.hdrs);this._header=c.MsgHdrsImpl.decode(e)}else this._header=(0,c.headers)()}return this._header}_parse(e){let t=atob(e),r=t.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=t.charCodeAt(e);return s}json(e){return(0,h.JSONCodec)(e).decode(this.data)}string(){return d.TD.decode(this.data)}}t.StoredMsgImpl=E;class S{constructor(e){this.api=e}get(e){return this.api.info(e).then(e=>new v(this.api,e))}}t.StreamsImpl=S},82577:(e,t,r)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.Js409Errors=void 0,t.validateDurableName=function(e){return c("durable",e)},t.validateStreamName=function(e){return c("stream",e)},t.minValidation=c,t.validateName=function(e,t=""){if(""===t)throw Error(`${e} name required`);let r=u(t);if(r.length)throw Error(`invalid ${e} name - ${e} name ${r}`)},t.validName=u,t.isFlowControlMsg=l,t.isHeartbeatMsg=function(e){var t;return l(e)&&(null===(t=e.headers)||void 0===t?void 0:t.description)==="Idle Heartbeat"},t.newJsErrorMsg=function(e,t,r){let s=(0,n.headers)(e,t),a=new o.MsgImpl({hdr:1,sid:0,size:0},i.Empty,{});return a._headers=s,a._subject=r,a},t.checkJsError=function(e){if(0!==e.data.length)return null;let t=e.headers;return t?d(t.code,t.description):null},t.setMaxWaitingToFail=function(e){h=e},t.isTerminal409=function(e){if(e.code!==a.ErrorCode.JetStream409)return!1;let t=[s.MaxBatchExceeded,s.MaxExpiresExceeded,s.MaxBytesExceeded,s.MaxMessageSizeExceeded,s.PushConsumer,s.IdleHeartbeatMissed,s.ConsumerDeleted];return h&&t.push(s.MaxWaitingExceeded),void 0!==t.find(t=>-1!==e.message.indexOf(t))},t.checkJsErrorCode=d;let i=r(97636),n=r(24725),o=r(66348),a=r(45067);function c(e,t=""){if(""===t)throw Error(`${e} name required`);return[".","*",">","/","\\"," ","	","\n","\r"].forEach(r=>{if(-1!==t.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"	":r="\\t"}throw Error(`invalid ${e} name - ${e} name cannot contain '${r}'`)}}),""}function u(e=""){if(""===e)throw Error("name required");let t=/^[-\w]+$/g;if(null===e.match(t)){for(let r of e.split(""))if(null===r.match(t))return`cannot contain '${r}'`}return""}function l(e){if(e.data.length>0)return!1;let t=e.headers;return!!t&&t.code>=100&&t.code<200}!function(e){e.MaxBatchExceeded="exceeded maxrequestbatch of",e.MaxExpiresExceeded="exceeded maxrequestexpires of",e.MaxBytesExceeded="exceeded maxrequestmaxbytes of",e.MaxMessageSizeExceeded="message size exceeds maxbytes",e.PushConsumer="consumer is push based",e.MaxWaitingExceeded="exceeded maxwaiting",e.IdleHeartbeatMissed="idle heartbeats missed",e.ConsumerDeleted="consumer deleted"}(s||(t.Js409Errors=s={}));let h=!1;function d(e,t=""){if(e<300)return null;switch(t=t.toLowerCase(),e){case 404:return new a.NatsError(t,a.ErrorCode.JetStream404NoMessages);case 408:return new a.NatsError(t,a.ErrorCode.JetStream408RequestTimeout);case 409:{let e=t.startsWith(s.IdleHeartbeatMissed)?a.ErrorCode.JetStreamIdleHeartBeat:a.ErrorCode.JetStream409;return new a.NatsError(t,e)}case 503:return a.NatsError.errorForCode(a.ErrorCode.JetStreamNotEnabled,Error(t));default:return""===t&&(t=a.ErrorCode.Unknown),new a.NatsError(t,`${e}`)}}},18791:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.KvStatusImpl=t.Bucket=t.kvOperationHdr=void 0,t.Base64KeyCodec=function(){return{encode:e=>btoa(e),decode:e=>atob(e)}},t.NoopKvCodecs=m,t.defaultBucketOpts=y,t.validateKey=_,t.validateSearchKey=E,t.hasWildcards=S,t.validateBucket=P;let n=r(45067),o=r(35611),a=r(24725),c=r(72569),u=r(63248),l=r(3009),h=r(97636),d=r(13858),f=r(66426),p=r(27723);function m(){return{key:{encode:e=>e,decode:e=>e},value:{encode:e=>e,decode:e=>e}}}function y(){return{replicas:1,history:1,timeout:2e3,max_bytes:-1,maxValueSize:-1,codec:m(),storage:d.StorageType.File}}t.kvOperationHdr="KV-Operation";let b=/^[-/=.\w]+$/,g=/^[-/=.>*\w]+$/,v=/^[-\w]+$/;function _(e){if(e.startsWith(".")||e.endsWith(".")||!b.test(e))throw Error(`invalid key: ${e}`)}function E(e){if(e.startsWith(".")||e.endsWith(".")||!g.test(e))throw Error(`invalid key: ${e}`)}function S(e){if(e.startsWith(".")||e.endsWith("."))throw Error(`invalid key: ${e}`);let t=e.split("."),r=!1;for(let s=0;s<t.length;s++)switch(t[s]){case"*":r=!0;break;case">":if(s!==t.length-1)throw Error(`invalid key: ${e}`);r=!0}return r}function P(e){if(!v.test(e))throw Error(`invalid bucket name: ${e}`)}class w{constructor(e,t,r){this.validateKey=_,this.validateSearchKey=E,this.hasWildcards=S,P(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t){return s(this,arguments,void 0,function*(e,t,r={}){P(t);let s=yield e.jetstreamManager(),i=new w(t,e,s);return yield i.init(r),i})}static bind(e,t){return s(this,arguments,void 0,function*(e,t,r={}){var s,i;let n=yield e.jetstreamManager(),o={config:{allow_direct:r.allow_direct}};P(t);let a=new w(t,e,n);return o.config.name=null!==(s=r.streamName)&&void 0!==s?s:a.bucketName(),Object.assign(a,o),a.stream=o.config.name,a.codec=r.codec||m(),a.direct=null!==(i=o.config.allow_direct)&&void 0!==i&&i,a.initializePrefixes(o),a})}init(){return s(this,arguments,void 0,function*(e={}){var t,r;let s;let i=Object.assign(y(),e);this.codec=i.codec;let n={};this.stream=n.name=null!==(t=e.streamName)&&void 0!==t?t:this.bucketName(),n.retention=d.RetentionPolicy.Limits,n.max_msgs_per_subject=i.history,i.maxBucketSize&&(i.max_bytes=i.maxBucketSize),i.max_bytes&&(n.max_bytes=i.max_bytes),n.max_msg_size=i.maxValueSize,n.storage=i.storage;let o=null!==(r=e.placementCluster)&&void 0!==r?r:"";if(o&&(e.placement={},e.placement.cluster=o,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){let t=Object.assign({},e.mirror);t.name.startsWith(c.kvPrefix)||(t.name=`${c.kvPrefix}${t.name}`),n.mirror=t,n.mirror_direct=!0}else if(e.sources){let t=e.sources.map(e=>{let t=Object.assign({},e),r=t.name.startsWith(c.kvPrefix)?t.name.substring(c.kvPrefix.length):t.name;return t.name.startsWith(c.kvPrefix)||(t.name=`${c.kvPrefix}${t.name}`),e.external||r===this.bucket||(t.subject_transforms=[{src:`$KV.${r}.>`,dest:`$KV.${this.bucket}.>`}]),t});n.sources=t,n.subjects=[this.subjectForBucket()]}else n.subjects=[this.subjectForBucket()];e.metadata&&(n.metadata=e.metadata),"boolean"==typeof e.compression&&(n.compression=e.compression?d.StoreCompression.S2:d.StoreCompression.None);let a=this.js.nc,h=a.getServerVersion(),f=!!h&&(0,u.compare)(h,(0,u.parseSemVer)("2.7.2"))>=0;n.discard=f?d.DiscardPolicy.New:d.DiscardPolicy.Old;let{ok:p,min:m}=a.features.get(u.Feature.JS_ALLOW_DIRECT);if(!p&&!0===e.allow_direct){let e=h?`${h.major}.${h.minor}.${h.micro}`:"unknown";return Promise.reject(Error(`allow_direct is not available on server version ${e} - requires ${m}`))}e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:p,n.allow_direct=e.allow_direct,this.direct=n.allow_direct,n.num_replicas=i.replicas,i.ttl&&(n.max_age=(0,l.nanos)(i.ttl)),n.allow_rollup_hdrs=!0;try{(s=yield this.jsm.streams.info(n.name)).config.allow_direct||!0!==this.direct||(this.direct=!1)}catch(e){if("stream not found"===e.message)s=yield this.jsm.streams.add(n);else throw e}this.initializePrefixes(s)})}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;let{mirror:t}=e.config;if(t){let e=t.name;if(e.startsWith(c.kvPrefix)&&(e=e.substring(c.kvPrefix.length)),t.external&&""!==t.external.api){let r=t.name.substring(c.kvPrefix.length);this.useJsPrefix=!1,this.prefix=`$KV.${r}`,this.editPrefix=`${t.external.api}.$KV.${e}`}else this.editPrefix=this.prefix}}bucketName(){var e;return null!==(e=this.stream)&&void 0!==e?e:`${c.kvPrefix}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){let r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),""!==this.editPrefix?r.push(this.editPrefix):r.push(this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){let t=[];for(let r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){let t=[];for(let r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}close(){return Promise.resolve()}dataLen(e,t){let r=t&&t.get(c.JsHeaders.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new O(this.bucket,this.prefixLen,e)}jmToEntry(e){let t=this.decodeKey(e.subject.substring(this.prefixLen));return new A(this.bucket,t,e)}create(e,t){return s(this,void 0,void 0,function*(){var r;let s;try{let r=yield this.put(e,t,{previousSeq:0});return Promise.resolve(r)}catch(e){if(s=e,(null===(r=null==e?void 0:e.api_error)||void 0===r?void 0:r.err_code)!==10071)return Promise.reject(e)}let i=0;try{let r=yield this.get(e);if((null==r?void 0:r.operation)==="DEL"||(null==r?void 0:r.operation)==="PURGE")return i=null!==r?r.revision:0,this.update(e,t,i);return Promise.reject(s)}catch(e){return Promise.reject(e)}})}update(e,t,r){if(r<=0)throw Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}put(e,t){return s(this,arguments,void 0,function*(e,t,r={}){var s,i;let n=this.encodeKey(e);this.validateKey(n);let o={};if(void 0!==r.previousSeq){let e=(0,a.headers)();o.headers=e,e.set(f.PubHeaders.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(yield this.js.publish(this.subjectForKey(n,!0),t,o)).seq}catch(e){if(e.isJetStreamError())return e.message=null===(s=e.api_error)||void 0===s?void 0:s.description,e.code=`${null===(i=e.api_error)||void 0===i?void 0:i.code}`,Promise.reject(e);return Promise.reject(e)}})}get(e,t){return s(this,void 0,void 0,function*(){let r;let s=this.encodeKey(e);this.validateKey(s);let i={last_by_subj:this.subjectForKey(s)};t&&t.revision>0&&(i={seq:t.revision});try{if(this.direct){let e=this.jsm.direct;r=yield e.getMessage(this.bucketName(),i)}else r=yield this.jsm.streams.getMessage(this.bucketName(),i);let e=this.smToEntry(r);if(e.key!==s)return null;return e}catch(e){if(e.code===n.ErrorCode.JetStream404NoMessages)return null;throw e}})}purge(e,t){return this._deleteOrPurge(e,"PURGE",t)}delete(e,t){return this._deleteOrPurge(e,"DEL",t)}purgeDeletes(){return s(this,arguments,void 0,function*(e=18e5){let t=(0,l.deferred)(),r=[],n=yield this.watch({key:">",initializedFn:()=>{t.resolve()}});s(this,void 0,void 0,function*(){var e,t,s,o;try{for(var a,c=!0,u=i(n);!(e=(a=yield u.next()).done);c=!0)o=a.value,c=!1,("DEL"===o.operation||"PURGE"===o.operation)&&r.push(o)}catch(e){t={error:e}}finally{try{!c&&!e&&(s=u.return)&&(yield s.call(u))}finally{if(t)throw t.error}}}).then(),yield t,n.stop();let o=Date.now()-e,a=r.map(e=>{let t=this.subjectForKey(e.key);return e.created.getTime()>=o?this.jsm.streams.purge(this.stream,{filter:t,keep:1}):this.jsm.streams.purge(this.stream,{filter:t,keep:0})}),c=yield Promise.all(a);return c.unshift({success:!0,purged:0}),c.reduce((e,t)=>(e.purged+=t.purged,e))})}_deleteOrPurge(e,t,r){return s(this,void 0,void 0,function*(){var s,n,o,a;if(!this.hasWildcards(e))return this._doDeleteOrPurge(e,t,r);let c=yield this.keys(e),u=[];try{for(var l,h=!0,d=i(c);!(s=(l=yield d.next()).done);h=!0)a=l.value,h=!1,u.push(this._doDeleteOrPurge(a,t)),100===u.length&&(yield Promise.all(u),u.length=0)}catch(e){n={error:e}}finally{try{!h&&!s&&(o=d.return)&&(yield o.call(d))}finally{if(n)throw n.error}}u.length>0&&(yield Promise.all(u))})}_doDeleteOrPurge(e,r,i){return s(this,void 0,void 0,function*(){let s=this.encodeKey(e);this.validateKey(s);let n=(0,a.headers)();n.set(t.kvOperationHdr,r),"PURGE"===r&&n.set(c.JsHeaders.RollupHdr,c.JsHeaders.RollupValueSubject),(null==i?void 0:i.previousSeq)&&n.set(f.PubHeaders.ExpectedLastSubjectSequenceHdr,`${i.previousSeq}`),yield this.js.publish(this.subjectForKey(s,!0),h.Empty,{headers:n})})}_buildCC(e,t,r={}){let s,i=(Array.isArray(e)?e:[e]).map(e=>{let t=this.encodeKey(e);return this.validateSearchKey(e),this.fullKeyName(t)}),n=d.DeliverPolicy.LastPerSubject;return t===c.KvWatchInclude.AllHistory&&(n=d.DeliverPolicy.All),t===c.KvWatchInclude.UpdatesOnly&&(n=d.DeliverPolicy.New),1===i.length&&(s=i[0],i=void 0),Object.assign({deliver_policy:n,ack_policy:d.AckPolicy.None,filter_subjects:i,filter_subject:s,flow_control:!0,idle_heartbeat:(0,l.nanos)(5e3)},r)}remove(e){return this.purge(e)}history(){return s(this,arguments,void 0,function*(e={}){var t;let r;let s=null!==(t=e.key)&&void 0!==t?t:">",i=new o.QueuedIteratorImpl,n={};n.headers_only=e.headers_only||!1,r=()=>{i.stop()};let a=0,u=this._buildCC(s,c.KvWatchInclude.AllHistory,n),l=u.filter_subject,h=(0,c.consumerOpts)(u);h.bindStream(this.stream),h.orderedConsumer(),h.callback((e,t)=>{if(e){i.stop(e);return}if(t){let e=this.jmToEntry(t);i.push(e),i.received++,(r&&a>0&&i.received>=a||0===t.info.pending)&&(i.push(r),r=void 0)}});let d=yield this.js.subscribe(l,h);if(r){let{info:{last:e}}=d,t=e.num_pending+e.delivered.consumer_seq;if(0===t||i.received>=t)try{r()}catch(e){i.stop(e)}finally{r=void 0}else a=t}return i._data=d,i.iterClosed.then(()=>{d.unsubscribe()}),d.closed.then(()=>{i.stop()}).catch(e=>{i.stop(e)}),i})}canSetWatcherName(){let{ok:e}=this.js.nc.features.get(u.Feature.JS_NEW_CONSUMER_CREATE_API);return e}watch(){return s(this,arguments,void 0,function*(e={}){var t;let r=null!==(t=e.key)&&void 0!==t?t:">",s=new o.QueuedIteratorImpl,i={};i.headers_only=e.headers_only||!1;let n=c.KvWatchInclude.LastValue;e.include===c.KvWatchInclude.AllHistory?n=c.KvWatchInclude.AllHistory:e.include===c.KvWatchInclude.UpdatesOnly&&(n=c.KvWatchInclude.UpdatesOnly);let a=!0===e.ignoreDeletes,u=e.initializedFn,l=0,h=this._buildCC(r,n,i),d=h.filter_subject,f=(0,c.consumerOpts)(h);this.canSetWatcherName()&&f.consumerName(p.nuid.next()),f.bindStream(this.stream),e.resumeFromRevision&&e.resumeFromRevision>0&&f.startSequence(e.resumeFromRevision),f.orderedConsumer(),f.callback((e,t)=>{if(e){s.stop(e);return}if(t){let e=this.jmToEntry(t);if(a&&"DEL"===e.operation)return;s.push(e),s.received++,u&&(l>0&&s.received>=l||0===t.info.pending)&&(s.push(u),u=void 0)}});let m=yield this.js.subscribe(d,f);if(u){let{info:{last:e}}=m,t=e.num_pending+e.delivered.consumer_seq;if(0===t||s.received>=t)try{u()}catch(e){s.stop(e)}finally{u=void 0}else l=t}return s._data=m,s.iterClosed.then(()=>{m.unsubscribe()}),m.closed.then(()=>{s.stop()}).catch(e=>{s.stop(e)}),s})}keys(){return s(this,arguments,void 0,function*(e=">"){let r=new o.QueuedIteratorImpl,n=this._buildCC(e,c.KvWatchInclude.LastValue,{headers_only:!0}),a=Array.isArray(e)?">":n.filter_subject,u=(0,c.consumerOpts)(n);u.bindStream(this.stream),u.orderedConsumer();let l=yield this.js.subscribe(a,u);return s(this,void 0,void 0,function*(){try{for(var e,s,n,o,a,c,u=!0,h=i(l);!(e=(c=yield h.next()).done);u=!0){o=c.value,u=!1;let e=null===(a=o.headers)||void 0===a?void 0:a.get(t.kvOperationHdr);if("DEL"!==e&&"PURGE"!==e){let e=this.decodeKey(o.subject.substring(this.prefixLen));r.push(e)}0===o.info.pending&&l.unsubscribe()}}catch(e){s={error:e}}finally{try{!u&&!e&&(n=h.return)&&(yield n.call(h))}finally{if(s)throw s.error}}}).then(()=>{r.stop()}).catch(e=>{r.stop(e)}),0===l.info.last.num_pending&&l.unsubscribe(),r})}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){return s(this,void 0,void 0,function*(){var e,t;let r=null!==(t=null===(e=this.js.nc.info)||void 0===e?void 0:e.cluster)&&void 0!==t?t:"",s=this.bucketName();return new C((yield this.jsm.streams.info(s)),r)})}}t.Bucket=w;class C{constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(c.kvPrefix)?this.si.config.name.substring(c.kvPrefix.length):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return(0,l.millis)(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){var e;return null!==(e=this.si.config.description)&&void 0!==e?e:""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){var e,t;return null!==(t=null===(e=this.si.config.placement)||void 0===e?void 0:e.cluster)&&void 0!==t?t:""}get republish(){var e;return null!==(e=this.si.config.republish)&&void 0!==e?e:{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){var e;return null!==(e=this.si.config.metadata)&&void 0!==e?e:{}}get compression(){return!!this.si.config.compression&&this.si.config.compression!==d.StoreCompression.None}}t.KvStatusImpl=C;class O{constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(t.kvOperationHdr)||"PUT"}get length(){let e=this.sm.header.get(c.JsHeaders.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class A{constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date((0,l.millis)(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){var e;return(null===(e=this.sm.headers)||void 0===e?void 0:e.get(t.kvOperationHdr))||"PUT"}get delta(){return this.sm.info.pending}get length(){var e;let t=(null===(e=this.sm.headers)||void 0===e?void 0:e.get(c.JsHeaders.MessageSizeHdr))||"";return""!==t?parseInt(t,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}},56069:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.consumerOpts=t.StoreCompression=t.StorageType=t.RetentionPolicy=t.RepublishHeaders=t.ReplayPolicy=t.KvWatchInclude=t.JsHeaders=t.DiscardPolicy=t.DirectMsgHeaders=t.DeliverPolicy=t.ConsumerEvents=t.ConsumerDebugEvents=t.AdvisoryKind=t.AckPolicy=t.isHeartbeatMsg=t.isFlowControlMsg=t.checkJsError=void 0;var s=r(78172);Object.defineProperty(t,"checkJsError",{enumerable:!0,get:function(){return s.checkJsError}}),Object.defineProperty(t,"isFlowControlMsg",{enumerable:!0,get:function(){return s.isFlowControlMsg}}),Object.defineProperty(t,"isHeartbeatMsg",{enumerable:!0,get:function(){return s.isHeartbeatMsg}});var i=r(78172);Object.defineProperty(t,"AckPolicy",{enumerable:!0,get:function(){return i.AckPolicy}}),Object.defineProperty(t,"AdvisoryKind",{enumerable:!0,get:function(){return i.AdvisoryKind}}),Object.defineProperty(t,"ConsumerDebugEvents",{enumerable:!0,get:function(){return i.ConsumerDebugEvents}}),Object.defineProperty(t,"ConsumerEvents",{enumerable:!0,get:function(){return i.ConsumerEvents}}),Object.defineProperty(t,"DeliverPolicy",{enumerable:!0,get:function(){return i.DeliverPolicy}}),Object.defineProperty(t,"DirectMsgHeaders",{enumerable:!0,get:function(){return i.DirectMsgHeaders}}),Object.defineProperty(t,"DiscardPolicy",{enumerable:!0,get:function(){return i.DiscardPolicy}}),Object.defineProperty(t,"JsHeaders",{enumerable:!0,get:function(){return i.JsHeaders}}),Object.defineProperty(t,"KvWatchInclude",{enumerable:!0,get:function(){return i.KvWatchInclude}}),Object.defineProperty(t,"ReplayPolicy",{enumerable:!0,get:function(){return i.ReplayPolicy}}),Object.defineProperty(t,"RepublishHeaders",{enumerable:!0,get:function(){return i.RepublishHeaders}}),Object.defineProperty(t,"RetentionPolicy",{enumerable:!0,get:function(){return i.RetentionPolicy}}),Object.defineProperty(t,"StorageType",{enumerable:!0,get:function(){return i.StorageType}}),Object.defineProperty(t,"StoreCompression",{enumerable:!0,get:function(){return i.StoreCompression}});var n=r(72569);Object.defineProperty(t,"consumerOpts",{enumerable:!0,get:function(){return n.consumerOpts}})},3086:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStoreImpl=t.ObjectStoreStatusImpl=t.digestType=t.osPrefix=void 0,t.objectStoreStreamName=g,t.objectStoreBucketName=v;let n=r(18791),o=r(15869),a=r(25952),c=r(27723),u=r(3009),l=r(5364),h=r(24725),d=r(72569),f=r(35611),p=r(3943),m=r(13858),y=r(66426),b=r(95197);function g(e){return(0,n.validateBucket)(e),`${t.osPrefix}${e}`}function v(e){return e.startsWith(t.osPrefix)?e.substring(4):e}t.osPrefix="OBJ_",t.digestType="SHA-256=";class _{constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return v(this.si.config.name)}get description(){var e;return null!==(e=this.si.config.description)&&void 0!==e?e:""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}get compression(){return!!this.si.config.compression&&this.si.config.compression!==m.StoreCompression.None}}t.ObjectStoreStatusImpl=_;class E{constructor(e){this.info=e}get name(){return this.info.name}get description(){var e;return null!==(e=this.info.description)&&void 0!==e?e:""}get headers(){return this.hdrs||(this.hdrs=h.MsgHdrsImpl.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){var e;return null!==(e=this.info.deleted)&&void 0!==e&&e}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){var e,t;return(null===(e=this.info.options)||void 0===e?void 0:e.link)!==void 0&&(null===(t=this.info.options)||void 0===t?void 0:t.link)!==null}}function S(e){var t;let r={name:e.name,description:null!==(t=e.description)&&void 0!==t?t:"",options:e.options,metadata:e.metadata};if(e.headers){let t=e.headers;r.headers=t.toRecord()}return r}class P{constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:Error("name cannot be empty")}}info(e){return s(this,void 0,void 0,function*(){let t=yield this.rawInfo(e);return t?new E(t):null})}list(){return s(this,void 0,void 0,function*(){var e,t,r,s;let n=[],o=yield this.watch({ignoreDeletes:!0,includeHistory:!0});try{for(var a,c=!0,u=i(o);!(e=(a=yield u.next()).done)&&(s=a.value,c=!1,null!==s);c=!0)n.push(s)}catch(e){t={error:e}}finally{try{!c&&!e&&(r=u.return)&&(yield r.call(u))}finally{if(t)throw t.error}}return Promise.resolve(n)})}rawInfo(e){return s(this,void 0,void 0,function*(){let{name:t,error:r}=this._checkNotEmpty(e);if(r)return Promise.reject(r);let s=this._metaSubject(t);try{let e=yield this.jsm.streams.getMessage(this.stream,{last_by_subj:s}),t=(0,a.JSONCodec)().decode(e.data);return t.revision=e.seq,t}catch(e){if("404"===e.code)return null;return Promise.reject(e)}})}_si(e){return s(this,void 0,void 0,function*(){try{return yield this.jsm.streams.info(this.stream,e)}catch(e){if("404"===e.code)return null;return Promise.reject(e)}})}seal(){return s(this,void 0,void 0,function*(){let e=yield this._si();return null===e?Promise.reject(Error("object store not found")):(e.config.sealed=!0,Promise.resolve(new _(e=yield this.jsm.streams.update(this.stream,e.config))))})}status(e){return s(this,void 0,void 0,function*(){let t=yield this._si(e);return null===t?Promise.reject(Error("object store not found")):Promise.resolve(new _(t))})}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,r,i){return s(this,void 0,void 0,function*(){var s,n;let f=this.js.getOptions();(i=i||{timeout:f.timeout}).timeout=i.timeout||f.timeout,i.previousRevision=null!==(s=i.previousRevision)&&void 0!==s?s:void 0;let{timeout:m,previousRevision:b}=i,g=this.js.nc.info,v=(null==g?void 0:g.max_payload)||1024;(e=e||{}).options=e.options||{};let _=(null===(n=e.options)||void 0===n?void 0:n.max_chunk_size)||131072;_=_>v?v:_,e.options.max_chunk_size=_;let P=yield this.info(e.name),{name:w,error:C}=this._checkNotEmpty(e.name);if(C)return Promise.reject(C);let O=c.nuid.next(),A=this._chunkSubject(O),x=this._metaSubject(w),j=Object.assign({bucket:this.name,nuid:O,size:0,chunks:0},S(e)),I=(0,u.deferred)(),N=[],k=new l.DataBuffer;try{let s=r?r.getReader():null,i=p.sha256.create();for(;;){let{done:r,value:n}=s?yield s.read():{done:!0,value:void 0};if(r){if(k.size()>0){let e=k.drain();i.update(e),j.chunks++,j.size+=e.length,N.push(this.js.publish(A,e,{timeout:m}))}yield Promise.all(N),N.length=0,j.mtime=new Date().toISOString();let e=o.Base64UrlPaddedCodec.encode(i.digest());j.digest=`${t.digestType}${e}`,j.deleted=!1;let r=(0,h.headers)();"number"==typeof b&&r.set(y.PubHeaders.ExpectedLastSubjectSequenceHdr,`${b}`),r.set(d.JsHeaders.RollupHdr,d.JsHeaders.RollupValueSubject);let s=yield this.js.publish(x,(0,a.JSONCodec)().encode(j),{headers:r,timeout:m});if(j.revision=s.seq,P)try{yield this.jsm.streams.purge(this.stream,{filter:`$O.${this.name}.C.${P.nuid}`})}catch(e){}I.resolve(new E(j));break}if(n)for(k.fill(n);k.size()>_;){j.chunks++,j.size+=_;let t=k.drain(e.options.max_chunk_size);i.update(t),N.push(this.js.publish(A,t,{timeout:m}))}}}catch(e){yield this.jsm.streams.purge(this.stream,{filter:A}),I.reject(e)}return I})}putBlob(e,t,r){var s;return null===t&&(t=new Uint8Array(0)),this.put(e,(s=t,new ReadableStream({pull(e){e.enqueue(s),e.close()}})),r)}put(e,t,r){var s;return(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.link)?Promise.reject(Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}getBlob(e){return s(this,void 0,void 0,function*(){let t=yield this.get(e);if(null===t)return Promise.resolve(null);let r=yield Promise.all([t.error,function(e){return s(this,void 0,void 0,function*(){let t=new l.DataBuffer,r=e.getReader();for(;;){let{done:e,value:s}=yield r.read();if(e)return t.drain();s&&s.length&&t.fill(s)}})}(t.data)]);return r[0]?Promise.reject(r[0]):Promise.resolve(r[1])})}get(e){return s(this,void 0,void 0,function*(){let r;let n=yield this.rawInfo(e);if(null===n||n.deleted)return Promise.resolve(null);if(n.options&&n.options.link){let e=n.options.link.name||"";if(""===e)throw Error("link is a bucket");return(n.options.link.bucket!==this.name?yield P.create(this.js,n.options.link.bucket):this).get(e)}if(!n.digest.startsWith(t.digestType))return Promise.reject(Error(`unknown digest type: ${n.digest}`));let o=(0,b.parseSha256)(n.digest.substring(8));if(null===o)return Promise.reject(Error(`unable to parse digest: ${n.digest}`));let a=(0,u.deferred)(),c={info:new E(n),error:a};if(0===n.size)return c.data=new ReadableStream({pull(e){e.enqueue(new Uint8Array(0)),e.close()}}),a.resolve(null),Promise.resolve(c);let l=(0,d.consumerOpts)();l.orderedConsumer();let h=p.sha256.create(),f=`$O.${this.name}.C.${n.nuid}`,m=yield this.js.subscribe(f,l);return s(this,void 0,void 0,function*(){var e,t,s,a;try{for(var c,u=!0,l=i(m);!(e=(c=yield l.next()).done);u=!0)a=c.value,u=!1,a.data.length>0&&(h.update(a.data),r.enqueue(a.data)),0===a.info.pending&&((0,b.checkSha256)(o,h.digest())?r.close():r.error(Error(`received a corrupt object, digests do not match received: ${n.digest} calculated ${o}`)),m.unsubscribe())}catch(e){t={error:e}}finally{try{!u&&!e&&(s=l.return)&&(yield s.call(l))}finally{if(t)throw t.error}}}).then(()=>{a.resolve()}).catch(e=>{r.error(e),a.reject(e)}),c.data=new ReadableStream({start(e){r=e},cancel(){m.unsubscribe()}}),c})}linkStore(e,t){if(!(t instanceof P))return Promise.reject("bucket required");let{name:r,error:s}=this._checkNotEmpty(e);if(s)return Promise.reject(s);let i={name:r,options:{link:{bucket:t.name}}};return this._put(i,null)}link(e,t){return s(this,void 0,void 0,function*(){let{name:r,error:s}=this._checkNotEmpty(e);if(s)return Promise.reject(s);if(t.deleted)return Promise.reject(Error("src object is deleted"));if(t.isLink())return Promise.reject(Error("src object is a link"));let i=yield this.rawInfo(e);if(null!==i&&!i.deleted)return Promise.reject(Error("an object already exists with that name"));let n={bucket:t.bucket,name:t.name},o={name:r,bucket:t.bucket,options:{link:n}};return yield this.js.publish(this._metaSubject(e),JSON.stringify(o)),Promise.resolve((yield this.info(e)))})}delete(e){return s(this,void 0,void 0,function*(){let t=yield this.rawInfo(e);if(null===t)return Promise.resolve({purged:0,success:!1});t.deleted=!0,t.size=0,t.chunks=0,t.digest="";let r=(0,a.JSONCodec)(),s=(0,h.headers)();return s.set(d.JsHeaders.RollupHdr,d.JsHeaders.RollupValueSubject),yield this.js.publish(this._metaSubject(t.name),r.encode(t),{headers:s}),this.jsm.streams.purge(this.stream,{filter:this._chunkSubject(t.nuid)})})}update(e){return s(this,arguments,void 0,function*(e,t={}){var r;let s=yield this.rawInfo(e);if(null===s)return Promise.reject(Error("object not found"));if(s.deleted)return Promise.reject(Error("cannot update meta for a deleted object"));t.name=null!==(r=t.name)&&void 0!==r?r:s.name;let{name:i,error:n}=this._checkNotEmpty(t.name);if(n)return Promise.reject(n);if(e!==t.name){let e=yield this.info(t.name);if(e&&!e.deleted)return Promise.reject(Error("an object already exists with that name"))}t.name=i;let o=Object.assign({},s,S(t)),a=yield this.js.publish(this._metaSubject(o.name),JSON.stringify(o));return e!==t.name&&(yield this.jsm.streams.purge(this.stream,{filter:this._metaSubject(e)})),Promise.resolve(a)})}watch(){return s(this,arguments,void 0,function*(e={}){var t,r;e.includeHistory=null!==(t=e.includeHistory)&&void 0!==t&&t,e.ignoreDeletes=null!==(r=e.ignoreDeletes)&&void 0!==r&&r;let s=!1,i=new f.QueuedIteratorImpl,n=this._metaSubjectAll();try{yield this.jsm.streams.getMessage(this.stream,{last_by_subj:n})}catch(e){"404"===e.code?(i.push(null),s=!0):i.stop(e)}let o=(0,a.JSONCodec)(),c=(0,d.consumerOpts)();c.orderedConsumer(),e.includeHistory?c.deliverLastPerSubject():(s=!0,c.deliverNew()),c.callback((t,r)=>{var n;if(t){i.stop(t);return}if(null!==r){let t=o.decode(r.data);t.deleted&&!0===e.ignoreDeletes||i.push(t),(null===(n=r.info)||void 0===n?void 0:n.pending)!==0||s||(s=!0,i.push(null))}});let u=yield this.js.subscribe(n,c);return i._data=u,i.iterClosed.then(()=>{u.unsubscribe()}),u.closed.then(()=>{i.stop()}).catch(e=>{i.stop(e)}),i})}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${o.Base64UrlPaddedCodec.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(){return s(this,arguments,void 0,function*(e={}){var t;try{this.stream=g(this.name)}catch(e){return Promise.reject(e)}let r=(null==e?void 0:e.ttl)||0;delete e.ttl;let s=Object.assign({max_age:r},e);s.name=this.stream,s.num_replicas=null!==(t=e.replicas)&&void 0!==t?t:1,s.allow_direct=!0,s.allow_rollup_hdrs=!0,s.discard=m.DiscardPolicy.New,s.subjects=[`$O.${this.name}.C.>`,`$O.${this.name}.M.>`],e.placement&&(s.placement=e.placement),e.metadata&&(s.metadata=e.metadata),"boolean"==typeof e.compression&&(s.compression=e.compression?m.StoreCompression.S2:m.StoreCompression.None);try{yield this.jsm.streams.info(s.name)}catch(e){"stream not found"===e.message&&(yield this.jsm.streams.add(s))}})}static create(e,t){return s(this,arguments,void 0,function*(e,t,r={}){let s=new P(t,(yield e.jetstreamManager()),e);return yield s.init(r),Promise.resolve(s)})}}t.ObjectStoreImpl=P},95197:(e,t)=>{"use strict";function r(e){var t;switch(!function(e){if(!/^[0-9A-Fa-f]+$/.test(e))return!1;let t=/^[0-9A-F]+$/.test(e),r=/^[0-9a-f]+$/.test(e);return(!!t||!!r)&&e.length%2==0}(t=e)?/^[A-Za-z0-9\-_]*(={0,2})?$/.test(t)||/^[A-Za-z0-9+/]*(={0,2})?$/.test(t)?"b64":"":"hex"){case"hex":return function(e){if(e.length%2!=0)throw Error("hex string must have an even length");let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substring(r,r+2),16);return t}(e);case"b64":return function(e){let t=atob(e=(e=e.replace(/-/g,"+")).replace(/_/g,"/"));return Uint8Array.from(t,e=>e.charCodeAt(0))}(e)}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.parseSha256=function(e){return r(e)},t.checkSha256=function(e,t){let s="string"==typeof e?r(e):e,i="string"==typeof t?r(t):t;if(null===s||null===i||s.length!==i.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==i[e])return!1;return!0}},72569:(e,t,r)=>{"use strict";var s,i,n,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumerOptsBuilderImpl=t.kvPrefix=t.RepublishHeaders=t.DirectMsgHeaders=t.KvWatchInclude=t.JsHeaders=t.AdvisoryKind=void 0,t.consumerOpts=function(e){return new h(e)},t.isConsumerOptsBuilder=function(e){return"function"==typeof e.getOpts};let c=r(13858),u=r(82577),l=r(3009);(function(e){e.API="api_audit",e.StreamAction="stream_action",e.ConsumerAction="consumer_action",e.SnapshotCreate="snapshot_create",e.SnapshotComplete="snapshot_complete",e.RestoreCreate="restore_create",e.RestoreComplete="restore_complete",e.MaxDeliver="max_deliver",e.Terminated="terminated",e.Ack="consumer_ack",e.StreamLeaderElected="stream_leader_elected",e.StreamQuorumLost="stream_quorum_lost",e.ConsumerLeaderElected="consumer_leader_elected",e.ConsumerQuorumLost="consumer_quorum_lost"})(s||(t.AdvisoryKind=s={})),function(e){e.StreamSourceHdr="Nats-Stream-Source",e.LastConsumerSeqHdr="Nats-Last-Consumer",e.LastStreamSeqHdr="Nats-Last-Stream",e.ConsumerStalledHdr="Nats-Consumer-Stalled",e.MessageSizeHdr="Nats-Msg-Size",e.RollupHdr="Nats-Rollup",e.RollupValueSubject="sub",e.RollupValueAll="all",e.PendingMessagesHdr="Nats-Pending-Messages",e.PendingBytesHdr="Nats-Pending-Bytes"}(i||(t.JsHeaders=i={})),function(e){e.LastValue="",e.AllHistory="history",e.UpdatesOnly="updates"}(n||(t.KvWatchInclude=n={})),function(e){e.Stream="Nats-Stream",e.Sequence="Nats-Sequence",e.TimeStamp="Nats-Time-Stamp",e.Subject="Nats-Subject"}(o||(t.DirectMsgHeaders=o={})),function(e){e.Stream="Nats-Stream",e.Subject="Nats-Subject",e.Sequence="Nats-Sequence",e.LastSequence="Nats-Last-Sequence",e.Size="Nats-Msg-Size"}(a||(t.RepublishHeaders=a={})),t.kvPrefix="KV_";class h{constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=(0,c.defaultConsumer)("",e||{})}getOpts(){var e;let t={};if(t.config=Object.assign({},this.config),t.config.filter_subject&&(this.filterSubject(t.config.filter_subject),t.config.filter_subject=void 0),t.config.filter_subjects&&(null===(e=t.config.filter_subjects)||void 0===e||e.forEach(e=>{this.filterSubject(e)}),t.config.filter_subjects=void 0),t.mack=this.mack,t.stream=this.stream,t.callbackFn=this.callbackFn,t.max=this.max,t.queue=this.qname,t.ordered=this.ordered,t.config.ack_policy=t.ordered?c.AckPolicy.None:t.config.ack_policy,t.isBind=t.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:t.config.filter_subject=this.filters[0];break;default:t.config.filter_subjects=this.filters}return t}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return(0,u.validateDurableName)(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw Error("sequence must be greater than 0");return this.config.deliver_policy=c.DeliverPolicy.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=c.DeliverPolicy.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=c.DeliverPolicy.All,this}deliverLastPerSubject(){return this.config.deliver_policy=c.DeliverPolicy.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=c.DeliverPolicy.Last,this}deliverNew(){return this.config.deliver_policy=c.DeliverPolicy.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=c.AckPolicy.None,this}ackAll(){return this.config.ack_policy=c.AckPolicy.All,this}ackExplicit(){return this.config.ack_policy=c.AckPolicy.Explicit,this}ackWait(e){return this.config.ack_wait=(0,l.nanos)(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=c.ReplayPolicy.Instant,this}replayOriginal(){return this.config.replay_policy=c.ReplayPolicy.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=(0,l.nanos)(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=(0,l.nanos)(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=(0,l.nanos)(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}consumerName(e){return this.config.name=e,this}}t.ConsumerOptsBuilderImpl=h},65519:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiAuthenticator=function(e){return t=>{let r={};return e.forEach(e=>{let s=e(t)||{};r=Object.assign(r,s)}),r}},t.noAuthFn=function(){return()=>{}},t.usernamePasswordAuthenticator=function(e,t){return()=>({user:"function"==typeof e?e():e,pass:"function"==typeof t?t():t})},t.tokenAuthenticator=function(e){return()=>({auth_token:"function"==typeof e?e():e})},t.nkeyAuthenticator=o,t.jwtAuthenticator=a,t.credsAuthenticator=function(e){let t="function"!=typeof e?()=>e:e,r=()=>{let e=/\s*(?:(?:[-]{3,}[^\n]*[-]{3,}\n)(.+)(?:\n\s*[-]{3,}[^\n]*[-]{3,}\n))/ig,r=i.TD.decode(t()),s=e.exec(r);if(!s)throw n.NatsError.errorForCode(n.ErrorCode.BadCreds);let o=s[1].trim();if(!(s=e.exec(r))||!s)throw n.NatsError.errorForCode(n.ErrorCode.BadCreds);return{jwt:o,seed:i.TE.encode(s[1].trim())}};return a(()=>{let{jwt:e}=r();return e},()=>{let{seed:e}=r();return e})};let s=r(99520),i=r(97636),n=r(45067);function o(e){return t=>{let r="function"==typeof e?e():e,n=r?s.nkeys.fromSeed(r):void 0,o=n?n.getPublicKey():"",a=i.TE.encode(t||""),c=void 0!==n&&t?n.sign(a):void 0;return{nkey:o,sig:c?s.nkeys.encode(c):""}}}function a(e,t){return r=>{let s="function"==typeof e?e():e,{nkey:i,sig:n}=o(t)(r);return{jwt:s,nkey:i,sig:n}}}},15869:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64UrlPaddedCodec=t.Base64UrlCodec=t.Base64Codec=void 0;class r{static encode(e){return"string"==typeof e?btoa(e):btoa(String.fromCharCode(...Array.from(e)))}static decode(e,t=!1){let r=atob(e);return t?Uint8Array.from(r,e=>e.charCodeAt(0)):r}}t.Base64Codec=r;class s{static encode(e){return s.toB64URLEncoding(r.encode(e))}static decode(e,t=!1){return r.decode(s.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}t.Base64UrlCodec=s;class i{static encode(e){return i.toB64URLEncoding(r.encode(e))}static decode(e,t=!1){return i.decode(i.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}t.Base64UrlPaddedCodec=i},85311:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Bench=t.Metric=void 0,t.throughput=h,t.msgThroughput=function(e,t){return`${Math.floor(e/t)} msgs/sec`},t.humanizeBytes=d;let n=r(91530),o=r(27723),a=r(3009),c=r(45067);class u{constructor(e,t){this.name=e,this.duration=t,this.date=Date.now(),this.payload=0,this.msgs=0,this.bytes=0}toString(){let e=this.duration/1e3,t=Math.round(this.msgs/e),r=this.asyncRequests?"asyncRequests":"",s="";return this.max&&(s=`${this.min}/${this.max}`),`${this.name}${r?" [asyncRequests]":""} ${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")} msgs/sec - [${e.toFixed(2)} secs] ~ ${h(this.bytes,e)} ${s}`}toCsv(){return`"${this.name}",${new Date(this.date).toISOString()},${this.lang},${this.version},${this.msgs},${this.payload},${this.bytes},${this.duration},${!!this.asyncRequests&&this.asyncRequests}
`}static header(){return`Test,Date,Lang,Version,Count,MsgPayload,Bytes,Millis,Async
`}}t.Metric=u;class l{constructor(e,t={msgs:1e5,size:128,subject:"",asyncRequests:!1,pub:!1,sub:!1,req:!1,rep:!1}){if(this.nc=e,this.callbacks=t.callbacks||!1,this.msgs=t.msgs||0,this.size=t.size||0,this.subject=t.subject||o.nuid.next(),this.asyncRequests=t.asyncRequests||!1,this.pub=t.pub||!1,this.sub=t.sub||!1,this.req=t.req||!1,this.rep=t.rep||!1,this.perf=new a.Perf,this.payload=this.size?new Uint8Array(this.size):n.Empty,!this.pub&&!this.sub&&!this.req&&!this.rep)throw Error("no bench option selected")}run(){return s(this,void 0,void 0,function*(){return this.nc.closed().then(e=>{if(e)throw new c.NatsError(`bench closed with an error: ${e.message}`,c.ErrorCode.Unknown,e)}),this.callbacks?yield this.runCallbacks():yield this.runAsync(),this.processMetrics()})}processMetrics(){let{lang:e,version:t}=this.nc.protocol.transport;this.pub&&this.sub&&this.perf.measure("pubsub","pubStart","subStop"),this.req&&this.rep&&this.perf.measure("reqrep","reqStart","reqStop");let r=this.perf.getEntries(),s=r.find(e=>"pubsub"===e.name),i=r.find(e=>"reqrep"===e.name),n=r.find(e=>"req"===e.name),o=r.find(e=>"rep"===e.name),a=r.find(e=>"pub"===e.name),c=r.find(e=>"sub"===e.name),l=this.nc.stats(),h=[];if(s){let{name:r,duration:i}=s,n=new u(r,i);n.msgs=2*this.msgs,n.bytes=l.inBytes+l.outBytes,n.lang=e,n.version=t,n.payload=this.payload.length,h.push(n)}if(i){let{name:r,duration:s}=i,n=new u(r,s);n.msgs=2*this.msgs,n.bytes=l.inBytes+l.outBytes,n.lang=e,n.version=t,n.payload=this.payload.length,h.push(n)}if(a){let{name:r,duration:s}=a,i=new u(r,s);i.msgs=this.msgs,i.bytes=l.outBytes,i.lang=e,i.version=t,i.payload=this.payload.length,h.push(i)}if(c){let{name:r,duration:s}=c,i=new u(r,s);i.msgs=this.msgs,i.bytes=l.inBytes,i.lang=e,i.version=t,i.payload=this.payload.length,h.push(i)}if(o){let{name:r,duration:s}=o,i=new u(r,s);i.msgs=this.msgs,i.bytes=l.inBytes+l.outBytes,i.lang=e,i.version=t,i.payload=this.payload.length,h.push(i)}if(n){let{name:r,duration:s}=n,i=new u(r,s);i.msgs=this.msgs,i.bytes=l.inBytes+l.outBytes,i.lang=e,i.version=t,i.payload=this.payload.length,h.push(i)}return h}runCallbacks(){return s(this,void 0,void 0,function*(){let e=[];if(this.sub){let t=(0,a.deferred)();e.push(t);let r=0;this.nc.subscribe(this.subject,{max:this.msgs,callback:()=>{1==++r&&this.perf.mark("subStart"),r===this.msgs&&(this.perf.mark("subStop"),this.perf.measure("sub","subStart","subStop"),t.resolve())}})}if(this.rep){let t=(0,a.deferred)();e.push(t);let r=0;this.nc.subscribe(this.subject,{max:this.msgs,callback:(e,s)=>{s.respond(this.payload),1==++r&&this.perf.mark("repStart"),r===this.msgs&&(this.perf.mark("repStop"),this.perf.measure("rep","repStart","repStop"),t.resolve())}})}if(this.pub){let t=s(this,void 0,void 0,function*(){this.perf.mark("pubStart");for(let e=0;e<this.msgs;e++)this.nc.publish(this.subject,this.payload);yield this.nc.flush(),this.perf.mark("pubStop"),this.perf.measure("pub","pubStart","pubStop")});e.push(t)}if(this.req){let t=s(this,void 0,void 0,function*(){if(this.asyncRequests){this.perf.mark("reqStart");let e=[];for(let t=0;t<this.msgs;t++)e.push(this.nc.request(this.subject,this.payload,{timeout:2e4}));yield Promise.all(e),this.perf.mark("reqStop"),this.perf.measure("req","reqStart","reqStop")}else{this.perf.mark("reqStart");for(let e=0;e<this.msgs;e++)yield this.nc.request(this.subject);this.perf.mark("reqStop"),this.perf.measure("req","reqStart","reqStop")}});e.push(t)}yield Promise.all(e)})}runAsync(){return s(this,void 0,void 0,function*(){let e=[];if(this.rep){let t=!1,r=this.nc.subscribe(this.subject,{max:this.msgs}),n=s(this,void 0,void 0,function*(){var e,s,n,o;try{for(var a,c=!0,u=i(r);!(e=(a=yield u.next()).done);c=!0)o=a.value,c=!1,t||(this.perf.mark("repStart"),t=!0),o.respond(this.payload)}catch(e){s={error:e}}finally{try{!c&&!e&&(n=u.return)&&(yield n.call(u))}finally{if(s)throw s.error}}yield this.nc.flush(),this.perf.mark("repStop"),this.perf.measure("rep","repStart","repStop")});e.push(n)}if(this.sub){let t=!1,r=this.nc.subscribe(this.subject,{max:this.msgs}),n=s(this,void 0,void 0,function*(){var e,s,n;try{for(var o,a=!0,c=i(r);!(e=(o=yield c.next()).done);a=!0)o.value,a=!1,t||(this.perf.mark("subStart"),t=!0)}catch(e){s={error:e}}finally{try{!a&&!e&&(n=c.return)&&(yield n.call(c))}finally{if(s)throw s.error}}this.perf.mark("subStop"),this.perf.measure("sub","subStart","subStop")});e.push(n)}if(this.pub){let t=s(this,void 0,void 0,function*(){this.perf.mark("pubStart");for(let e=0;e<this.msgs;e++)this.nc.publish(this.subject,this.payload);yield this.nc.flush(),this.perf.mark("pubStop"),this.perf.measure("pub","pubStart","pubStop")});e.push(t)}if(this.req){let t=s(this,void 0,void 0,function*(){if(this.asyncRequests){this.perf.mark("reqStart");let e=[];for(let t=0;t<this.msgs;t++)e.push(this.nc.request(this.subject,this.payload,{timeout:2e4}));yield Promise.all(e),this.perf.mark("reqStop"),this.perf.measure("req","reqStart","reqStop")}else{this.perf.mark("reqStart");for(let e=0;e<this.msgs;e++)yield this.nc.request(this.subject);this.perf.mark("reqStop"),this.perf.measure("req","reqStart","reqStop")}});e.push(t)}yield Promise.all(e)})}}function h(e,t){return`${d(e/t)}/sec`}function d(e,t=!1){let r=t?1e3:1024,s=t?"iB":"B";if(e<r)return`${e.toFixed(2)} ${s}`;let i=parseInt(Math.log(e)/Math.log(r)+""),n=parseInt(i-1+"");return`${(e/Math.pow(r,i)).toFixed(2)} ${(t?["k","M","G","T","P","E"]:["K","M","G","T","P","E"])[n]}${s}`}t.Bench=l},25952:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringCodec=function(){return{encode:e=>s.TE.encode(e),decode:e=>s.TD.decode(e)}},t.JSONCodec=function(e){return{encode(e){try{return void 0===e&&(e=null),s.TE.encode(JSON.stringify(e))}catch(e){throw i.NatsError.errorForCode(i.ErrorCode.BadJson,e)}},decode(t){try{return JSON.parse(s.TD.decode(t),e)}catch(e){throw i.NatsError.errorForCode(i.ErrorCode.BadJson,e)}}}};let s=r(97636),i=r(45067)},45067:function(e,t,r){"use strict";var s,i,n,o,a,c,u,l,h,d,f,p,m,y,b=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceVerb=t.DEFAULT_HOST=t.DEFAULT_PORT=t.ServiceError=t.ServiceErrorCodeHeader=t.ServiceErrorHeader=t.ServiceResponseType=t.RequestStrategy=t.Match=t.NatsError=t.Messages=t.ErrorCode=t.DebugEvents=t.Events=void 0,t.isNatsError=function(e){return"string"==typeof e.code},t.syncIterator=function(e){let t=e[Symbol.asyncIterator]();return{next(){return b(this,void 0,void 0,function*(){let e=yield t.next();return e.done?Promise.resolve(null):Promise.resolve(e.value)})}}},t.createInbox=function(e=""){if("string"!=typeof(e=e||"_INBOX"))throw Error("prefix must be a string");return e.split(".").forEach(t=>{if("*"===t||">"===t)throw Error(`inbox prefixes cannot have wildcards '${e}'`)}),`${e}.${g.nuid.next()}`};let g=r(27723);(s=l||(t.Events=l={})).Disconnect="disconnect",s.Reconnect="reconnect",s.Update="update",s.LDM="ldm",s.Error="error",(i=h||(t.DebugEvents=h={})).Reconnecting="reconnecting",i.PingTimer="pingTimer",i.StaleConnection="staleConnection",i.ClientInitiatedReconnect="client initiated reconnect",(n=d||(t.ErrorCode=d={})).ApiError="BAD API",n.BadAuthentication="BAD_AUTHENTICATION",n.BadCreds="BAD_CREDS",n.BadHeader="BAD_HEADER",n.BadJson="BAD_JSON",n.BadPayload="BAD_PAYLOAD",n.BadSubject="BAD_SUBJECT",n.Cancelled="CANCELLED",n.ConnectionClosed="CONNECTION_CLOSED",n.ConnectionDraining="CONNECTION_DRAINING",n.ConnectionRefused="CONNECTION_REFUSED",n.ConnectionTimeout="CONNECTION_TIMEOUT",n.Disconnect="DISCONNECT",n.InvalidOption="INVALID_OPTION",n.InvalidPayload="INVALID_PAYLOAD",n.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",n.NoResponders="503",n.NotFunction="NOT_FUNC",n.RequestError="REQUEST_ERROR",n.ServerOptionNotAvailable="SERVER_OPT_NA",n.SubClosed="SUB_CLOSED",n.SubDraining="SUB_DRAINING",n.Timeout="TIMEOUT",n.Tls="TLS",n.Unknown="UNKNOWN_ERROR",n.WssRequired="WSS_REQUIRED",n.JetStreamInvalidAck="JESTREAM_INVALID_ACK",n.JetStream404NoMessages="404",n.JetStream408RequestTimeout="408",n.JetStream409MaxAckPendingExceeded="409",n.JetStream409="409",n.JetStreamNotEnabled="503",n.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",n.AuthorizationViolation="AUTHORIZATION_VIOLATION",n.AuthenticationExpired="AUTHENTICATION_EXPIRED",n.ProtocolError="NATS_PROTOCOL_ERR",n.PermissionsViolation="PERMISSIONS_VIOLATION",n.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",n.AccountExpired="ACCOUNT_EXPIRED";class v{constructor(){this.messages=new Map,this.messages.set(d.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(d.BadJson,"Bad JSON"),this.messages.set(d.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return _.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}t.Messages=v;let _=new v;class E extends Error{constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){return new E(v.getMessage(e),e,t)}isAuthError(){return this.code===d.AuthenticationExpired||this.code===d.AuthorizationViolation||this.code===d.AccountExpired}isAuthTimeout(){return this.code===d.AuthenticationTimeout}isPermissionError(){return this.code===d.PermissionsViolation}isProtocolError(){return this.code===d.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}t.NatsError=E,(o=f||(t.Match=f={}))[o.Exact=0]="Exact",o[o.CanonicalMIME=1]="CanonicalMIME",o[o.IgnoreCase=2]="IgnoreCase",(a=p||(t.RequestStrategy=p={})).Timer="timer",a.Count="count",a.JitterTimer="jitterTimer",a.SentinelMsg="sentinelMsg",(c=m||(t.ServiceResponseType=m={})).STATS="io.nats.micro.v1.stats_response",c.INFO="io.nats.micro.v1.info_response",c.PING="io.nats.micro.v1.ping_response",t.ServiceErrorHeader="Nats-Service-Error",t.ServiceErrorCodeHeader="Nats-Service-Error-Code";class S extends Error{constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==S.toServiceError(e)}static toServiceError(e){var r,s;let i=(null===(r=null==e?void 0:e.headers)||void 0===r?void 0:r.get(t.ServiceErrorCodeHeader))||"";if(""!==i){let r=parseInt(i)||400,n=(null===(s=null==e?void 0:e.headers)||void 0===s?void 0:s.get(t.ServiceErrorHeader))||"";return new S(r,n.length?n:i)}return null}}t.ServiceError=S,t.DEFAULT_PORT=4222,t.DEFAULT_HOST="127.0.0.1",(u=y||(t.ServiceVerb=y={})).PING="PING",u.STATS="STATS",u.INFO="INFO"},5364:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataBuffer=void 0;let s=r(97636);class i{constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].length;let r=new Uint8Array(t),s=0;for(let t=0;t<e.length;t++)r.set(e[t],s),s+=e[t].length;return r}static fromAscii(e){return e||(e=""),s.TE.encode(e)}static toAscii(e){return s.TD.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){let e=new Uint8Array(this.byteLength),t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){let e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();let t=this.buffers.pop();if(t){let r=this.byteLength;(void 0===e||e>r)&&(e=r);let s=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,s}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let e=0;e<t.length;e++)t[e]&&t[e].length&&(this.buffers.push(t[e]),this.byteLength+=t[e].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}t.DataBuffer=i},16405:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DenoBuffer=t.MAX_SIZE=t.AssertionError=void 0,t.assert=n,t.concat=a,t.append=function(e,t){return a(e,Uint8Array.of(t))},t.readAll=function(e){let t=new c;return t.readFrom(e),t.bytes()},t.writeAll=function(e,t){let r=0;for(;r<t.length;)r+=e.write(t.subarray(r))};let s=r(97636);class i extends Error{constructor(e){super(e),this.name="AssertionError"}}function n(e,t="Assertion failed."){if(!e)throw new i(t)}function o(e,t,r=0){let s=t.byteLength-r;return e.byteLength>s&&(e=e.subarray(0,s)),t.set(e,r),e.byteLength}function a(e,t){if(void 0===e&&void 0===t)return new Uint8Array(0);if(void 0===e)return t;if(void 0===t)return e;let r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r}t.AssertionError=i,t.MAX_SIZE=4294967294;class c{constructor(e){if(this._off=0,null==e){this._buf=new Uint8Array(0);return}this._buf=new Uint8Array(e)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0===e){this.reset();return}if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){let t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){n(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){let e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return(this.reset(),0===e.byteLength)?0:null;let t=o(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(s.TE.encode(e))}write(e){let t=this._grow(e.byteLength);return o(e,this._buf,t)}_grow(e){let r=this.length;0===r&&0!==this._off&&this.reset();let s=this._tryGrowByReslice(e);if(s>=0)return s;let i=this.capacity;if(e<=Math.floor(i/2)-r)o(this._buf.subarray(this._off),this._buf);else if(i+e>t.MAX_SIZE)throw Error("The buffer cannot be grown beyond the maximum size.");else{let r=new Uint8Array(Math.min(2*i+e,t.MAX_SIZE));o(this._buf.subarray(this._off),r),this._buf=r}return this._off=0,this._reslice(Math.min(r+e,t.MAX_SIZE)),r}grow(e){if(e<0)throw Error("Buffer._grow: negative count");let t=this._grow(e);this._reslice(t)}readFrom(e){let t=0,r=new Uint8Array(32768);for(;;){let s=this.capacity-this.length<32768,i=s?r:new Uint8Array(this._buf.buffer,this.length),n=e.read(i);if(null===n)return t;s?this.write(i.subarray(0,n)):this._reslice(this.length+n),t+=n}}}t.DenoBuffer=c},97636:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TD=t.TE=t.Empty=void 0,t.encode=function(...e){let r=[];for(let s=0;s<e.length;s++)r.push(t.TE.encode(e[s]));return 0===r.length?t.Empty:1===r.length?r[0]:function(...e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].length;let r=new Uint8Array(t),s=0;for(let t=0;t<e.length;t++)r.set(e[t],s),s+=e[t].length;return r}(...r)},t.decode=function(e){return e&&0!==e.length?t.TD.decode(e):""},t.Empty=new Uint8Array(0),t.TE=new TextEncoder,t.TD=new TextDecoder},24725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgHdrsImpl=void 0,t.canonicalMIMEHeaderKey=n,t.headers=function(e=0,t=""){if(0===e&&""!==t||e>0&&""===t)throw Error("setting status requires both code and description");return new a(e,t)};let s=r(97636),i=r(45067);function n(e){let t=!0,r=Array(e.length);for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);if(58===n||n<33||n>126)throw new i.NatsError(`'${e[s]}' is not a valid character for a header key`,i.ErrorCode.BadHeader);t&&97<=n&&n<=122?n-=32:!t&&65<=n&&n<=90&&(n+=32),r[s]=n,t=45==n}return String.fromCharCode(...r)}let o="NATS/1.0";class a{constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(let[t,r]of this.headers){let s=e.values(t);if(r.length!==s.length)return!1;let i=[...r].sort(),n=[...s].sort();for(let e=0;e<i.length;e++)if(i[e]!==n[e])return!1}return!0}return!1}static decode(e){let t=new a,r=s.TD.decode(e).split("\r\n"),i=r[0];if(i!==o){let e=i.replace(o,"").trim();if(e.length>0){t._code=parseInt(e,10),isNaN(t._code)&&(t._code=0);let r=t._code.toString();e=e.replace(r,""),t._description=e.trim()}}return r.length>=1&&r.slice(1).map(e=>{if(e){let r=e.indexOf(":");if(r>-1){let s=e.slice(0,r),i=e.slice(r+1).trim();t.append(s,i)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=o;for(let[t,r]of(this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`),this.headers))for(let s=0;s<r.length;s++)e=`${e}\r
${t}: ${r[s]}`;return`${e}\r
\r
`}encode(){return s.TE.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new i.NatsError("invalid header value - \\r and \\n are not allowed.",i.ErrorCode.BadHeader);return e.trim()}keys(){let e=[];for(let t of this.headers.keys())e.push(t);return e}findKeys(e,t=i.Match.Exact){let r=this.keys();switch(t){case i.Match.Exact:return r.filter(t=>t===e);case i.Match.CanonicalMIME:return e=n(e),r.filter(t=>t===e);default:{let t=e.toLowerCase();return r.filter(e=>t===e.toLowerCase())}}}get(e,t=i.Match.Exact){let r=this.findKeys(e,t);if(r.length){let e=this.headers.get(r[0]);if(e)return Array.isArray(e)?e[0]:e}return""}last(e,t=i.Match.Exact){let r=this.findKeys(e,t);if(r.length){let e=this.headers.get(r[0]);if(e)return Array.isArray(e)?e[e.length-1]:e}return""}has(e,t=i.Match.Exact){return this.findKeys(e,t).length>0}set(e,t,r=i.Match.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=i.Match.Exact){let s=n(e);r===i.Match.CanonicalMIME&&(e=s);let o=this.findKeys(e,r);e=o.length>0?o[0]:e;let c=a.validHeaderValue(t),u=this.headers.get(e);u||(u=[],this.headers.set(e,u)),u.push(c)}values(e,t=i.Match.Exact){let r=[];return this.findKeys(e,t).forEach(e=>{let t=this.headers.get(e);t&&r.push(...t)}),r}delete(e,t=i.Match.Exact){this.findKeys(e,t).forEach(e=>{this.headers.delete(e)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){let e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){let t=new a;for(let r in e)t.headers.set(r,e[r]);return t}}t.MsgHdrsImpl=a},910:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Heartbeat=void 0;let s=r(3009),i=r(45067);class n{constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:i.DebugEvents.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut){this.cancel(!0);return}let e=(0,s.deferred)();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}t.Heartbeat=n},44013:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdleHeartbeatMonitor=void 0;class r{constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=(null==r?void 0:r.maxOut)||2,this.cancelAfter=(null==r?void 0:r.cancelAfter)||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0,this.missed=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}t.IdleHeartbeatMonitor=r},89969:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.parseIP=t.isIP=t.TE=t.TD=t.Metric=t.Bench=t.writeAll=t.readAll=t.MAX_SIZE=t.DenoBuffer=t.State=t.Parser=t.Kind=t.QueuedIteratorImpl=t.StringCodec=t.JSONCodec=t.usernamePasswordAuthenticator=t.tokenAuthenticator=t.nkeyAuthenticator=t.jwtAuthenticator=t.credsAuthenticator=t.RequestOne=t.checkUnsupportedOption=t.checkOptions=t.buildAuthenticator=t.DataBuffer=t.MuxSubscription=t.Heartbeat=t.MsgHdrsImpl=t.headers=t.canonicalMIMEHeaderKey=t.timeout=t.render=t.nanos=t.millis=t.extend=t.delay=t.deferred=t.deadline=t.collect=t.backoff=t.ProtocolHandler=t.INFO=t.Connect=t.setTransportFactory=t.getResolveFn=t.MsgImpl=t.nuid=t.Nuid=t.NatsConnectionImpl=void 0,t.Subscriptions=t.SubscriptionImpl=t.syncIterator=t.ServiceVerb=t.ServiceResponseType=t.ServiceErrorHeader=t.ServiceErrorCodeHeader=t.ServiceError=t.RequestStrategy=t.NatsError=t.Match=t.isNatsError=t.Events=t.ErrorCode=t.DebugEvents=t.createInbox=t.extractProtocolMessage=t.Empty=t.parseSemVer=t.compare=t.NoopKvCodecs=t.defaultBucketOpts=t.Bucket=t.Base64KeyCodec=t.TypedSubscription=void 0;var n=r(2894);Object.defineProperty(t,"NatsConnectionImpl",{enumerable:!0,get:function(){return n.NatsConnectionImpl}});var o=r(27723);Object.defineProperty(t,"Nuid",{enumerable:!0,get:function(){return o.Nuid}}),Object.defineProperty(t,"nuid",{enumerable:!0,get:function(){return o.nuid}});var a=r(66348);Object.defineProperty(t,"MsgImpl",{enumerable:!0,get:function(){return a.MsgImpl}});var c=r(35959);Object.defineProperty(t,"getResolveFn",{enumerable:!0,get:function(){return c.getResolveFn}}),Object.defineProperty(t,"setTransportFactory",{enumerable:!0,get:function(){return c.setTransportFactory}});var u=r(3793);Object.defineProperty(t,"Connect",{enumerable:!0,get:function(){return u.Connect}}),Object.defineProperty(t,"INFO",{enumerable:!0,get:function(){return u.INFO}}),Object.defineProperty(t,"ProtocolHandler",{enumerable:!0,get:function(){return u.ProtocolHandler}});var l=r(3009);Object.defineProperty(t,"backoff",{enumerable:!0,get:function(){return l.backoff}}),Object.defineProperty(t,"collect",{enumerable:!0,get:function(){return l.collect}}),Object.defineProperty(t,"deadline",{enumerable:!0,get:function(){return l.deadline}}),Object.defineProperty(t,"deferred",{enumerable:!0,get:function(){return l.deferred}}),Object.defineProperty(t,"delay",{enumerable:!0,get:function(){return l.delay}}),Object.defineProperty(t,"extend",{enumerable:!0,get:function(){return l.extend}}),Object.defineProperty(t,"millis",{enumerable:!0,get:function(){return l.millis}}),Object.defineProperty(t,"nanos",{enumerable:!0,get:function(){return l.nanos}}),Object.defineProperty(t,"render",{enumerable:!0,get:function(){return l.render}}),Object.defineProperty(t,"timeout",{enumerable:!0,get:function(){return l.timeout}});var h=r(24725);Object.defineProperty(t,"canonicalMIMEHeaderKey",{enumerable:!0,get:function(){return h.canonicalMIMEHeaderKey}}),Object.defineProperty(t,"headers",{enumerable:!0,get:function(){return h.headers}}),Object.defineProperty(t,"MsgHdrsImpl",{enumerable:!0,get:function(){return h.MsgHdrsImpl}});var d=r(910);Object.defineProperty(t,"Heartbeat",{enumerable:!0,get:function(){return d.Heartbeat}});var f=r(27611);Object.defineProperty(t,"MuxSubscription",{enumerable:!0,get:function(){return f.MuxSubscription}});var p=r(5364);Object.defineProperty(t,"DataBuffer",{enumerable:!0,get:function(){return p.DataBuffer}});var m=r(35572);Object.defineProperty(t,"buildAuthenticator",{enumerable:!0,get:function(){return m.buildAuthenticator}}),Object.defineProperty(t,"checkOptions",{enumerable:!0,get:function(){return m.checkOptions}}),Object.defineProperty(t,"checkUnsupportedOption",{enumerable:!0,get:function(){return m.checkUnsupportedOption}});var y=r(55102);Object.defineProperty(t,"RequestOne",{enumerable:!0,get:function(){return y.RequestOne}});var b=r(65519);Object.defineProperty(t,"credsAuthenticator",{enumerable:!0,get:function(){return b.credsAuthenticator}}),Object.defineProperty(t,"jwtAuthenticator",{enumerable:!0,get:function(){return b.jwtAuthenticator}}),Object.defineProperty(t,"nkeyAuthenticator",{enumerable:!0,get:function(){return b.nkeyAuthenticator}}),Object.defineProperty(t,"tokenAuthenticator",{enumerable:!0,get:function(){return b.tokenAuthenticator}}),Object.defineProperty(t,"usernamePasswordAuthenticator",{enumerable:!0,get:function(){return b.usernamePasswordAuthenticator}});var g=r(25952);Object.defineProperty(t,"JSONCodec",{enumerable:!0,get:function(){return g.JSONCodec}}),Object.defineProperty(t,"StringCodec",{enumerable:!0,get:function(){return g.StringCodec}}),i(r(99520),t);var v=r(35611);Object.defineProperty(t,"QueuedIteratorImpl",{enumerable:!0,get:function(){return v.QueuedIteratorImpl}});var _=r(91433);Object.defineProperty(t,"Kind",{enumerable:!0,get:function(){return _.Kind}}),Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return _.Parser}}),Object.defineProperty(t,"State",{enumerable:!0,get:function(){return _.State}});var E=r(16405);Object.defineProperty(t,"DenoBuffer",{enumerable:!0,get:function(){return E.DenoBuffer}}),Object.defineProperty(t,"MAX_SIZE",{enumerable:!0,get:function(){return E.MAX_SIZE}}),Object.defineProperty(t,"readAll",{enumerable:!0,get:function(){return E.readAll}}),Object.defineProperty(t,"writeAll",{enumerable:!0,get:function(){return E.writeAll}});var S=r(85311);Object.defineProperty(t,"Bench",{enumerable:!0,get:function(){return S.Bench}}),Object.defineProperty(t,"Metric",{enumerable:!0,get:function(){return S.Metric}});var P=r(97636);Object.defineProperty(t,"TD",{enumerable:!0,get:function(){return P.TD}}),Object.defineProperty(t,"TE",{enumerable:!0,get:function(){return P.TE}});var w=r(70978);Object.defineProperty(t,"isIP",{enumerable:!0,get:function(){return w.isIP}}),Object.defineProperty(t,"parseIP",{enumerable:!0,get:function(){return w.parseIP}});var C=r(91837);Object.defineProperty(t,"TypedSubscription",{enumerable:!0,get:function(){return C.TypedSubscription}});var O=r(18791);Object.defineProperty(t,"Base64KeyCodec",{enumerable:!0,get:function(){return O.Base64KeyCodec}}),Object.defineProperty(t,"Bucket",{enumerable:!0,get:function(){return O.Bucket}}),Object.defineProperty(t,"defaultBucketOpts",{enumerable:!0,get:function(){return O.defaultBucketOpts}}),Object.defineProperty(t,"NoopKvCodecs",{enumerable:!0,get:function(){return O.NoopKvCodecs}});var A=r(63248);Object.defineProperty(t,"compare",{enumerable:!0,get:function(){return A.compare}}),Object.defineProperty(t,"parseSemVer",{enumerable:!0,get:function(){return A.parseSemVer}});var x=r(91530);Object.defineProperty(t,"Empty",{enumerable:!0,get:function(){return x.Empty}});var j=r(35959);Object.defineProperty(t,"extractProtocolMessage",{enumerable:!0,get:function(){return j.extractProtocolMessage}});var I=r(45067);Object.defineProperty(t,"createInbox",{enumerable:!0,get:function(){return I.createInbox}}),Object.defineProperty(t,"DebugEvents",{enumerable:!0,get:function(){return I.DebugEvents}}),Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return I.ErrorCode}}),Object.defineProperty(t,"Events",{enumerable:!0,get:function(){return I.Events}}),Object.defineProperty(t,"isNatsError",{enumerable:!0,get:function(){return I.isNatsError}}),Object.defineProperty(t,"Match",{enumerable:!0,get:function(){return I.Match}}),Object.defineProperty(t,"NatsError",{enumerable:!0,get:function(){return I.NatsError}}),Object.defineProperty(t,"RequestStrategy",{enumerable:!0,get:function(){return I.RequestStrategy}}),Object.defineProperty(t,"ServiceError",{enumerable:!0,get:function(){return I.ServiceError}}),Object.defineProperty(t,"ServiceErrorCodeHeader",{enumerable:!0,get:function(){return I.ServiceErrorCodeHeader}}),Object.defineProperty(t,"ServiceErrorHeader",{enumerable:!0,get:function(){return I.ServiceErrorHeader}}),Object.defineProperty(t,"ServiceResponseType",{enumerable:!0,get:function(){return I.ServiceResponseType}}),Object.defineProperty(t,"ServiceVerb",{enumerable:!0,get:function(){return I.ServiceVerb}}),Object.defineProperty(t,"syncIterator",{enumerable:!0,get:function(){return I.syncIterator}});var N=r(3793);Object.defineProperty(t,"SubscriptionImpl",{enumerable:!0,get:function(){return N.SubscriptionImpl}}),Object.defineProperty(t,"Subscriptions",{enumerable:!0,get:function(){return N.Subscriptions}})},70978:(e,t)=>{"use strict";function r(e,t,r,s){let i=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((e,t)=>{i[t]=e}),i[12]=e,i[13]=t,i[14]=r,i[15]=s,i}function s(e){for(let t=0;t<e.length;t++)switch(e[t]){case".":return i(e);case":":return function(e){let t=new Uint8Array(16),r=-1;if(e.length>=2&&":"===e[0]&&":"===e[1]&&(r=0,0===(e=e.substring(2)).length))return t;let s=0;for(;s<16;){let{n,c:o,ok:a}=function(e){let t=0,r=0;for(r=0;r<e.length;r++){if(48<=e.charCodeAt(r)&&57>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-48;else if(97<=e.charCodeAt(r)&&102>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-97+10;else if(65<=e.charCodeAt(r)&&70>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-65+10;else break;if(t>=16777215)return{n:0,c:r,ok:!1}}return 0===r?{n:0,c:r,ok:!1}:{n:t,c:r,ok:!0}}(e);if(!a||n>65535)return;if(o<e.length&&"."===e[o]){if(r<0&&12!=s||s+4>16)return;let n=i(e);if(void 0===n)return;t[s]=n[12],t[s+1]=n[13],t[s+2]=n[14],t[s+3]=n[15],e="",s+=4;break}if(t[s]=n>>8,t[s+1]=n,s+=2,0===(e=e.substring(o)).length)break;if(":"!==e[0]||1==e.length)return;if(":"===(e=e.substring(1))[0]){if(r>=0)return;if(r=s,0===(e=e.substring(1)).length)break}}if(0===e.length){if(s<16){if(r<0)return;let e=16-s;for(let i=s-1;i>=r;i--)t[i+e]=t[i];for(let s=r+e-1;s>=r;s--)t[s]=0}else if(r>=0)return;return t}}(e)}}function i(e){let t=new Uint8Array(4);for(let r=0;r<4;r++){if(0===e.length)return;if(r>0){if("."!==e[0])return;e=e.substring(1)}let{n:s,c:i,ok:n}=function(e){let t=0,r=0;for(t=0;t<e.length&&48<=e.charCodeAt(t)&&57>=e.charCodeAt(t);t++)if((r=10*r+(e.charCodeAt(t)-48))>=16777215)return{n:16777215,c:t,ok:!1};return 0===t?{n:0,c:0,ok:!1}:{n:r,c:t,ok:!0}}(e);if(!n||s>255)return;e=e.substring(i),t[r]=s}return r(t[0],t[1],t[2],t[3])}Object.defineProperty(t,"__esModule",{value:!0}),t.ipV4=r,t.isIP=function(e){return void 0!==s(e)},t.parseIP=s},3943:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha256=t.sha224=t.default=void 0;var r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}var n=s,o=i;"function"==typeof r.setTimeout&&(n=setTimeout),"function"==typeof r.clearTimeout&&(o=clearTimeout);var a,c=[],u=!1,l=-1;function h(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&function(){if(!u){var e=function(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}(h);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}())}(function(e,t){this.fun=e,this.array=t}).prototype.run=function(){this.fun.apply(null,this.array)};var d=r.performance||{},f=(d.now||d.mozNow||d.msNow||d.oNow||d.webkitNow,{versions:{}}),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},m={exports:{}},y={},b=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),t}(function(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if("default"!==r&&!(r in e)){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(e)}({__proto__:null,default:y},[y]));!function(){var e="input is invalid type",t="object"==typeof window,r=t?window:{};r.JS_SHA256_NO_WINDOW&&(t=!1);var s=!t&&"object"==typeof self,i=!r.JS_SHA256_NO_NODE_JS&&f.versions&&f.versions.node;i?r=p:s&&(r=self);var n=!r.JS_SHA256_NO_COMMON_JS&&m.exports,o=!r.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),c=[-2147483648,8388608,32768,128],u=[24,16,8,0],l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],h=["hex","array","digest","arrayBuffer"],d=[];!r.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),o&&(r.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var y=function(e,t){return function(r){return new S(t,!0).update(r)[e]()}},g=function(e){var t=y("hex",e);i&&(t=v(t,e)),t.create=function(){return new S(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<h.length;++r){var s=h[r];t[s]=y(s,e)}return t},v=function(t,s){var i,n=b.Buffer,o=s?"sha224":"sha256";return i=n.from&&!r.JS_SHA256_NO_BUFFER_FROM?n.from:function(e){return new n(e)},function(r){if("string"==typeof r)return b.createHash(o).update(r,"utf8").digest("hex");if(null==r)throw Error(e);return r.constructor===ArrayBuffer&&(r=new Uint8Array(r)),Array.isArray(r)||ArrayBuffer.isView(r)||r.constructor===n?b.createHash(o).update(i(r)).digest("hex"):t(r)}},_=function(e,t){return function(r,s){return new P(r,t,!0).update(s)[e]()}},E=function(e){var t=_("hex",e);t.create=function(t){return new P(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<h.length;++r){var s=h[r];t[s]=_(s,e)}return t};function S(e,t){t?(d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function P(t,r,s){var i,n=typeof t;if("string"===n){var a,c=[],u=t.length,l=0;for(i=0;i<u;++i)(a=t.charCodeAt(i))<128?c[l++]=a:(a<2048?c[l++]=192|a>>>6:(a<55296||a>=57344?c[l++]=224|a>>>12:(a=65536+((1023&a)<<10|1023&t.charCodeAt(++i)),c[l++]=240|a>>>18,c[l++]=128|a>>>12&63),c[l++]=128|a>>>6&63),c[l++]=128|63&a);t=c}else{if("object"!==n||null===t)throw Error(e);if(o&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||o&&ArrayBuffer.isView(t)))throw Error(e)}t.length>64&&(t=new S(r,!0).update(t).array());var h=[],d=[];for(i=0;i<64;++i){var f=t[i]||0;h[i]=92^f,d[i]=54^f}S.call(this,r,s),this.update(d),this.oKeyPad=h,this.inner=!0,this.sharedMemory=s}S.prototype.update=function(t){if(!this.finalized){var r,s=typeof t;if("string"!==s){if("object"!==s||null===t)throw Error(e);if(o&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||o&&ArrayBuffer.isView(t)))throw Error(e);r=!0}for(var i,n,a=0,c=t.length,l=this.blocks;a<c;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,this.block=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),r)for(n=this.start;a<c&&n<64;++a)l[n>>>2]|=t[a]<<u[3&n++];else for(n=this.start;a<c&&n<64;++a)(i=t.charCodeAt(a))<128?l[n>>>2]|=i<<u[3&n++]:(i<2048?l[n>>>2]|=(192|i>>>6)<<u[3&n++]:(i<55296||i>=57344?l[n>>>2]|=(224|i>>>12)<<u[3&n++]:(i=65536+((1023&i)<<10|1023&t.charCodeAt(++a)),l[n>>>2]|=(240|i>>>18)<<u[3&n++],l[n>>>2]|=(128|i>>>12&63)<<u[3&n++]),l[n>>>2]|=(128|i>>>6&63)<<u[3&n++]),l[n>>>2]|=(128|63&i)<<u[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=l[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},S.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=c[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},S.prototype.hash=function(){var e,t,r,s,i,n,o,a,c,u=this.h0,h=this.h1,d=this.h2,f=this.h3,p=this.h4,m=this.h5,y=this.h6,b=this.h7,g=this.blocks;for(e=16;e<64;++e)t=((i=g[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,r=((i=g[e-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,g[e]=g[e-16]+t+g[e-7]+r|0;for(c=h&d,e=0;e<64;e+=4)this.first?(this.is224?(n=300032,b=(i=g[0]-1413257819)-150054599|0,f=i+24177077|0):(n=704751109,b=(i=g[0]-210244248)-1521486534|0,f=i+143694565|0),this.first=!1):(t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),s=(n=u&h)^u&d^c,b=f+(i=b+(r=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&m^~p&y)+l[e]+g[e])|0,f=i+(t+s)|0),t=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),s=(o=f&u)^f&h^n,y=d+(i=y+(r=(b>>>6|b<<26)^(b>>>11|b<<21)^(b>>>25|b<<7))+(b&p^~b&m)+l[e+1]+g[e+1])|0,t=((d=i+(t+s)|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),s=(a=d&f)^d&u^o,m=h+(i=m+(r=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+(y&b^~y&p)+l[e+2]+g[e+2])|0,t=((h=i+(t+s)|0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),s=(c=h&d)^h&f^a,p=u+(i=p+(r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&y^~m&b)+l[e+3]+g[e+3])|0,u=i+(t+s)|0,this.chromeBugWorkAround=!0;this.h0=this.h0+u|0,this.h1=this.h1+h|0,this.h2=this.h2+d|0,this.h3=this.h3+f|0,this.h4=this.h4+p|0,this.h5=this.h5+m|0,this.h6=this.h6+y|0,this.h7=this.h7+b|0},S.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,s=this.h3,i=this.h4,n=this.h5,o=this.h6,c=this.h7,u=a[e>>>28&15]+a[e>>>24&15]+a[e>>>20&15]+a[e>>>16&15]+a[e>>>12&15]+a[e>>>8&15]+a[e>>>4&15]+a[15&e]+a[t>>>28&15]+a[t>>>24&15]+a[t>>>20&15]+a[t>>>16&15]+a[t>>>12&15]+a[t>>>8&15]+a[t>>>4&15]+a[15&t]+a[r>>>28&15]+a[r>>>24&15]+a[r>>>20&15]+a[r>>>16&15]+a[r>>>12&15]+a[r>>>8&15]+a[r>>>4&15]+a[15&r]+a[s>>>28&15]+a[s>>>24&15]+a[s>>>20&15]+a[s>>>16&15]+a[s>>>12&15]+a[s>>>8&15]+a[s>>>4&15]+a[15&s]+a[i>>>28&15]+a[i>>>24&15]+a[i>>>20&15]+a[i>>>16&15]+a[i>>>12&15]+a[i>>>8&15]+a[i>>>4&15]+a[15&i]+a[n>>>28&15]+a[n>>>24&15]+a[n>>>20&15]+a[n>>>16&15]+a[n>>>12&15]+a[n>>>8&15]+a[n>>>4&15]+a[15&n]+a[o>>>28&15]+a[o>>>24&15]+a[o>>>20&15]+a[o>>>16&15]+a[o>>>12&15]+a[o>>>8&15]+a[o>>>4&15]+a[15&o];return this.is224||(u+=a[c>>>28&15]+a[c>>>24&15]+a[c>>>20&15]+a[c>>>16&15]+a[c>>>12&15]+a[c>>>8&15]+a[c>>>4&15]+a[15&c]),u},S.prototype.toString=S.prototype.hex,S.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,s=this.h3,i=this.h4,n=this.h5,o=this.h6,a=this.h7,c=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o];return this.is224||c.push(a>>>24&255,a>>>16&255,a>>>8&255,255&a),c},S.prototype.array=S.prototype.digest,S.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},P.prototype=new S,P.prototype.finalize=function(){if(S.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();S.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),S.prototype.finalize.call(this)}};var w=g();w.sha256=w,w.sha224=g(!0),w.sha256.hmac=E(),w.sha224.hmac=E(!0),n?m.exports=w:(r.sha256=w.sha256,r.sha224=w.sha224)}();var g=m.exports,v=m.exports.sha224,_=m.exports.sha256;t.default=g,t.sha224=v,t.sha256=_},31606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.usernamePasswordAuthenticator=t.tokenAuthenticator=t.syncIterator=t.StringCodec=t.ServiceVerb=t.ServiceResponseType=t.ServiceErrorHeader=t.ServiceErrorCodeHeader=t.ServiceError=t.RequestStrategy=t.nuid=t.Nuid=t.nkeys=t.nkeyAuthenticator=t.NatsError=t.nanos=t.MsgHdrsImpl=t.millis=t.Metric=t.Match=t.jwtAuthenticator=t.JSONCodec=t.headers=t.Events=t.ErrorCode=t.Empty=t.delay=t.deferred=t.DebugEvents=t.deadline=t.credsAuthenticator=t.createInbox=t.canonicalMIMEHeaderKey=t.buildAuthenticator=t.Bench=t.backoff=void 0;var s=r(89969);Object.defineProperty(t,"backoff",{enumerable:!0,get:function(){return s.backoff}}),Object.defineProperty(t,"Bench",{enumerable:!0,get:function(){return s.Bench}}),Object.defineProperty(t,"buildAuthenticator",{enumerable:!0,get:function(){return s.buildAuthenticator}}),Object.defineProperty(t,"canonicalMIMEHeaderKey",{enumerable:!0,get:function(){return s.canonicalMIMEHeaderKey}}),Object.defineProperty(t,"createInbox",{enumerable:!0,get:function(){return s.createInbox}}),Object.defineProperty(t,"credsAuthenticator",{enumerable:!0,get:function(){return s.credsAuthenticator}}),Object.defineProperty(t,"deadline",{enumerable:!0,get:function(){return s.deadline}}),Object.defineProperty(t,"DebugEvents",{enumerable:!0,get:function(){return s.DebugEvents}}),Object.defineProperty(t,"deferred",{enumerable:!0,get:function(){return s.deferred}}),Object.defineProperty(t,"delay",{enumerable:!0,get:function(){return s.delay}}),Object.defineProperty(t,"Empty",{enumerable:!0,get:function(){return s.Empty}}),Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return s.ErrorCode}}),Object.defineProperty(t,"Events",{enumerable:!0,get:function(){return s.Events}}),Object.defineProperty(t,"headers",{enumerable:!0,get:function(){return s.headers}}),Object.defineProperty(t,"JSONCodec",{enumerable:!0,get:function(){return s.JSONCodec}}),Object.defineProperty(t,"jwtAuthenticator",{enumerable:!0,get:function(){return s.jwtAuthenticator}}),Object.defineProperty(t,"Match",{enumerable:!0,get:function(){return s.Match}}),Object.defineProperty(t,"Metric",{enumerable:!0,get:function(){return s.Metric}}),Object.defineProperty(t,"millis",{enumerable:!0,get:function(){return s.millis}}),Object.defineProperty(t,"MsgHdrsImpl",{enumerable:!0,get:function(){return s.MsgHdrsImpl}}),Object.defineProperty(t,"nanos",{enumerable:!0,get:function(){return s.nanos}}),Object.defineProperty(t,"NatsError",{enumerable:!0,get:function(){return s.NatsError}}),Object.defineProperty(t,"nkeyAuthenticator",{enumerable:!0,get:function(){return s.nkeyAuthenticator}}),Object.defineProperty(t,"nkeys",{enumerable:!0,get:function(){return s.nkeys}}),Object.defineProperty(t,"Nuid",{enumerable:!0,get:function(){return s.Nuid}}),Object.defineProperty(t,"nuid",{enumerable:!0,get:function(){return s.nuid}}),Object.defineProperty(t,"RequestStrategy",{enumerable:!0,get:function(){return s.RequestStrategy}}),Object.defineProperty(t,"ServiceError",{enumerable:!0,get:function(){return s.ServiceError}}),Object.defineProperty(t,"ServiceErrorCodeHeader",{enumerable:!0,get:function(){return s.ServiceErrorCodeHeader}}),Object.defineProperty(t,"ServiceErrorHeader",{enumerable:!0,get:function(){return s.ServiceErrorHeader}}),Object.defineProperty(t,"ServiceResponseType",{enumerable:!0,get:function(){return s.ServiceResponseType}}),Object.defineProperty(t,"ServiceVerb",{enumerable:!0,get:function(){return s.ServiceVerb}}),Object.defineProperty(t,"StringCodec",{enumerable:!0,get:function(){return s.StringCodec}}),Object.defineProperty(t,"syncIterator",{enumerable:!0,get:function(){return s.syncIterator}}),Object.defineProperty(t,"tokenAuthenticator",{enumerable:!0,get:function(){return s.tokenAuthenticator}}),Object.defineProperty(t,"usernamePasswordAuthenticator",{enumerable:!0,get:function(){return s.usernamePasswordAuthenticator}})},66348:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgImpl=void 0,t.isRequestError=function(e){var t;return e&&0===e.data.length&&(null===(t=e.headers)||void 0===t?void 0:t.code)===503?o.NatsError.errorForCode(o.ErrorCode.NoResponders):null};let s=r(24725),i=r(97636),n=r(25952),o=r(45067);class a{constructor(e,t,r){this._msg=e,this._rdata=t,this.publisher=r}get subject(){return this._subject||(this._subject=i.TD.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=i.TD.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){let e=this._rdata.subarray(0,this._msg.hdr);this._headers=s.MsgHdrsImpl.decode(e)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(e=i.Empty,t){return!!this.reply&&(this.publisher.publish(this.reply,e,t),!0)}size(){var e;return this._msg.subject.length+((null===(e=this._msg.reply)||void 0===e?void 0:e.length)||0)+(-1===this._msg.size?0:this._msg.size)}json(e){return(0,n.JSONCodec)(e).decode(this.data)}string(){return i.TD.decode(this.data)}requestInfo(){var e;let t=null===(e=this.headers)||void 0===e?void 0:e.get("Nats-Request-Info");return t?JSON.parse(t,function(e,t){return("start"===e||"stop"===e)&&""!==t?new Date(Date.parse(t)):t}):null}}t.MsgImpl=a},27611:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MuxSubscription=void 0;let s=r(66348),i=r(45067);class n{constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${(0,i.createInbox)(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){let t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(e=>{e.resolver(t,{})}),!0;let r=t.permissionContext;if("publish"===r.operation){let e=this.all().find(e=>e.requestSubject===r.subject);if(e)return e.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{let r=this.getToken(t);if(r){let i=this.get(r);i&&(null===e&&t.headers&&(e=(0,s.isRequestError)(t)),i.resolver(e,t))}}}close(){let e=i.NatsError.errorForCode(i.ErrorCode.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}t.MuxSubscription=n},2894:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServicesFactory=t.NatsConnectionImpl=void 0;let n=r(3009),o=r(3793),a=r(97636),c=r(91530),u=r(63248),l=r(35572),h=r(35611),d=r(55102),f=r(66348),p=r(36677),m=r(66426),y=r(59145),b=r(95817),g=r(45067);class v{constructor(e){this.draining=!1,this.options=(0,l.parseOptions)(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{let n=new v(e);o.ProtocolHandler.connect(n.options,n).then(e=>{n.protocol=e,function(){s(this,void 0,void 0,function*(){var t,r,s,o;try{for(var a,c=!0,u=i(e.status());!(t=(a=yield u.next()).done);c=!0)o=a.value,c=!1,n.listeners.forEach(e=>{e.push(o)})}catch(e){r={error:e}}finally{try{!c&&!t&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}})}(),t(n)}).catch(e=>{r(e)})})}closed(){return this.protocol.closed}close(){return s(this,void 0,void 0,function*(){yield this.protocol.close()})}_check(e,t,r){if(this.isClosed())throw c.NatsError.errorForCode(g.ErrorCode.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw c.NatsError.errorForCode(g.ErrorCode.ConnectionDraining);if(0===(e=e||"").length)throw c.NatsError.errorForCode(g.ErrorCode.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}publishMessage(e){return this.publish(e.subject,e.data,{reply:e.reply,headers:e.headers})}respondMessage(e){return!!e.reply&&(this.publish(e.reply,e.data,{reply:e.reply,headers:e.headers}),!0)}subscribe(e,t={}){this._check(e,!0,!1);let r=new o.SubscriptionImpl(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1),e.max=r,r&&(e.max=r+e.received),this.protocol.resub(e,t)}requestMany(e,t=a.Empty,r={maxWait:1e3,maxMessages:-1}){let s=!this.protocol.options.noAsyncTraces;try{this._check(e,!0,!0)}catch(e){return Promise.reject(e)}if(r.strategy=r.strategy||g.RequestStrategy.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new c.NatsError("timeout",g.ErrorCode.InvalidOption));let i=new h.QueuedIteratorImpl;function n(e){i.push(()=>{i.stop(e)})}function o(e,t){e||null===t?n(null===e?void 0:e):i.push(t)}if(r.noMux){let a=s?Error().stack:null,u="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,l=this.subscribe((0,g.createInbox)(this.options.inboxPrefix),{callback:(e,t)=>{var s,i;if((null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.length)===0&&(null===(i=null==t?void 0:t.headers)||void 0===i?void 0:i.status)===g.ErrorCode.NoResponders&&(e=c.NatsError.errorForCode(g.ErrorCode.NoResponders)),e){a&&(e.stack+=`

${a}`),h(e);return}o(null,t),r.strategy===g.RequestStrategy.Count&&0==--u&&h(),r.strategy===g.RequestStrategy.JitterTimer&&(f(),d=setTimeout(()=>{h()},300)),r.strategy===g.RequestStrategy.SentinelMsg&&t&&0===t.data.length&&h()}});l.requestSubject=e,l.closed.then(()=>{n()}).catch(e=>{i.stop(e)});let h=e=>{e&&i.push(()=>{throw e}),f(),l.drain().then(()=>{n()}).catch(e=>{n()})};i.iterClosed.then(()=>{f(),null==l||l.unsubscribe()}).catch(e=>{f(),null==l||l.unsubscribe()});try{this.publish(e,t,{reply:l.getSubject()})}catch(e){h(e)}let d=setTimeout(()=>{h()},r.maxWait),f=()=>{d&&clearTimeout(d)}}else{r.callback=o,i.iterClosed.then(()=>{s.cancel()}).catch(e=>{s.cancel(e)});let s=new d.RequestMany(this.protocol.muxSubscriptions,e,r);this.protocol.request(s);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${s.token}`,headers:r.headers})}catch(e){s.cancel(e)}}return Promise.resolve(i)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(e){return Promise.reject(e)}let s=!this.protocol.options.noAsyncTraces;if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new c.NatsError("timeout",g.ErrorCode.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new c.NatsError("reply can only be used with noMux",g.ErrorCode.InvalidOption));if(r.noMux){let i=r.reply?r.reply:(0,g.createInbox)(this.options.inboxPrefix),o=(0,n.deferred)(),a=s?Error():null,c=this.subscribe(i,{max:1,timeout:r.timeout,callback:(e,t)=>{e?(a&&e.code!==g.ErrorCode.Timeout&&(e.stack+=`

${a.stack}`),c.unsubscribe(),o.reject(e)):(e=(0,f.isRequestError)(t))?(a&&(e.stack+=`

${a.stack}`),o.reject(e)):o.resolve(t)}});return c.requestSubject=e,this.protocol.publish(e,t,{reply:i,headers:r.headers}),o}{let i=new d.RequestOne(this.protocol.muxSubscriptions,e,r,s);this.protocol.request(i);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${i.token}`,headers:r.headers})}catch(e){i.cancel(e)}let n=Promise.race([i.timer,i.deferred]);return n.catch(()=>{i.cancel()}),n}}flush(){return this.isClosed()?Promise.reject(c.NatsError.errorForCode(g.ErrorCode.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(c.NatsError.errorForCode(g.ErrorCode.ConnectionClosed)):this.isDraining()?Promise.reject(c.NatsError.errorForCode(g.ErrorCode.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){let e=this.protocol.getServer();return e?e.listen:""}status(){let e=new h.QueuedIteratorImpl;return e.iterClosed.then(()=>{let t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}context(){return s(this,void 0,void 0,function*(){return(yield this.request("$SYS.REQ.USER.INFO")).json((e,t)=>"time"===e?new Date(Date.parse(t)):t)})}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(){return s(this,arguments,void 0,function*(e={}){let t=new p.JetStreamManagerImpl(this,e);if(!1!==e.checkAPI)try{yield t.getAccountInfo()}catch(e){throw e.code===g.ErrorCode.NoResponders&&(e.code=g.ErrorCode.JetStreamNotEnabled),e}return t})}jetstream(e={}){return new m.JetStreamClientImpl(this,e)}getServerVersion(){let e=this.info;return e?(0,u.parseSemVer)(e.version):void 0}rtt(){return s(this,void 0,void 0,function*(){if(!this.protocol._closed&&!this.protocol.connected)throw c.NatsError.errorForCode(g.ErrorCode.Disconnect);let e=Date.now();return yield this.flush(),Date.now()-e})}get features(){return this.protocol.features}get services(){return this._services||(this._services=new _(this)),this._services}reconnect(){return this.isClosed()?Promise.reject(c.NatsError.errorForCode(g.ErrorCode.ConnectionClosed)):this.isDraining()?Promise.reject(c.NatsError.errorForCode(g.ErrorCode.ConnectionDraining)):this.protocol.reconnect()}}t.NatsConnectionImpl=v;class _{constructor(e){this.nc=e}add(e){try{return new y.ServiceImpl(this.nc,e).start()}catch(e){return Promise.reject(e)}}client(e,t){return new b.ServiceClientImpl(this.nc,e,t)}}t.ServicesFactory=_},99520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nkeys=void 0,t.nkeys=r(62620)},27723:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nuid=t.Nuid=void 0;let r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class s{constructor(){this.buf=new Uint8Array(22),this.inited=!1}init(){this.inited=!0,this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){var e;let t=new Uint8Array(12);(null===(e=null==globalThis?void 0:globalThis.crypto)||void 0===e?void 0:e.getRandomValues)?globalThis.crypto.getRandomValues(t):function(e){for(let t=0;t<e.length;t++)e[t]=Math.floor(255*Math.random())}(t);for(let e=0;e<12;e++){let s=t[e]%36;this.buf[e]=r.charCodeAt(s)}}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=r.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.inited||this.init(),this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}}t.Nuid=s,t.nuid=new s},35572:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RECONNECT_TIME_WAIT=t.DEFAULT_MAX_PING_OUT=t.DEFAULT_PING_INTERVAL=t.DEFAULT_JITTER_TLS=t.DEFAULT_JITTER=t.DEFAULT_MAX_RECONNECT_ATTEMPTS=void 0,t.defaultOptions=c,t.buildAuthenticator=u,t.parseOptions=function(e){let t=`${a.DEFAULT_HOST}:${(0,i.defaultPort)()}`;if((e=e||{servers:[t]}).servers=e.servers||[],"string"==typeof e.servers&&(e.servers=[e.servers]),e.servers.length>0&&e.port)throw new a.NatsError("port and servers options are mutually exclusive",a.ErrorCode.InvalidOption);0===e.servers.length&&e.port&&(e.servers=[`${a.DEFAULT_HOST}:${e.port}`]),e.servers&&0===e.servers.length&&(e.servers=[t]);let r=(0,s.extend)(c(),e);if(r.authenticator=u(r),["reconnectDelayHandler","authenticator"].forEach(e=>{if(r[e]&&"function"!=typeof r[e])throw new a.NatsError(`${e} option should be a function`,a.ErrorCode.NotFunction)}),r.reconnectDelayHandler||(r.reconnectDelayHandler=()=>{let e=r.tls?r.reconnectJitterTLS:r.reconnectJitter;return e&&(e=Math.floor(Math.random()*++e)),r.reconnectTimeWait+e}),r.inboxPrefix)try{(0,n.createInbox)(r.inboxPrefix)}catch(e){throw new a.NatsError(e.message,a.ErrorCode.ApiError)}if(void 0===r.resolve&&(r.resolve="function"==typeof(0,i.getResolveFn)()),r.resolve&&"function"!=typeof(0,i.getResolveFn)())throw new a.NatsError("'resolve' is not supported on this client",a.ErrorCode.InvalidOption);return r},t.checkOptions=function(e,t){let{proto:r,tls_required:s,tls_available:i}=e;if((void 0===r||r<1)&&t.noEcho)throw new a.NatsError("noEcho",a.ErrorCode.ServerOptionNotAvailable);if(t.tls&&!(s||i))throw new a.NatsError("tls",a.ErrorCode.ServerOptionNotAvailable)},t.checkUnsupportedOption=function(e,t){if(t)throw new a.NatsError(e,a.ErrorCode.InvalidOption)};let s=r(3009),i=r(35959),n=r(45067),o=r(65519),a=r(45067);function c(){return{maxPingOut:t.DEFAULT_MAX_PING_OUT,maxReconnectAttempts:t.DEFAULT_MAX_RECONNECT_ATTEMPTS,noRandomize:!1,pedantic:!1,pingInterval:t.DEFAULT_PING_INTERVAL,reconnect:!0,reconnectJitter:t.DEFAULT_JITTER,reconnectJitterTLS:t.DEFAULT_JITTER_TLS,reconnectTimeWait:t.DEFAULT_RECONNECT_TIME_WAIT,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1}}function u(e){let t=[];return"function"==typeof e.authenticator&&t.push(e.authenticator),Array.isArray(e.authenticator)&&t.push(...e.authenticator),e.token&&t.push((0,o.tokenAuthenticator)(e.token)),e.user&&t.push((0,o.usernamePasswordAuthenticator)(e.user,e.pass)),0===t.length?(0,o.noAuthFn)():(0,o.multiAuthenticator)(t)}t.DEFAULT_MAX_RECONNECT_ATTEMPTS=10,t.DEFAULT_JITTER=100,t.DEFAULT_JITTER_TLS=1e3,t.DEFAULT_PING_INTERVAL=12e4,t.DEFAULT_MAX_PING_OUT=2,t.DEFAULT_RECONNECT_TIME_WAIT=2e3},91433:(e,t,r)=>{"use strict";var s,i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.State=t.Parser=t.Kind=void 0,t.describe=function(e){let t;let r="";switch(e.kind){case s.MSG:t="MSG";break;case s.OK:t="OK";break;case s.ERR:t="ERR",r=a.TD.decode(e.data);break;case s.PING:t="PING";break;case s.PONG:t="PONG";break;case s.INFO:t="INFO",r=a.TD.decode(e.data)}return`${t}: ${r}`};let o=r(16405),a=r(97636);function c(){let e={};return e.sid=-1,e.hdr=-1,e.size=-1,e}!function(e){e[e.OK=0]="OK",e[e.ERR=1]="ERR",e[e.MSG=2]="MSG",e[e.INFO=3]="INFO",e[e.PING=4]="PING",e[e.PONG=5]="PONG"}(s||(t.Kind=s={}));class u{constructor(e){this.dispatcher=e,this.state=i.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){let r=e[t];switch(this.state){case i.OP_START:switch(r){case n.M:case n.m:this.state=i.OP_M,this.hdr=-1,this.ma=c();break;case n.H:case n.h:this.state=i.OP_H,this.hdr=0,this.ma=c();break;case n.P:case n.p:this.state=i.OP_P;break;case n.PLUS:this.state=i.OP_PLUS;break;case n.MINUS:this.state=i.OP_MINUS;break;case n.I:case n.i:this.state=i.OP_I;break;default:throw this.fail(e.subarray(t))}break;case i.OP_H:switch(r){case n.M:case n.m:this.state=i.OP_M;break;default:throw this.fail(e.subarray(t))}break;case i.OP_M:switch(r){case n.S:case n.s:this.state=i.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MS:switch(r){case n.G:case n.g:this.state=i.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MSG:switch(r){case n.SPACE:case n.TAB:this.state=i.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MSG_SPC:switch(r){case n.SPACE:case n.TAB:continue;default:this.state=i.MSG_ARG,this.as=t}break;case i.MSG_ARG:switch(r){case n.CR:this.drop=1;break;case n.NL:{let r=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(r),this.drop=0,this.as=t+1,this.state=i.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case i.MSG_PAYLOAD:if(this.msgBuf){if(this.msgBuf.length>=this.ma.size){let e=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:s.MSG,msg:this.ma,data:e}),this.argBuf=void 0,this.msgBuf=void 0,this.state=i.MSG_END}else{let s=this.ma.size-this.msgBuf.length,i=e.length-t;i<s&&(s=i),s>0?(this.msgBuf.write(e.subarray(t,t+s)),t=t+s-1):this.msgBuf.writeByte(r)}}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:s.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=i.MSG_END);break;case i.MSG_END:if(r!==n.NL)continue;this.drop=0,this.as=t+1,this.state=i.OP_START;break;case i.OP_PLUS:switch(r){case n.O:case n.o:this.state=i.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PLUS_O:switch(r){case n.K:case n.k:this.state=i.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PLUS_OK:r===n.NL&&(this.dispatcher.push({kind:s.OK}),this.drop=0,this.state=i.OP_START);break;case i.OP_MINUS:switch(r){case n.E:case n.e:this.state=i.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MINUS_E:switch(r){case n.R:case n.r:this.state=i.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MINUS_ER:switch(r){case n.R:case n.r:this.state=i.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MINUS_ERR:switch(r){case n.SPACE:case n.TAB:this.state=i.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case i.OP_MINUS_ERR_SPC:switch(r){case n.SPACE:case n.TAB:continue;default:this.state=i.MINUS_ERR_ARG,this.as=t}break;case i.MINUS_ERR_ARG:switch(r){case n.CR:this.drop=1;break;case n.NL:{let r;this.argBuf?(r=this.argBuf.bytes(),this.argBuf=void 0):r=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:s.ERR,data:r}),this.drop=0,this.as=t+1,this.state=i.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case i.OP_P:switch(r){case n.I:case n.i:this.state=i.OP_PI;break;case n.O:case n.o:this.state=i.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PO:switch(r){case n.N:case n.n:this.state=i.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PON:switch(r){case n.G:case n.g:this.state=i.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PONG:r===n.NL&&(this.dispatcher.push({kind:s.PONG}),this.drop=0,this.state=i.OP_START);break;case i.OP_PI:switch(r){case n.N:case n.n:this.state=i.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PIN:switch(r){case n.G:case n.g:this.state=i.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case i.OP_PING:r===n.NL&&(this.dispatcher.push({kind:s.PING}),this.drop=0,this.state=i.OP_START);break;case i.OP_I:switch(r){case n.N:case n.n:this.state=i.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case i.OP_IN:switch(r){case n.F:case n.f:this.state=i.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case i.OP_INF:switch(r){case n.O:case n.o:this.state=i.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case i.OP_INFO:switch(r){case n.SPACE:case n.TAB:this.state=i.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case i.OP_INFO_SPC:switch(r){case n.SPACE:case n.TAB:continue;default:this.state=i.INFO_ARG,this.as=t}break;case i.INFO_ARG:switch(r){case n.CR:this.drop=1;break;case n.NL:{let r;this.argBuf?(r=this.argBuf.bytes(),this.argBuf=void 0):r=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:s.INFO,data:r}),this.drop=0,this.as=t+1,this.state=i.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}this.state!==i.MSG_ARG&&this.state!==i.MINUS_ERR_ARG&&this.state!==i.INFO_ARG||this.argBuf||(this.argBuf=new o.DenoBuffer(e.subarray(this.as,t-this.drop))),this.state!==i.MSG_PAYLOAD||this.msgBuf||(this.argBuf||this.cloneMsgArg(),this.msgBuf=new o.DenoBuffer(e.subarray(this.as)))}cloneMsgArg(){let e=this.ma.subject.length,t=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));t.set(this.ma.subject),this.ma.reply&&t.set(this.ma.reply,e),this.argBuf=new o.DenoBuffer(t),this.ma.subject=t.subarray(0,e),this.ma.reply&&(this.ma.reply=t.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);let t=[],r=-1;for(let s=0;s<e.length;s++)switch(e[s]){case n.SPACE:case n.TAB:case n.CR:case n.NL:r>=0&&(t.push(e.subarray(r,s)),r=-1);break;default:r<0&&(r=s)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,Error(`${t}: ${a.TD.decode(e)}`)}processHeaderMsgArgs(e){let t=[],r=-1;for(let s=0;s<e.length;s++)switch(e[s]){case n.SPACE:case n.TAB:case n.CR:case n.NL:r>=0&&(t.push(e.subarray(r,s)),r=-1);break;default:r<0&&(r=s)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return -1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return -1;t=10*t+(e[r]-48)}return t}}t.Parser=u,function(e){e[e.OP_START=0]="OP_START",e[e.OP_PLUS=1]="OP_PLUS",e[e.OP_PLUS_O=2]="OP_PLUS_O",e[e.OP_PLUS_OK=3]="OP_PLUS_OK",e[e.OP_MINUS=4]="OP_MINUS",e[e.OP_MINUS_E=5]="OP_MINUS_E",e[e.OP_MINUS_ER=6]="OP_MINUS_ER",e[e.OP_MINUS_ERR=7]="OP_MINUS_ERR",e[e.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",e[e.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",e[e.OP_M=10]="OP_M",e[e.OP_MS=11]="OP_MS",e[e.OP_MSG=12]="OP_MSG",e[e.OP_MSG_SPC=13]="OP_MSG_SPC",e[e.MSG_ARG=14]="MSG_ARG",e[e.MSG_PAYLOAD=15]="MSG_PAYLOAD",e[e.MSG_END=16]="MSG_END",e[e.OP_H=17]="OP_H",e[e.OP_P=18]="OP_P",e[e.OP_PI=19]="OP_PI",e[e.OP_PIN=20]="OP_PIN",e[e.OP_PING=21]="OP_PING",e[e.OP_PO=22]="OP_PO",e[e.OP_PON=23]="OP_PON",e[e.OP_PONG=24]="OP_PONG",e[e.OP_I=25]="OP_I",e[e.OP_IN=26]="OP_IN",e[e.OP_INF=27]="OP_INF",e[e.OP_INFO=28]="OP_INFO",e[e.OP_INFO_SPC=29]="OP_INFO_SPC",e[e.INFO_ARG=30]="INFO_ARG"}(i||(t.State=i={})),function(e){e[e.CR="\r".charCodeAt(0)]="CR",e[e.E="E".charCodeAt(0)]="E",e[e.e="e".charCodeAt(0)]="e",e[e.F="F".charCodeAt(0)]="F",e[e.f="f".charCodeAt(0)]="f",e[e.G="G".charCodeAt(0)]="G",e[e.g="g".charCodeAt(0)]="g",e[e.H="H".charCodeAt(0)]="H",e[e.h="h".charCodeAt(0)]="h",e[e.I="I".charCodeAt(0)]="I",e[e.i="i".charCodeAt(0)]="i",e[e.K="K".charCodeAt(0)]="K",e[e.k="k".charCodeAt(0)]="k",e[e.M="M".charCodeAt(0)]="M",e[e.m="m".charCodeAt(0)]="m",e[e.MINUS="-".charCodeAt(0)]="MINUS",e[e.N="N".charCodeAt(0)]="N",e[e.n="n".charCodeAt(0)]="n",e[e.NL="\n".charCodeAt(0)]="NL",e[e.O="O".charCodeAt(0)]="O",e[e.o="o".charCodeAt(0)]="o",e[e.P="P".charCodeAt(0)]="P",e[e.p="p".charCodeAt(0)]="p",e[e.PLUS="+".charCodeAt(0)]="PLUS",e[e.R="R".charCodeAt(0)]="R",e[e.r="r".charCodeAt(0)]="r",e[e.S="S".charCodeAt(0)]="S",e[e.s="s".charCodeAt(0)]="s",e[e.SPACE=" ".charCodeAt(0)]="SPACE",e[e.TAB="	".charCodeAt(0)]="TAB"}(n||(n={}))},3793:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolHandler=t.Subscriptions=t.SubscriptionImpl=t.Connect=t.INFO=void 0;let n=r(97636),o=r(35959),a=r(3009),c=r(5364),u=r(61186),l=r(35611),h=r(27611),d=r(910),f=r(91433),p=r(66348),m=r(63248),y=r(45067),b=r(35572);t.INFO=/^INFO\s+([^\r\n]+)\r\n/i;let g=(0,n.encode)("PONG\r\n"),v=(0,n.encode)("PING\r\n");class _{constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name;let s=(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{};(0,a.extend)(this,s)}}t.Connect=_;class E extends l.QueuedIteratorImpl{constructor(e,t,r={}){var s;super(),(0,a.extend)(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=(0,a.deferred)();let i=!(null===(s=e.options)||void 0===s?void 0:s.noAsyncTraces);r.timeout&&(this.timer=(0,a.timeout)(r.timeout,i),this.timer.then(()=>{this.timer=void 0}).catch(e=>{this.stop(e),this.noIterator&&this.callback(e,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){let t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),s=e.protocolFilterFn?e.protocolFilterFn:()=>!0,i=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(e,n)=>{let{ingest:o}=r(n);o&&s(n)&&(t(e,n),i(n))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();let e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch(e){}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(y.NatsError.errorForCode(y.ErrorCode.ConnectionClosed)):this.isClosed()?Promise.reject(y.NatsError.errorForCode(y.ErrorCode.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush((0,a.deferred)()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}t.SubscriptionImpl=E;class S{constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){let t;let r=e.permissionContext,s=this.all();if("subscription"===r.operation&&(t=s.find(e=>e.subject===r.subject&&e.queue===r.queue)),"publish"===r.operation&&(t=s.find(e=>e.requestSubject===r.subject)),t)return t.callback(e,{}),t.close(),this.subs.delete(t.sid),t!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}t.Subscriptions=S;class P{constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new S,this.muxSubscriptions=new h.MuxSubscription,this.outbound=new c.DataBuffer,this.pongs=[],this.whyClosed="",this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new m.Features({major:0,minor:0,micro:0}),this.connectPromise=null;let r="string"==typeof e.servers?[e.servers]:e.servers;this.servers=new u.Servers(r,{randomize:!e.noRandomize}),this.closed=(0,a.deferred)(),this.parser=new f.Parser(this),this.heartbeats=new d.Heartbeat(this,this.options.pingInterval||b.DEFAULT_PING_INTERVAL,this.options.maxPingOut||b.DEFAULT_MAX_PING_OUT)}resetOutbound(){this.outbound.reset();let e=this.pongs;this.pongs=[];let t=y.NatsError.errorForCode(y.ErrorCode.Disconnect);t.stack="",e.forEach(e=>{e.reject(t)}),this.parser=new f.Parser(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){let e=new l.QueuedIteratorImpl;return this.listeners.push(e),e}prepare(){this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();let e=(0,a.deferred)();return e.catch(()=>{}),this.pongs.unshift(e),this.connectError=t=>{e.reject(t)},this.transport=(0,o.newTransport)(),this.transport.closed().then(e=>s(this,void 0,void 0,function*(){if(this.connected=!1,!this.isClosed()){yield this.disconnected(this.transport.closeError||this.lastError);return}})),e}disconnect(){this.dispatchStatus({type:y.DebugEvents.StaleConnection,data:""}),this.transport.disconnect()}reconnect(){return this.connected&&(this.dispatchStatus({type:y.DebugEvents.ClientInitiatedReconnect,data:""}),this.transport.disconnect()),Promise.resolve()}disconnected(e){return s(this,void 0,void 0,function*(){this.dispatchStatus({type:y.Events.Disconnect,data:this.servers.getCurrentServer().toString()}),this.options.reconnect?yield this.dialLoop().then(()=>{var e;this.dispatchStatus({type:y.Events.Reconnect,data:this.servers.getCurrentServer().toString()}),(null===(e=this.lastError)||void 0===e?void 0:e.code)===y.ErrorCode.AuthenticationExpired&&(this.lastError=void 0)}).catch(e=>{this._close(e)}):yield this._close(e)})}dial(e){return s(this,void 0,void 0,function*(){let t;let r=this.prepare();try{t=(0,a.timeout)(this.options.timeout||2e4);let r=this.transport.connect(e,this.options);yield Promise.race([r,t]),s(this,void 0,void 0,function*(){var e,t,r,s;try{try{for(var n,o=!0,a=i(this.transport);!(e=(n=yield a.next()).done);o=!0)s=n.value,o=!1,this.parser.parse(s)}catch(e){t={error:e}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(t)throw t.error}}}catch(e){console.log("reader closed",e)}}).then()}catch(e){r.reject(e)}try{yield Promise.race([t,r]),t&&t.cancel(),this.connected=!0,this.connectError=void 0,this.sendSubscriptions(),this.connectedOnce=!0,this.server.didConnect=!0,this.server.reconnects=0,this.flushPending(),this.heartbeats.start()}catch(e){throw t&&t.cancel(),yield this.transport.close(e),e}})}_doDial(e){return s(this,void 0,void 0,function*(){let{resolve:t}=this.options,r=yield e.resolve({fn:(0,o.getResolveFn)(),debug:this.options.debug,randomize:!this.options.noRandomize,resolve:t}),s=null;for(let e of r)try{s=null,this.dispatchStatus({type:y.DebugEvents.Reconnecting,data:e.toString()}),yield this.dial(e);return}catch(e){s=e}throw s})}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){return s(this,void 0,void 0,function*(){let e;for(;;){this._closed&&this.servers.clear();let t=this.options.reconnectDelayHandler?this.options.reconnectDelayHandler():b.DEFAULT_RECONNECT_TIME_WAIT,r=t,s=this.selectServer();if(!s||this.abortReconnect){if(e)throw e;if(this.lastError)throw this.lastError;throw y.NatsError.errorForCode(y.ErrorCode.ConnectionRefused)}let i=Date.now();if(0===s.lastConnect||s.lastConnect+t<=i){s.lastConnect=Date.now();try{yield this._doDial(s);break}catch(r){if(e=r,!this.connectedOnce){if(this.options.waitOnFirstConnect)continue;this.servers.removeCurrentServer()}s.reconnects++;let t=this.options.maxReconnectAttempts||0;-1!==t&&s.reconnects>=t&&this.servers.removeCurrentServer()}}else r=Math.min(r,s.lastConnect+t-i),yield(0,a.delay)(r)}})}static connect(e,t){return s(this,void 0,void 0,function*(){let r=new P(e,t);return yield r.dialLoop(),r})}static toError(e){let t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){let t=new y.NatsError(e,y.ErrorCode.PermissionsViolation),r=e.match(/(Publish|Subscription) to "(\S+)"/);if(r){t.permissionContext={operation:r[1].toLowerCase(),subject:r[2],queue:void 0};let s=e.match(/using queue "(\S+)"/);s&&(t.permissionContext.queue=s[1])}return t}return -1!==t.indexOf("authorization violation")?new y.NatsError(e,y.ErrorCode.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new y.NatsError(e,y.ErrorCode.AuthenticationExpired):-1!=t.indexOf("account authentication expired")?new y.NatsError(e,y.ErrorCode.AccountExpired):-1!==t.indexOf("authentication timeout")?new y.NatsError(e,y.ErrorCode.AuthenticationTimeout):new y.NatsError(e,y.ErrorCode.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;let r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new p.MsgImpl(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){let t=(0,n.decode)(e),r=P.toError(t),s={type:y.Events.Error,data:r.code};if(r.isPermissionError()){let e=!1;if(r.permissionContext){s.permissionContext=r.permissionContext;let t=this.subscriptions.getMux();e=(null==t?void 0:t.subject)===r.permissionContext.subject}this.subscriptions.handleError(r),this.muxSubscriptions.handleError(e,r),e&&this.subscriptions.setMux(null)}this.dispatchStatus(s),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):e.isProtocolError()?this.lastError=e:e.isAuthTimeout()&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(g)}processPong(){let e=this.pongs.shift();e&&e.resolve()}processInfo(e){let t=JSON.parse((0,n.decode)(e));this.info=t;let r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t,this.transport.isEncrypted());if(!this.infoReceived){this.features.update((0,m.parseSemVer)(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();let{version:e,lang:r}=this.transport;try{let s=new _({version:e,lang:r},this.options,t.nonce);t.headers&&(s.headers=!0,s.no_responders=!0);let i=JSON.stringify(s);this.transport.send((0,n.encode)(`CONNECT ${i}${o.CR_LF}`)),this.transport.send(v)}catch(e){this._close(e)}}r&&this.dispatchStatus({type:y.Events.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:y.Events.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case f.Kind.MSG:{let{msg:t,data:r}=e;this.processMsg(t,r);break}case f.Kind.OK:break;case f.Kind.ERR:this.processError(e.data);break;case f.Kind.PING:this.processPing();break;case f.Kind.PONG:this.processPong();break;case f.Kind.INFO:this.processInfo(e.data)}}sendCommand(e,...t){let r;let s=this.outbound.length();r="string"==typeof e?(0,n.encode)(e):e,this.outbound.fill(r,...t),0===s?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=n.Empty,r){let s,i;if(t instanceof Uint8Array)s=t;else if("string"==typeof t)s=n.TE.encode(t);else throw y.NatsError.errorForCode(y.ErrorCode.BadPayload);let a=s.length;(r=r||{}).reply=r.reply||"";let c=n.Empty,u=0;if(r.headers){if(this.info&&!this.info.headers)throw new y.NatsError("headers",y.ErrorCode.ServerOptionNotAvailable);u=(c=r.headers.encode()).length,a=s.length+u}if(this.info&&a>this.info.max_payload)throw y.NatsError.errorForCode(y.ErrorCode.MaxPayloadExceeded);this.outBytes+=a,this.outMsgs++,r.headers?(i=r.reply?`HPUB ${e} ${r.reply} ${u} ${a}\r
`:`HPUB ${e} ${u} ${a}\r
`,this.sendCommand(i,c,s,o.CRLF)):(i=r.reply?`PUB ${e} ${r.reply} ${a}\r
`:`PUB ${e} ${a}\r
`,this.sendCommand(i,s,o.CRLF))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){e.queue?this.sendCommand(`SUB ${e.subject} ${e.queue} ${e.sid}\r
`):this.sendCommand(`SUB ${e.subject} ${e.sid}\r
`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(t?this.sendCommand(`UNSUB ${e.sid} ${t}\r
`):this.sendCommand(`UNSUB ${e.sid}\r
`),e.max=t)}resub(e,t){!e||this.isClosed()||(this.unsub(e),e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=(0,a.deferred)()),this.pongs.push(e),this.outbound.fill(v),this.flushPending(),e}sendSubscriptions(){let e=[];this.subscriptions.all().forEach(t=>{t.queue?e.push(`SUB ${t.subject} ${t.queue} ${t.sid}${o.CR_LF}`):e.push(`SUB ${t.subject} ${t.sid}${o.CR_LF}`)}),e.length&&this.transport.send((0,n.encode)(e.join("")))}_close(e){return s(this,void 0,void 0,function*(){this._closed||(this.whyClosed=Error("close trace").stack||"",this.heartbeats.cancel(),this.connectError&&(this.connectError(e),this.connectError=void 0),this.muxSubscriptions.close(),this.subscriptions.close(),this.listeners.forEach(e=>{e.stop()}),this._closed=!0,yield this.transport.close(e),yield this.closed.resolve(e))})}close(){return this._close()}isClosed(){return this._closed}drain(){let e=this.subscriptions.all(),t=[];return e.forEach(e=>{t.push(e.drain())}),Promise.all(t).then(()=>s(this,void 0,void 0,function*(){return this.noMorePublishing=!0,yield this.flush(),this.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){let e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){let e=this.muxSubscriptions.init(this.options.inboxPrefix),t=new E(this,`${e}*`);t.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(t),this.subscribe(t)}}selectServer(){let e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}t.ProtocolHandler=P},35611:function(e,t,r){"use strict";var s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},i=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){n[e]&&(i[e]=function(t){return new Promise(function(r,s){o.push([e,t,r,s])>1||c(e,t)})},t&&(i[e]=t(i[e])))}function c(e,t){try{var r;(r=n[e](t)).value instanceof s?Promise.resolve(r.value.v).then(u,l):h(o[0][2],r)}catch(e){h(o[0][3],e)}}function u(e){c("next",e)}function l(e){c("throw",e)}function h(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t.QueuedIteratorImpl=void 0;let n=r(3009),o=r(45067);class a{constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=(0,n.deferred)(),this.yields=[],this.iterClosed=(0,n.deferred)(),this.time=0,this.yielding=!1}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e){this.yields.push(e),this.signal.resolve();return}let{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){return i(this,arguments,function*(){if(this.noIterator)throw new o.NatsError("unsupported iterator",o.ErrorCode.ApiError);if(this.yielding)throw new o.NatsError("already yielding",o.ErrorCode.ApiError);this.yielding=!0;try{for(;;){if(0===this.yields.length&&(yield s(this.signal)),this.err)throw this.err;let e=this.yields;this.inflight=e.length,this.yields=[];for(let t=0;t<e.length;t++){if("function"==typeof e[t]){let r=e[t];try{r()}catch(e){throw e}if(this.err)throw this.err;continue}if(!this.protocolFilterFn||this.protocolFilterFn(e[t])){this.processed++;let r=Date.now();yield yield s(e[t]),this.time=Date.now()-r,this.dispatchedFn&&e[t]&&this.dispatchedFn(e[t])}else this.pendingFiltered--;this.inflight--}if(this.done)break;0===this.yields.length&&(e.length=0,this.yields=e,this.signal=(0,n.deferred)())}}finally{this.stop()}})}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve(e))}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}t.QueuedIteratorImpl=a},55102:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestOne=t.RequestMany=t.BaseRequest=void 0;let s=r(3009),i=r(27723),n=r(45067);class o{constructor(e,t,r=!0){this.mux=e,this.requestSubject=t,this.received=0,this.token=i.nuid.next(),r&&(this.ctx=Error())}}t.BaseRequest=o;class a extends o{constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=(0,s.deferred)(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(this.ctx&&(e.stack+=`

${this.ctx.stack}`),this.cancel(e)):(this.callback(null,t),this.opts.strategy===n.RequestStrategy.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===n.RequestStrategy.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===n.RequestStrategy.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}t.RequestMany=a;class c extends o{constructor(e,t,r={timeout:1e3},i=!0){super(e,t,i),this.deferred=(0,s.deferred)(),this.timer=(0,s.timeout)(r.timeout,i)}resolver(e,t){this.timer&&this.timer.cancel(),e?(this.ctx&&(e.stack+=`

${this.ctx.stack}`),this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||n.NatsError.errorForCode(n.ErrorCode.Cancelled))}}t.RequestOne=c},63248:(e,t)=>{"use strict";var r;function s(e=""){let t=e.match(/(\d+).(\d+).(\d+)/);if(t)return{major:parseInt(t[1]),minor:parseInt(t[2]),micro:parseInt(t[3])};throw Error(`'${e}' is not a semver value`)}function i(e,t){return e.major<t.major?-1:e.major>t.major?1:e.minor<t.minor?-1:e.minor>t.minor?1:e.micro<t.micro?-1:e.micro>t.micro?1:0}Object.defineProperty(t,"__esModule",{value:!0}),t.Features=t.Feature=void 0,t.parseSemVer=s,t.compare=i,function(e){e.JS_KV="js_kv",e.JS_OBJECTSTORE="js_objectstore",e.JS_PULL_MAX_BYTES="js_pull_max_bytes",e.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",e.JS_ALLOW_DIRECT="js_allow_direct",e.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",e.JS_SIMPLIFICATION="js_simplification",e.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",e.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",e.JS_STREAM_FIRST_SEQ="js_stream_first_seq",e.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",e.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",e.JS_STREAM_COMPRESSION="js_stream_compression",e.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",e.JS_BATCH_DIRECT_GET="js_batch_direct_get"}(r||(t.Feature=r={}));class n{constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return -1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=s(e)),this.server=e,this.set(r.JS_KV,"2.6.2"),this.set(r.JS_OBJECTSTORE,"2.6.3"),this.set(r.JS_PULL_MAX_BYTES,"2.8.3"),this.set(r.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(r.JS_ALLOW_DIRECT,"2.9.0"),this.set(r.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(r.JS_SIMPLIFICATION,"2.9.4"),this.set(r.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(r.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(r.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(r.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(r.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(r.JS_STREAM_COMPRESSION,"2.10.0"),this.set(r.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.set(r.JS_BATCH_DIRECT_GET,"2.11.0"),this.disabled.forEach(e=>{this.features.delete(e)})}set(e,t){this.features.set(e,{min:t,ok:i(this.server,s(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){var t;return(null===(t=this.get(e))||void 0===t?void 0:t.ok)||!1}require(e){return"string"==typeof e&&(e=s(e)),i(this.server,e)>=0}}t.Features=n},61186:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Servers=t.ServerImpl=void 0,t.isIPV4OrHostname=c,t.hostPort=u;let i=r(35959),n=r(3009),o=r(70978),a=r(45067);function c(e){return -1===e.indexOf("[")&&-1===e.indexOf("::")&&(-1!==e.indexOf(".")||e.split(":").length<=2)}function u(e){(e=e.trim()).match(/^(.*:\/\/)(.*)/m)&&(e=e.replace(/^(.*:\/\/)(.*)/gm,"$2")),c(e=function(e){let t="::FFFF:",r=e.toUpperCase().indexOf(t);if(-1!==r&&-1!==e.indexOf(".")){let s=e.substring(r+t.length);return(s=s.replace("[","")).replace("]","")}return e}(e))||-1!==e.indexOf("[")||(e=`[${e}]`);let t=c(e)?e.match(/(:)(\d+)/):e.match(/(]:)(\d+)/),r=t&&3===t.length&&t[1]&&t[2]?parseInt(t[2]):a.DEFAULT_PORT,s=new URL(`${80===r?"https":"http"}://${e}`);s.port=`${r}`;let i=s.hostname;return"["===i.charAt(0)&&(i=i.substring(1,i.length-1)),{listen:s.host,hostname:i,port:r}}class l{constructor(e,t=!1){this.src=e,this.tlsName="";let r=u(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){return s(this,void 0,void 0,function*(){if(!e.fn||!1===e.resolve)return[this];let t=[];if((0,o.isIP)(this.hostname))return[this];{let r=yield e.fn(this.hostname);for(let s of(e.debug&&console.log(`resolve ${this.hostname} = ${r.join(",")}`),r)){let e=80===this.port?"https":"http",r=new URL(`${e}://${c(s)?s:"["+s+"]"}`);r.port=`${this.port}`;let i=new l(r.host,!1);i.tlsName=this.hostname,t.push(i)}}return e.randomize&&(0,n.shuffle)(t),this.resolves=t,t})}}t.ServerImpl=l;class h{constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;let r=(0,i.getUrlParseFn)();e&&(e.forEach(e=>{e=r?r(e):e,this.servers.push(new l(e))}),this.randomize&&(this.servers=(0,n.shuffle)(this.servers))),0===this.servers.length&&this.addServer(`${a.DEFAULT_HOST}:${(0,i.defaultPort)()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){let e=this.getCurrentServer();(0,o.isIP)(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(e=>{e.gossiped&&(e.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){let r=(0,i.getUrlParseFn)(),s=new l(e=r?r(e):e,t);(0,o.isIP)(s.hostname)&&(s.tlsName=this.tlsName),this.servers.push(s)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;let e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){let t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e,t){let r=[],s=[],n=(0,i.getUrlParseFn)(),o=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(e=>{let r=new l(e=n?n(e,t):e,!0);o.set(e,r)});let a=[];return this.servers.forEach((e,t)=>{let r=e.listen;e.gossiped&&this.currentServer.listen!==r&&void 0===o.get(r)&&a.push(t),o.delete(r)}),a.reverse(),a.forEach(e=>{let t=this.servers.splice(e,1);s=s.concat(t[0].listen)}),o.forEach((e,t)=>{this.servers.push(e),r.push(t)}),{added:r,deleted:s}}}t.Servers=h},59145:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceImpl=t.ServiceGroupImpl=t.ServiceMsgImpl=t.ServiceApiPrefix=void 0;let i=r(3009),n=r(24725),o=r(25952),a=r(27723),c=r(35611),u=r(82577),l=r(63248),h=r(97636),d=r(45067);t.ServiceApiPrefix="$SRV";class f{constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,s){var i,o;return(s=s||{}).headers=s.headers||(0,n.headers)(),null===(i=s.headers)||void 0===i||i.set(d.ServiceErrorCodeHeader,`${e}`),null===(o=s.headers)||void 0===o||o.set(d.ServiceErrorHeader,t),this.msg.respond(r,s)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}t.ServiceMsgImpl=f;class p{constructor(e,t="",r=""){""!==t&&function(e,t){if(-1!==t.indexOf(" "))throw Error(`${e} cannot contain spaces: '${t}'`);t.split(".").forEach(r=>{if(">"===r)throw Error(`${e} name cannot contain internal '>': '${t}'`)})}("service group",t);let s="";if(e instanceof m)this.srv=e,s="";else if(e instanceof p)this.srv=e.srv,""===r&&""!==e.queue&&(r=e.queue),s=e.subject;else throw Error("unknown ServiceGroup type");this.subject=this.calcSubject(s,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){let r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;(0,u.validateName)("endpoint",e);let{subject:s,handler:i,metadata:n,queue:o}=r;s=s||e,o=o||this.queue,function(e,t){if(""===t)throw Error(`${e} cannot be empty`);if(-1!==t.indexOf(" "))throw Error(`${e} cannot contain spaces: '${t}'`);let r=t.split(".");r.forEach((s,i)=>{if(">"===s&&i!==r.length-1)throw Error(`${e} cannot have internal '>': '${t}'`)})}("endpoint subject",s);let a={name:e,subject:s=this.calcSubject(this.subject,s),queue:o,handler:i,metadata:n};return this.srv._addEndpoint(a)}addGroup(e="",t=""){return new p(this,e,t)}}t.ServiceGroupImpl=p;class m{static controlSubject(e,r="",s="",i){let n=null!=i?i:t.ServiceApiPrefix;return""===r&&""===s?`${n}.${e}`:((0,u.validateName)("control subject name",r),""!==s)?((0,u.validateName)("control subject id",s),`${n}.${e}.${r}.${s}`):`${n}.${e}.${r}`}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),(0,u.validateName)("name",this.config.name),(0,u.validateName)("queue",this.config.queue),(0,l.parseSemVer)(this.config.version),this._id=a.nuid.next(),this.internal=[],this._done=(0,i.deferred)(),this._stopped=!1,this.handlers=[],this.started=new Date().toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(e=>{this.close(e).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){var e;return null!==(e=this.config.description)&&void 0!==e?e:""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){let t=(0,n.headers)();return e instanceof d.ServiceError?(t.set(d.ServiceErrorHeader,e.message),t.set(d.ServiceErrorCodeHeader,`${e.code}`)):(t.set(d.ServiceErrorHeader,e.message),t.set(d.ServiceErrorCodeHeader,"500")),t}setupHandler(e,t=!1){let r=t?"":e.queue?e.queue:this.config.queue,{name:s,subject:i,handler:n}=e;e.internal=t,t&&this.internal.push(e),e.stats=new y(s,i,r),e.queue=r;let o=n?(t,r)=>{if(t){this.close(t);return}let s=Date.now();try{n(t,new f(r))}catch(t){e.stats.countError(t),null==r||r.respond(h.Empty,{headers:this.errorToHeader(t)})}finally{e.stats.countLatency(s)}}:void 0;return e.sub=this.nc.subscribe(i,{callback:o,queue:r}),e.sub.closed.then(()=>{this._stopped||this.close(Error(`required subscription ${e.subject} stopped`)).catch()}).catch(t=>{if(!this._stopped){let r=Error(`required subscription ${e.subject} errored: ${t.message}`);r.stack=t.stack,this.close(r).catch()}}),e}info(){return{type:d.ServiceResponseType.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{let{subject:t,metadata:r,name:s,queue:i}=e;return{subject:t,metadata:r,name:s,queue_group:i}})}stats(){return s(this,void 0,void 0,function*(){let e=[];for(let t of this.handlers){if("function"==typeof this.config.statsHandler)try{t.stats.data=yield this.config.statsHandler(t)}catch(e){t.stats.countError(e)}e.push(t.stats.stats(t.qi))}return{type:d.ServiceResponseType.STATS,name:this.name,id:this.id,version:this.version,started:this.started,metadata:this.metadata,endpoints:e}})}addInternalHandler(e,t){let r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,s="",i=""){let n={};n.name=e,n.subject=m.controlSubject(t,s,i),n.handler=r,this.setupHandler(n,!0)}start(){let e=(0,o.JSONCodec)(),t=e.encode(this.ping());return this.addInternalHandler(d.ServiceVerb.PING,(e,r)=>e?(this.close(e).then().catch(),Promise.reject(e)):(r.respond(t),Promise.resolve())),this.addInternalHandler(d.ServiceVerb.STATS,(t,r)=>t?(this.close(t),Promise.reject(t)):this.stats().then(t=>(null==r||r.respond(e.encode(t)),Promise.resolve()))),this.addInternalHandler(d.ServiceVerb.INFO,(t,r)=>t?(this.close(t),Promise.reject(t)):(null==r||r.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(e=>{let{subject:t}=e;"string"==typeof t&&null!==e.handler&&this.setupHandler(e)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(e=>e.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:d.ServiceResponseType.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=new Date().toISOString(),this.handlers)for(let e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new p(this,e,t)}addEndpoint(e,t){return new p(this).addEndpoint(e,t)}_addEndpoint(e){let t=new c.QueuedIteratorImpl;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(e,r)=>{e?this.stop(e).catch():t.push(new f(r))},t.iterClosed.then(()=>{this.close().catch()}));let r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}t.ServiceImpl=m;class y{constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0,e&&(e.time=0,e.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=(0,i.nanos)(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){let{name:e,subject:t,average_processing_time:r,num_errors:s,num_requests:i,processing_time:n,last_error:o,data:a,queue:c}=this;return{name:e,subject:t,average_processing_time:r,num_errors:s,num_requests:i,processing_time:n,last_error:o,data:a,queue_group:c}}stats(e){return(null==e?void 0:e.noIterator)===!1&&(this.processing_time=(0,i.nanos)(e.time),this.num_requests=e.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}},95817:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceClientImpl=void 0;let n=r(97636),o=r(25952),a=r(35611),c=r(45067),u=r(59145),l=r(45067);class h{constructor(e,t={strategy:l.RequestStrategy.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(c.ServiceVerb.PING,e,t)}stats(e="",t=""){return this.q(c.ServiceVerb.STATS,e,t)}info(e="",t=""){return this.q(c.ServiceVerb.INFO,e,t)}q(e){return s(this,arguments,void 0,function*(e,t="",r=""){let c=new a.QueuedIteratorImpl,l=(0,o.JSONCodec)(),h=u.ServiceImpl.controlSubject(e,t,r,this.prefix),d=yield this.nc.requestMany(h,n.Empty,this.opts);return s(this,void 0,void 0,function*(){var e,t,r,s;try{for(var n,o=!0,a=i(d);!(e=(n=yield a.next()).done);o=!0){s=n.value,o=!1;try{let e=l.decode(s.data);c.push(e)}catch(e){c.push(()=>{c.stop(e)})}}}catch(e){t={error:e}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(t)throw t.error}}c.push(()=>{c.stop()})}).catch(e=>{c.stop(e)}),c})}}t.ServiceClientImpl=h},35959:(e,t,r)=>{"use strict";let s;Object.defineProperty(t,"__esModule",{value:!0}),t.LF=t.CR=t.CRLF=t.CR_LF_LEN=t.CR_LF=void 0,t.setTransportFactory=function(e){s=e},t.defaultPort=function(){return void 0!==s&&void 0!==s.defaultPort?s.defaultPort:n.DEFAULT_PORT},t.getUrlParseFn=function(){return void 0!==s&&s.urlParseFn?s.urlParseFn:void 0},t.newTransport=function(){if(!s||"function"!=typeof s.factory)throw Error("transport fn is not set");return s.factory()},t.getResolveFn=function(){return void 0!==s&&s.dnsResolveFn?s.dnsResolveFn:void 0},t.protoLen=a,t.extractProtocolMessage=function(e){let t=a(e);if(t>0){let r=new Uint8Array(e).slice(0,t);return i.TD.decode(r)}return""};let i=r(97636),n=r(45067),o=r(5364);function a(e){for(let r=0;r<e.length;r++){let s=r+1;if(e.byteLength>s&&e[r]===t.CR&&e[s]===t.LF)return s+1}return 0}t.CR_LF="\r\n",t.CR_LF_LEN=t.CR_LF.length,t.CRLF=o.DataBuffer.fromAscii(t.CR_LF),t.CR=new Uint8Array(t.CRLF)[0],t.LF=new Uint8Array(t.CRLF)[1]},91837:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.TypedSubscription=void 0,t.checkFn=a;let i=r(3009),n=r(35611),o=r(45067);function a(e,t,r=!1){if(!0===r&&!e||e&&"function"!=typeof e)throw o.NatsError.errorForCode(o.ErrorCode.ApiError,Error(`${t} is not a function`))}class c extends n.QueuedIteratorImpl{constructor(e,t,r){let n;super(),a(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&a(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(a(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(a(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(a(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&a(r.cleanupFn,"cleanupFn");let o=(e,t)=>{this.callback(e,t)};if(r.callback){let e=r.callback;o=(t,r)=>{let[s,i]=this.adapter(t,r);if(s){e(s,null);return}let{ingest:n}=this.ingestionFilterFn?this.ingestionFilterFn(i,this):{ingest:!0};n&&(!this.protocolFilterFn||this.protocolFilterFn(i))&&(e(s,i),this.dispatchedFn&&i&&this.dispatchedFn(i))}}let{max:c,queue:u,timeout:l}=r,h={queue:u,timeout:l,callback:o};c&&c>0&&(h.max=c),this.sub=e.subscribe(t,h),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=(0,i.deferred)(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(n=this.sub,s(this,void 0,void 0,function*(){yield n.closed,this.stop()})).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();let[r,s]=this.adapter(e,t);r&&this.stop(r),s&&this.push(s)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}t.TypedSubscription=c},91530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Empty=t.NatsError=void 0;var s=r(45067);Object.defineProperty(t,"NatsError",{enumerable:!0,get:function(){return s.NatsError}});var i=r(97636);Object.defineProperty(t,"Empty",{enumerable:!0,get:function(){return i.Empty}})},3009:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,i){(function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)})(s,i,(t=e[r](t)).done,t.value)})}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleMutex=t.Perf=void 0,t.extend=function(e,...t){for(let r=0;r<t.length;r++){let s=t[r];Object.keys(s).forEach(function(t){e[t]=s[t]})}return e},t.render=function(e){return n.TD.decode(e).replace(/\n/g,"").replace(/\r/g,"")},t.timeout=function(e,t=!0){let r,s;let i=t?o.NatsError.errorForCode(o.ErrorCode.Timeout):null;return Object.assign(new Promise((t,n)=>{r={cancel:()=>{s&&clearTimeout(s)}},s=setTimeout(()=>{null===i?n(o.NatsError.errorForCode(o.ErrorCode.Timeout)):n(i)},e)}),r)},t.delay=function(e=0){let t;return Object.assign(new Promise(r=>{let s=setTimeout(()=>{r()},e);t={cancel:()=>{s&&clearTimeout(s)}}}),t)},t.deadline=function(e,t=1e3){let r=Error("deadline exceeded"),s=a(),i=setTimeout(()=>s.reject(r),t);return Promise.race([e,s]).finally(()=>clearTimeout(i))},t.deferred=a,t.debugDeferred=function(){let e={};return Object.assign(new Promise((t,r)=>{e={resolve:e=>{console.trace("resolve",e),t(e)},reject:e=>{console.trace("reject"),r(e)}}}),e)},t.shuffle=function(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e},t.collect=function(e){return s(this,void 0,void 0,function*(){var t,r,s,n,o,a,c;let u=[];try{for(t=!0,r=i(e);!(n=(s=yield r.next()).done);t=!0)c=s.value,t=!1,u.push(c)}catch(e){o={error:e}}finally{try{!t&&!n&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return u})},t.jitter=l,t.backoffWithMax=function(e=3e4){let t=[e];for(;;){let r=Math.floor(e/2);if(r<100){t.unshift(0);break}t.unshift(r),e=r}return h(t)},t.backoff=h,t.nanos=function(e){return 1e6*e},t.millis=function(e){return Math.floor(e/1e6)};let n=r(97636),o=r(45067);function a(){let e={};return Object.assign(new Promise((t,r)=>{e={resolve:t,reject:r}}),e)}class c{constructor(){this.timers=new Map,this.measures=new Map}mark(e){this.timers.set(e,performance.now())}measure(e,t,r){let s=this.timers.get(t);if(void 0===s)throw Error(`${t} is not defined`);let i=this.timers.get(r);if(void 0===i)throw Error(`${r} is not defined`);this.measures.set(e,i-s)}getEntries(){let e=[];return this.measures.forEach((t,r)=>{e.push({name:r,duration:t})}),e}}t.Perf=c;class u{constructor(e=1){this.max=e,this.current=0,this.waiting=[]}lock(){if(this.current++,this.current<=this.max)return Promise.resolve();let e=a();return this.waiting.push(e),e}unlock(){this.current--;let e=this.waiting.pop();null==e||e.resolve()}}function l(e){return 0===e?0:Math.floor(e/2+Math.random()*e)}function h(e=[0,250,250,500,500,3e3,5e3]){Array.isArray(e)||(e=[0,250,250,500,500,3e3,5e3]);let t=e.length-1;return{backoff:r=>l(r>t?e[t]:e[r])}}t.SimpleMutex=u},88629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connect=function(e={}){return(0,i.setTransportFactory)({factory:()=>new s.NodeTransport,dnsResolveFn:s.nodeResolveHost}),i.NatsConnectionImpl.connect(e)};let s=r(2732),i=r(70887)},18048:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};if(Object.defineProperty(t,"__esModule",{value:!0}),t.connect=void 0,"undefined"==typeof TextEncoder){let{TextEncoder:e,TextDecoder:t}=r(21764);global.TextEncoder=e,global.TextDecoder=t}if(void 0===globalThis.crypto){let e=r(84770);global.crypto=e.webcrypto}if(void 0===globalThis.ReadableStream&&parseInt(process.versions.node.split(".")[0])>=16){let e=r(66083);global.ReadableStream=e.ReadableStream}var n=r(88629);Object.defineProperty(t,"connect",{enumerable:!0,get:function(){return n.connect}}),i(r(31606),t),i(r(56069),t)},70887:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(89969),t),i(r(78172),t)},2732:(e,t,r)=>{"use strict";var s=function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},i=function(e){return this instanceof i?(this.v=e,this):new i(e)},n=function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,n=r.apply(e,t||[]),o=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),s[Symbol.asyncIterator]=function(){return this},s;function a(e,t){n[e]&&(s[e]=function(t){return new Promise(function(r,s){o.push([e,t,r,s])>1||c(e,t)})},t&&(s[e]=t(s[e])))}function c(e,t){try{var r;(r=n[e](t)).value instanceof i?Promise.resolve(r.value.v).then(u,l):h(o[0][2],r)}catch(e){h(o[0][3],e)}}function u(e){c("next",e)}function l(e){c("throw",e)}function h(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}};Object.defineProperty(t,"__esModule",{value:!0}),t.NodeTransport=void 0,t.nodeResolveHost=function(e){return s(this,void 0,void 0,function*(){let t=(0,o.deferred)(),r=(0,o.deferred)();f.resolve4(e,(e,r)=>{e?t.resolve(e):t.resolve(r)}),f.resolve6(e,(e,t)=>{e?r.resolve(e):r.resolve(t)});let s=[],i=yield t;Array.isArray(i)&&s.push(...i);let n=yield r;return Array.isArray(n)&&s.push(...n),0===s.length&&s.push(e),s})};let o=r(70887),a=r(98216),c=r(3009),u=r(82452),{resolve:l}=r(55315),{readFile:h,existsSync:d}=r(92048),f=r(80665);class p{constructor(){this.yields=[],this.signal=(0,o.deferred)(),this.closedNotification=(0,o.deferred)(),this.connected=!1,this.tlsName="",this.done=!1,this.lang="nats.js",this.version="2.29.3"}connect(e,t){return s(this,void 0,void 0,function*(){this.tlsName=e.tlsName,this.options=t;let{tls:r}=this.options,{handshakeFirst:s}=r||{};try{!0===s?this.socket=yield this.tlsFirst(e):this.socket=yield this.dial(e);let r=yield this.peekInfo();(0,o.checkOptions)(r,t);let{tls_required:i,tls_available:n}=r,a=!0===n&&null!==t.tls;if(!s&&(i||a)&&(this.socket=yield this.startTLS()),i&&!0!==this.socket.encrypted)throw new o.NatsError("tls",o.ErrorCode.ServerOptionNotAvailable);return this.connected=!0,this.setupHandlers(),this.signal.resolve(),Promise.resolve()}catch(r){r||(r=o.NatsError.errorForCode(o.ErrorCode.ConnectionRefused,Error("node provided an undefined error!")));let{code:e}=r,t="ECONNREFUSED"===e?o.NatsError.errorForCode(o.ErrorCode.ConnectionRefused,r):r;throw this.socket&&this.socket.destroy(),t}})}dial(e){let t;let r=(0,o.deferred)(),s=(0,a.createConnection)(e.port,e.hostname,()=>{r.resolve(s),s.removeAllListeners()});return s.on("error",e=>{t=e}),s.on("close",()=>{s.removeAllListeners(),r.reject(t)}),s.setNoDelay(!0),r}get isClosed(){return this.done}close(e){return this._closed(e,!1)}peekInfo(){let e;let t=(0,o.deferred)();return this.socket.on("data",e=>{this.yields.push(e);let r=o.DataBuffer.concat(...this.yields),s=(0,o.extractProtocolMessage)(r);if(""!==s)try{let e=o.INFO.exec(s);if(!e)throw Error("unexpected response from server");let r=JSON.parse(e[1]);t.resolve(r)}catch(e){t.reject(e)}finally{this.socket.removeAllListeners()}}),this.socket.on("error",t=>{e=t}),this.socket.on("close",()=>{this.socket.removeAllListeners(),t.reject(e)}),t}loadFile(e){if(!e)return Promise.resolve();let t=(0,o.deferred)();try{e=l(e),d(e)||t.reject(Error(`${e} doesn't exist`)),h(e,(e,r)=>{if(e)return t.reject(e);t.resolve(r)})}catch(e){t.reject(e)}return t}loadClientCerts(){return s(this,void 0,void 0,function*(){let e={},{certFile:t,cert:r,caFile:s,ca:i,keyFile:n,key:o}=this.options.tls;try{if(t){let r=yield this.loadFile(t);r&&(e.cert=r)}else r&&(e.cert=r);if(n){let t=yield this.loadFile(n);t&&(e.key=t)}else o&&(e.key=o);if(s){let t=yield this.loadFile(s);t&&(e.ca=[t])}else i&&(e.ca=i);return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}tlsFirst(e){return s(this,void 0,void 0,function*(){let t;let r={servername:this.tlsName,rejectUnauthorized:!0};if(this.socket&&(r.socket=this.socket),"object"==typeof this.options.tls)try{let e=(yield this.loadClientCerts())||{};r=(0,c.extend)(r,this.options.tls,e)}catch(e){return Promise.reject(new o.NatsError(e.message,o.ErrorCode.Tls,e))}let s=(0,o.deferred)();try{let i=(0,u.connect)(e.port,e.hostname,r,()=>{i.removeAllListeners(),s.resolve(i)});i.on("error",e=>{t=e}),i.on("secureConnect",()=>{if(!1!==r.rejectUnauthorized&&!i.authorized)throw i.authorizationError}),i.on("close",()=>{s.reject(t),i.removeAllListeners()}),i.setNoDelay(!0)}catch(e){s.reject(o.NatsError.errorForCode(o.ErrorCode.Tls,e))}return s})}startTLS(){return s(this,void 0,void 0,function*(){let e;let t={socket:this.socket,servername:this.tlsName,rejectUnauthorized:!0};if("object"==typeof this.options.tls)try{let e=(yield this.loadClientCerts())||{};t=(0,c.extend)(t,this.options.tls,e)}catch(e){return Promise.reject(new o.NatsError(e.message,o.ErrorCode.Tls,e))}let r=(0,o.deferred)();try{let s=(0,u.connect)(t,()=>{s.removeAllListeners(),r.resolve(s)});s.on("error",t=>{e=t}),s.on("secureConnect",()=>{if(!1!==t.rejectUnauthorized&&!s.authorized)throw s.authorizationError}),s.on("close",()=>{r.reject(e),s.removeAllListeners()})}catch(e){r.reject(o.NatsError.errorForCode(o.ErrorCode.Tls,e))}return r})}setupHandlers(){let e;this.socket.on("data",e=>(this.yields.push(e),this.signal.resolve())),this.socket.on("error",t=>{e=t}),this.socket.on("end",()=>{var e,t;null!==(e=this.socket)&&void 0!==e&&e.destroyed||null===(t=this.socket)||void 0===t||t.write(new Uint8Array(0),()=>{var e;null===(e=this.socket)||void 0===e||e.end()})}),this.socket.on("close",()=>{this._closed(e,!1)})}[Symbol.asyncIterator](){return this.iterate()}iterate(){return n(this,arguments,function*(){for(this.options.debug;;){0===this.yields.length&&(yield i(this.signal));let e=this.yields;this.yields=[];for(let t=0;t<e.length;t++)yield yield i(e[t]);if(this.done)break;0===this.yields.length&&(e.length=0,this.yields=e,this.signal=(0,o.deferred)())}})}discard(){}disconnect(){this._closed(void 0,!0).then().catch()}isEncrypted(){return this.socket instanceof u.TLSSocket}_send(e){if(this.isClosed||void 0===this.socket)return Promise.resolve();this.options.debug;let t=(0,o.deferred)();try{this.socket.write(e,r=>r?(this.options.debug&&console.error(`!!! ${(0,o.render)(e)}: ${r}`),t.reject(r)):t.resolve())}catch(r){this.options.debug&&console.error(`!!! ${(0,o.render)(e)}: ${r}`),t.reject(r)}return t}send(e){this._send(e).catch(e=>{})}_closed(e){return s(this,arguments,void 0,function*(e,t=!0){if(this.connected&&!this.done){if(this.closeError=e,!e&&this.socket&&t)try{yield this._send(new TextEncoder().encode(""))}catch(e){this.options.debug}try{this.socket&&(this.socket.removeAllListeners(),this.socket.destroy(),this.socket=void 0)}catch(e){}this.done=!0,this.closedNotification.resolve(this.closeError)}})}closed(){return this.closedNotification}}t.NodeTransport=p},272:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base32=void 0;let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";class s{static encode(e){let t=0,s=0,i=new Uint8Array(e),n=new Uint8Array(2*e.byteLength),o=0;for(let e=0;e<i.byteLength;e++)for(s=s<<8|i[e],t+=8;t>=5;){let e=s>>>t-5&31;n[o++]=r.charAt(e).charCodeAt(0),t-=5}if(t>0){let e=s<<5-t&31;n[o++]=r.charAt(e).charCodeAt(0)}return n.slice(0,o)}static decode(e){let t=0,s=0,i=0,n=new Uint8Array(e),o=new Uint8Array(5*n.byteLength/8|0);for(let e=0;e<n.byteLength;e++){let a=String.fromCharCode(n[e]),c=r.indexOf(a);if(-1===c)throw Error("Illegal Base32 character: "+n[e]);s=s<<5|c,(t+=5)>=8&&(o[i++]=s>>>t-8&255,t-=8)}return o.slice(0,i)}}t.base32=s},30984:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Codec=void 0;let s=r(16386),i=r(78179),n=r(272);class o{static encode(e,t){if(!t||!(t instanceof Uint8Array))throw new i.NKeysError(i.NKeysErrorCode.SerializationError);if(!i.Prefixes.isValidPrefix(e))throw new i.NKeysError(i.NKeysErrorCode.InvalidPrefixByte);return o._encode(!1,e,t)}static encodeSeed(e,t){if(!t)throw new i.NKeysError(i.NKeysErrorCode.ApiError);if(!i.Prefixes.isValidPublicPrefix(e))throw new i.NKeysError(i.NKeysErrorCode.InvalidPrefixByte);if(32!==t.byteLength)throw new i.NKeysError(i.NKeysErrorCode.InvalidSeedLen);return o._encode(!0,e,t)}static decode(e,t){if(!i.Prefixes.isValidPrefix(e))throw new i.NKeysError(i.NKeysErrorCode.InvalidPrefixByte);let r=o._decode(t);if(r[0]!==e)throw new i.NKeysError(i.NKeysErrorCode.InvalidPrefixByte);return r.slice(1)}static decodeSeed(e){let t=o._decode(e),r=o._decodePrefix(t);if(r[0]!=i.Prefix.Seed)throw new i.NKeysError(i.NKeysErrorCode.InvalidSeed);if(!i.Prefixes.isValidPublicPrefix(r[1]))throw new i.NKeysError(i.NKeysErrorCode.InvalidPrefixByte);return{buf:t.slice(2),prefix:r[1]}}static _encode(e,t,r){let a=e?2:1,c=r.byteLength,u=a+c,l=new Uint8Array(a+c+2);if(e){let e=o._encodePrefix(i.Prefix.Seed,t);l.set(e)}else l[0]=t;l.set(r,a);let h=s.crc16.checksum(l.slice(0,u));return new DataView(l.buffer).setUint16(u,h,!0),n.base32.encode(l)}static _decode(e){let t;if(e.byteLength<4)throw new i.NKeysError(i.NKeysErrorCode.InvalidEncoding);try{t=n.base32.decode(e)}catch(e){throw new i.NKeysError(i.NKeysErrorCode.InvalidEncoding,e)}let r=t.byteLength-2,o=new DataView(t.buffer).getUint16(r,!0),a=t.slice(0,r);if(!s.crc16.validate(a,o))throw new i.NKeysError(i.NKeysErrorCode.InvalidChecksum);return a}static _encodePrefix(e,t){return new Uint8Array([e|t>>5,(31&t)<<3])}static _decodePrefix(e){return new Uint8Array([248&e[0],(7&e[0])<<5|(248&e[1])>>3])}}t.Codec=o},16386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crc16=void 0;let r=new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]);class s{static checksum(e){let t=0;for(let s=0;s<e.byteLength;s++)t=t<<8&65535^r[(t>>8^e[s])&255];return t}static validate(e,t){return s.checksum(e)==t}}t.crc16=s},47907:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CurveKP=t.curveNonceLen=t.curveKeyLen=void 0;let s=r(78179),i=r(56592),n=r(30984),o=r(48057),a=r(272),c=r(16386);t.curveKeyLen=32,t.curveNonceLen=24;let u=[120,107,118,49];class l{constructor(e){this.seed=e}clear(){this.seed&&(this.seed.fill(0),this.seed=void 0)}getPrivateKey(){if(!this.seed)throw new s.NKeysError(s.NKeysErrorCode.ClearedPair);return n.Codec.encode(o.Prefix.Private,this.seed)}getPublicKey(){if(!this.seed)throw new s.NKeysError(s.NKeysErrorCode.ClearedPair);let e=(0,i.getEd25519Helper)().scalarBaseMultiply(this.seed),t=n.Codec.encode(o.Prefix.Curve,e);return new TextDecoder().decode(t)}getSeed(){if(!this.seed)throw new s.NKeysError(s.NKeysErrorCode.ClearedPair);return n.Codec.encodeSeed(o.Prefix.Curve,this.seed)}sign(){throw new s.NKeysError(s.NKeysErrorCode.InvalidCurveOperation)}verify(){throw new s.NKeysError(s.NKeysErrorCode.InvalidCurveOperation)}decodePubCurveKey(e){try{let t=a.base32.decode(new TextEncoder().encode(e));if(35!==t.byteLength)throw new s.NKeysError(s.NKeysErrorCode.InvalidCurveKey);if(t[0]!==o.Prefix.Curve)throw new s.NKeysError(s.NKeysErrorCode.InvalidPublicKey);let r=t.byteLength-2,i=new DataView(t.buffer).getUint16(r,!0),n=t.slice(0,r);if(!c.crc16.validate(n,i))throw new s.NKeysError(s.NKeysErrorCode.InvalidChecksum);return n.slice(1)}catch(e){throw new s.NKeysError(s.NKeysErrorCode.InvalidRecipient,e)}}seal(e,r,n){if(!this.seed)throw new s.NKeysError(s.NKeysErrorCode.ClearedPair);n||(n=(0,i.getEd25519Helper)().randomBytes(t.curveNonceLen));let o=this.decodePubCurveKey(r),a=new Uint8Array(u.length+t.curveNonceLen);a.set(u,0),a.set(n,u.length);let c=(0,i.getEd25519Helper)().seal(e,n,o,this.seed),l=new Uint8Array(a.length+c.length);return l.set(a),l.set(c,a.length),l}open(e,r){if(!this.seed)throw new s.NKeysError(s.NKeysErrorCode.ClearedPair);if(e.length<=t.curveNonceLen+u.length)throw new s.NKeysError(s.NKeysErrorCode.InvalidEncrypted);for(let t=0;t<u.length;t++)if(e[t]!==u[t])throw new s.NKeysError(s.NKeysErrorCode.InvalidEncrypted);let n=this.decodePubCurveKey(r),o=(e=e.slice(u.length)).slice(0,t.curveNonceLen);return e=e.slice(t.curveNonceLen),(0,i.getEd25519Helper)().open(e,o,n,this.seed)}}t.CurveKP=l},56592:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.getEd25519Helper=t.setEd25519Helper=void 0,t.setEd25519Helper=function(e){r=e},t.getEd25519Helper=function(){return r}},62620:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0});let n=r(88903),o={randomBytes:n.randomBytes,verify:n.sign.detached.verify,fromSeed:n.sign.keyPair.fromSeed,sign:n.sign.detached,scalarBaseMultiply:n.scalarMult.base,seal:n.box,open:n.box.open};if("undefined"==typeof TextEncoder){let e=r(21764);global.TextEncoder=e.TextEncoder,global.TextDecoder=e.TextDecoder}"undefined"==typeof atob&&(global.atob=e=>Buffer.from(e,"base64").toString("binary"),global.btoa=e=>Buffer.from(e,"binary").toString("base64"));let{setEd25519Helper:a}=r(56592);a(o),i(r(48057),t)},65866:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KP=void 0;let s=r(30984),i=r(78179),n=r(56592);class o{constructor(e){this.seed=e}getRawSeed(){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);return s.Codec.decodeSeed(this.seed).buf}getSeed(){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);return this.seed}getPublicKey(){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);let e=s.Codec.decodeSeed(this.seed),t=(0,n.getEd25519Helper)().fromSeed(this.getRawSeed()),r=s.Codec.encode(e.prefix,t.publicKey);return new TextDecoder().decode(r)}getPrivateKey(){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);let e=(0,n.getEd25519Helper)().fromSeed(this.getRawSeed());return s.Codec.encode(i.Prefix.Private,e.secretKey)}sign(e){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);let t=(0,n.getEd25519Helper)().fromSeed(this.getRawSeed());return(0,n.getEd25519Helper)().sign(e,t.secretKey)}verify(e,t){if(!this.seed)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);let r=(0,n.getEd25519Helper)().fromSeed(this.getRawSeed());return(0,n.getEd25519Helper)().verify(e,t,r.publicKey)}clear(){this.seed&&(this.seed.fill(0),this.seed=void 0)}seal(e,t,r){throw new i.NKeysError(i.NKeysErrorCode.InvalidNKeyOperation)}open(e,t){throw new i.NKeysError(i.NKeysErrorCode.InvalidNKeyOperation)}}t.KP=o},48057:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decode=t.Prefix=t.NKeysErrorCode=t.NKeysError=t.fromSeed=t.fromPublic=t.fromCurveSeed=t.createUser=t.createServer=t.createPair=t.createOperator=t.createCurve=t.createCluster=t.createAccount=void 0;var s=r(78179);Object.defineProperty(t,"createAccount",{enumerable:!0,get:function(){return s.createAccount}}),Object.defineProperty(t,"createCluster",{enumerable:!0,get:function(){return s.createCluster}}),Object.defineProperty(t,"createCurve",{enumerable:!0,get:function(){return s.createCurve}}),Object.defineProperty(t,"createOperator",{enumerable:!0,get:function(){return s.createOperator}}),Object.defineProperty(t,"createPair",{enumerable:!0,get:function(){return s.createPair}}),Object.defineProperty(t,"createServer",{enumerable:!0,get:function(){return s.createServer}}),Object.defineProperty(t,"createUser",{enumerable:!0,get:function(){return s.createUser}}),Object.defineProperty(t,"fromCurveSeed",{enumerable:!0,get:function(){return s.fromCurveSeed}}),Object.defineProperty(t,"fromPublic",{enumerable:!0,get:function(){return s.fromPublic}}),Object.defineProperty(t,"fromSeed",{enumerable:!0,get:function(){return s.fromSeed}}),Object.defineProperty(t,"NKeysError",{enumerable:!0,get:function(){return s.NKeysError}}),Object.defineProperty(t,"NKeysErrorCode",{enumerable:!0,get:function(){return s.NKeysErrorCode}}),Object.defineProperty(t,"Prefix",{enumerable:!0,get:function(){return s.Prefix}});var i=r(20666);Object.defineProperty(t,"decode",{enumerable:!0,get:function(){return i.decode}}),Object.defineProperty(t,"encode",{enumerable:!0,get:function(){return i.encode}})},78179:(e,t,r)=>{"use strict";var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.NKeysError=t.NKeysErrorCode=t.Prefixes=t.Prefix=t.fromSeed=t.fromCurveSeed=t.fromPublic=t.createCurve=t.createServer=t.createCluster=t.createUser=t.createAccount=t.createOperator=t.createPair=void 0;let n=r(65866),o=r(32044),a=r(30984),c=r(56592),u=r(47907);function l(e){let t=e===s.Curve?u.curveKeyLen:32,r=(0,c.getEd25519Helper)().randomBytes(t),i=a.Codec.encodeSeed(e,new Uint8Array(r));return e===s.Curve?new u.CurveKP(new Uint8Array(r)):new n.KP(i)}function h(e){let t=a.Codec.decodeSeed(e);if(t.prefix!==s.Curve)throw new f(i.InvalidCurveSeed);if(t.buf.byteLength!==u.curveKeyLen)throw new f(i.InvalidSeedLen);return new u.CurveKP(t.buf)}t.createPair=l,t.createOperator=function(){return l(s.Operator)},t.createAccount=function(){return l(s.Account)},t.createUser=function(){return l(s.User)},t.createCluster=function(){return l(s.Cluster)},t.createServer=function(){return l(s.Server)},t.createCurve=function(){return l(s.Curve)},t.fromPublic=function(e){let t=new TextEncoder().encode(e),r=a.Codec._decode(t),s=d.parsePrefix(r[0]);if(d.isValidPublicPrefix(s))return new o.PublicKey(t);throw new f(i.InvalidPublicKey)},t.fromCurveSeed=h,t.fromSeed=function(e){return a.Codec.decodeSeed(e).prefix===s.Curve?h(e):new n.KP(e)},function(e){e[e.Unknown=-1]="Unknown",e[e.Seed=144]="Seed",e[e.Private=120]="Private",e[e.Operator=112]="Operator",e[e.Server=104]="Server",e[e.Cluster=16]="Cluster",e[e.Account=0]="Account",e[e.User=160]="User",e[e.Curve=184]="Curve"}(s||(t.Prefix=s={}));class d{static isValidPublicPrefix(e){return e==s.Server||e==s.Operator||e==s.Cluster||e==s.Account||e==s.User||e==s.Curve}static startsWithValidPrefix(e){let t=e[0];return"S"==t||"P"==t||"O"==t||"N"==t||"C"==t||"A"==t||"U"==t||"X"==t}static isValidPrefix(e){return this.parsePrefix(e)!==s.Unknown}static parsePrefix(e){switch(e){case s.Seed:return s.Seed;case s.Private:return s.Private;case s.Operator:return s.Operator;case s.Server:return s.Server;case s.Cluster:return s.Cluster;case s.Account:return s.Account;case s.User:return s.User;case s.Curve:return s.Curve;default:return s.Unknown}}}t.Prefixes=d,function(e){e.InvalidPrefixByte="nkeys: invalid prefix byte",e.InvalidKey="nkeys: invalid key",e.InvalidPublicKey="nkeys: invalid public key",e.InvalidSeedLen="nkeys: invalid seed length",e.InvalidSeed="nkeys: invalid seed",e.InvalidCurveSeed="nkeys: invalid curve seed",e.InvalidCurveKey="nkeys: not a valid curve key",e.InvalidCurveOperation="nkeys: curve key is not valid for sign/verify",e.InvalidNKeyOperation="keys: only curve key can seal/open",e.InvalidEncoding="nkeys: invalid encoded key",e.InvalidRecipient="nkeys: not a valid recipient public curve key",e.InvalidEncrypted="nkeys: encrypted input is not valid",e.CannotSign="nkeys: cannot sign, no private key available",e.PublicKeyOnly="nkeys: no seed or private key available",e.InvalidChecksum="nkeys: invalid checksum",e.SerializationError="nkeys: serialization error",e.ApiError="nkeys: api error",e.ClearedPair="nkeys: pair is cleared"}(i||(t.NKeysErrorCode=i={}));class f extends Error{constructor(e,t){super(e),this.name="NKeysError",this.code=e,this.chainedError=t}}t.NKeysError=f},32044:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublicKey=void 0;let s=r(30984),i=r(78179),n=r(56592);class o{constructor(e){this.publicKey=e}getPublicKey(){if(!this.publicKey)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);return new TextDecoder().decode(this.publicKey)}getPrivateKey(){if(!this.publicKey)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);throw new i.NKeysError(i.NKeysErrorCode.PublicKeyOnly)}getSeed(){if(!this.publicKey)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);throw new i.NKeysError(i.NKeysErrorCode.PublicKeyOnly)}sign(e){if(!this.publicKey)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);throw new i.NKeysError(i.NKeysErrorCode.CannotSign)}verify(e,t){if(!this.publicKey)throw new i.NKeysError(i.NKeysErrorCode.ClearedPair);let r=s.Codec._decode(this.publicKey);return(0,n.getEd25519Helper)().verify(e,t,r.slice(1))}clear(){this.publicKey&&(this.publicKey.fill(0),this.publicKey=void 0)}seal(e,t,r){throw new i.NKeysError(i.NKeysErrorCode.InvalidNKeyOperation)}open(e,t){throw new i.NKeysError(i.NKeysErrorCode.InvalidNKeyOperation)}}t.PublicKey=o},20666:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dump=t.decode=t.encode=void 0,t.encode=function(e){return btoa(String.fromCharCode(...e))},t.decode=function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},t.dump=function(e,t){t&&console.log(t);let r=[];for(let t=0;t<e.byteLength;t++){t%8==0&&r.push("\n");let s=e[t].toString(16);1===s.length&&(s="0"+s),r.push(s)}console.log(r.join("  "))}},88903:(e,t,r)=>{!function(e){"use strict";var t,s=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},i=function(){throw Error("no PRNG")},n=new Uint8Array(16),o=new Uint8Array(32);o[0]=9;var a=s(),c=s([1]),u=s([56129,1]),l=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),h=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),f=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),p=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function m(e,t,r,s){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=s>>24&255,e[t+5]=s>>16&255,e[t+6]=s>>8&255,e[t+7]=255&s}function y(e,t,r,s,i){var n,o=0;for(n=0;n<i;n++)o|=e[t+n]^r[s+n];return(1&o-1>>>8)-1}function b(e,t,r,s){return y(e,t,r,s,16)}function g(e,t,r,s){return y(e,t,r,s,32)}function v(e,t,r,s){!function(e,t,r,s){for(var i,n=255&s[0]|(255&s[1])<<8|(255&s[2])<<16|(255&s[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&s[4]|(255&s[5])<<8|(255&s[6])<<16|(255&s[7])<<24,h=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,d=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,f=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,m=255&s[8]|(255&s[9])<<8|(255&s[10])<<16|(255&s[11])<<24,y=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,b=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,g=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,_=255&s[12]|(255&s[13])<<8|(255&s[14])<<16|(255&s[15])<<24,E=n,S=o,P=a,w=c,C=u,O=l,A=h,x=d,j=f,I=p,N=m,k=y,M=b,T=g,R=v,U=_,F=0;F<20;F+=2)C^=(i=E+M|0)<<7|i>>>25,j^=(i=C+E|0)<<9|i>>>23,M^=(i=j+C|0)<<13|i>>>19,E^=(i=M+j|0)<<18|i>>>14,I^=(i=O+S|0)<<7|i>>>25,T^=(i=I+O|0)<<9|i>>>23,S^=(i=T+I|0)<<13|i>>>19,O^=(i=S+T|0)<<18|i>>>14,R^=(i=N+A|0)<<7|i>>>25,P^=(i=R+N|0)<<9|i>>>23,A^=(i=P+R|0)<<13|i>>>19,N^=(i=A+P|0)<<18|i>>>14,w^=(i=U+k|0)<<7|i>>>25,x^=(i=w+U|0)<<9|i>>>23,k^=(i=x+w|0)<<13|i>>>19,U^=(i=k+x|0)<<18|i>>>14,S^=(i=E+w|0)<<7|i>>>25,P^=(i=S+E|0)<<9|i>>>23,w^=(i=P+S|0)<<13|i>>>19,E^=(i=w+P|0)<<18|i>>>14,A^=(i=O+C|0)<<7|i>>>25,x^=(i=A+O|0)<<9|i>>>23,C^=(i=x+A|0)<<13|i>>>19,O^=(i=C+x|0)<<18|i>>>14,k^=(i=N+I|0)<<7|i>>>25,j^=(i=k+N|0)<<9|i>>>23,I^=(i=j+k|0)<<13|i>>>19,N^=(i=I+j|0)<<18|i>>>14,M^=(i=U+R|0)<<7|i>>>25,T^=(i=M+U|0)<<9|i>>>23,R^=(i=T+M|0)<<13|i>>>19,U^=(i=R+T|0)<<18|i>>>14;E=E+n|0,S=S+o|0,P=P+a|0,w=w+c|0,C=C+u|0,O=O+l|0,A=A+h|0,x=x+d|0,j=j+f|0,I=I+p|0,N=N+m|0,k=k+y|0,M=M+b|0,T=T+g|0,R=R+v|0,U=U+_|0,e[0]=E>>>0&255,e[1]=E>>>8&255,e[2]=E>>>16&255,e[3]=E>>>24&255,e[4]=S>>>0&255,e[5]=S>>>8&255,e[6]=S>>>16&255,e[7]=S>>>24&255,e[8]=P>>>0&255,e[9]=P>>>8&255,e[10]=P>>>16&255,e[11]=P>>>24&255,e[12]=w>>>0&255,e[13]=w>>>8&255,e[14]=w>>>16&255,e[15]=w>>>24&255,e[16]=C>>>0&255,e[17]=C>>>8&255,e[18]=C>>>16&255,e[19]=C>>>24&255,e[20]=O>>>0&255,e[21]=O>>>8&255,e[22]=O>>>16&255,e[23]=O>>>24&255,e[24]=A>>>0&255,e[25]=A>>>8&255,e[26]=A>>>16&255,e[27]=A>>>24&255,e[28]=x>>>0&255,e[29]=x>>>8&255,e[30]=x>>>16&255,e[31]=x>>>24&255,e[32]=j>>>0&255,e[33]=j>>>8&255,e[34]=j>>>16&255,e[35]=j>>>24&255,e[36]=I>>>0&255,e[37]=I>>>8&255,e[38]=I>>>16&255,e[39]=I>>>24&255,e[40]=N>>>0&255,e[41]=N>>>8&255,e[42]=N>>>16&255,e[43]=N>>>24&255,e[44]=k>>>0&255,e[45]=k>>>8&255,e[46]=k>>>16&255,e[47]=k>>>24&255,e[48]=M>>>0&255,e[49]=M>>>8&255,e[50]=M>>>16&255,e[51]=M>>>24&255,e[52]=T>>>0&255,e[53]=T>>>8&255,e[54]=T>>>16&255,e[55]=T>>>24&255,e[56]=R>>>0&255,e[57]=R>>>8&255,e[58]=R>>>16&255,e[59]=R>>>24&255,e[60]=U>>>0&255,e[61]=U>>>8&255,e[62]=U>>>16&255,e[63]=U>>>24&255}(e,t,r,s)}function _(e,t,r,s){!function(e,t,r,s){for(var i,n=255&s[0]|(255&s[1])<<8|(255&s[2])<<16|(255&s[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&s[4]|(255&s[5])<<8|(255&s[6])<<16|(255&s[7])<<24,h=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,d=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,f=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,m=255&s[8]|(255&s[9])<<8|(255&s[10])<<16|(255&s[11])<<24,y=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,b=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,g=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,_=255&s[12]|(255&s[13])<<8|(255&s[14])<<16|(255&s[15])<<24,E=n,S=o,P=a,w=c,C=u,O=l,A=h,x=d,j=f,I=p,N=m,k=y,M=b,T=g,R=v,U=_,F=0;F<20;F+=2)C^=(i=E+M|0)<<7|i>>>25,j^=(i=C+E|0)<<9|i>>>23,M^=(i=j+C|0)<<13|i>>>19,E^=(i=M+j|0)<<18|i>>>14,I^=(i=O+S|0)<<7|i>>>25,T^=(i=I+O|0)<<9|i>>>23,S^=(i=T+I|0)<<13|i>>>19,O^=(i=S+T|0)<<18|i>>>14,R^=(i=N+A|0)<<7|i>>>25,P^=(i=R+N|0)<<9|i>>>23,A^=(i=P+R|0)<<13|i>>>19,N^=(i=A+P|0)<<18|i>>>14,w^=(i=U+k|0)<<7|i>>>25,x^=(i=w+U|0)<<9|i>>>23,k^=(i=x+w|0)<<13|i>>>19,U^=(i=k+x|0)<<18|i>>>14,S^=(i=E+w|0)<<7|i>>>25,P^=(i=S+E|0)<<9|i>>>23,w^=(i=P+S|0)<<13|i>>>19,E^=(i=w+P|0)<<18|i>>>14,A^=(i=O+C|0)<<7|i>>>25,x^=(i=A+O|0)<<9|i>>>23,C^=(i=x+A|0)<<13|i>>>19,O^=(i=C+x|0)<<18|i>>>14,k^=(i=N+I|0)<<7|i>>>25,j^=(i=k+N|0)<<9|i>>>23,I^=(i=j+k|0)<<13|i>>>19,N^=(i=I+j|0)<<18|i>>>14,M^=(i=U+R|0)<<7|i>>>25,T^=(i=M+U|0)<<9|i>>>23,R^=(i=T+M|0)<<13|i>>>19,U^=(i=R+T|0)<<18|i>>>14;e[0]=E>>>0&255,e[1]=E>>>8&255,e[2]=E>>>16&255,e[3]=E>>>24&255,e[4]=O>>>0&255,e[5]=O>>>8&255,e[6]=O>>>16&255,e[7]=O>>>24&255,e[8]=N>>>0&255,e[9]=N>>>8&255,e[10]=N>>>16&255,e[11]=N>>>24&255,e[12]=U>>>0&255,e[13]=U>>>8&255,e[14]=U>>>16&255,e[15]=U>>>24&255,e[16]=A>>>0&255,e[17]=A>>>8&255,e[18]=A>>>16&255,e[19]=A>>>24&255,e[20]=x>>>0&255,e[21]=x>>>8&255,e[22]=x>>>16&255,e[23]=x>>>24&255,e[24]=j>>>0&255,e[25]=j>>>8&255,e[26]=j>>>16&255,e[27]=j>>>24&255,e[28]=I>>>0&255,e[29]=I>>>8&255,e[30]=I>>>16&255,e[31]=I>>>24&255}(e,t,r,s)}var E=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function S(e,t,r,s,i,n,o){var a,c,u=new Uint8Array(16),l=new Uint8Array(64);for(c=0;c<16;c++)u[c]=0;for(c=0;c<8;c++)u[c]=n[c];for(;i>=64;){for(v(l,u,o,E),c=0;c<64;c++)e[t+c]=r[s+c]^l[c];for(c=8,a=1;c<16;c++)a=a+(255&u[c])|0,u[c]=255&a,a>>>=8;i-=64,t+=64,s+=64}if(i>0)for(v(l,u,o,E),c=0;c<i;c++)e[t+c]=r[s+c]^l[c];return 0}function P(e,t,r,s,i){var n,o,a=new Uint8Array(16),c=new Uint8Array(64);for(o=0;o<16;o++)a[o]=0;for(o=0;o<8;o++)a[o]=s[o];for(;r>=64;){for(v(c,a,i,E),o=0;o<64;o++)e[t+o]=c[o];for(o=8,n=1;o<16;o++)n=n+(255&a[o])|0,a[o]=255&n,n>>>=8;r-=64,t+=64}if(r>0)for(v(c,a,i,E),o=0;o<r;o++)e[t+o]=c[o];return 0}function w(e,t,r,s,i){var n=new Uint8Array(32);_(n,s,i,E);for(var o=new Uint8Array(8),a=0;a<8;a++)o[a]=s[a+16];return P(e,t,r,o,n)}function C(e,t,r,s,i,n,o){var a=new Uint8Array(32);_(a,n,o,E);for(var c=new Uint8Array(8),u=0;u<8;u++)c[u]=n[u+16];return S(e,t,r,s,i,c,a)}var O=function(e){var t,r,s,i,n,o,a,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=(t>>>13|r<<3)&8191,s=255&e[4]|(255&e[5])<<8,this.r[2]=(r>>>10|s<<6)&7939,i=255&e[6]|(255&e[7])<<8,this.r[3]=(s>>>7|i<<9)&8191,n=255&e[8]|(255&e[9])<<8,this.r[4]=(i>>>4|n<<12)&255,this.r[5]=n>>>1&8190,o=255&e[10]|(255&e[11])<<8,this.r[6]=(n>>>14|o<<2)&8191,a=255&e[12]|(255&e[13])<<8,this.r[7]=(o>>>11|a<<5)&8065,c=255&e[14]|(255&e[15])<<8,this.r[8]=(a>>>8|c<<8)&8191,this.r[9]=c>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function A(e,t,r,s,i,n){var o=new O(n);return o.update(r,s,i),o.finish(e,t),0}function x(e,t,r,s,i,n){var o=new Uint8Array(16);return A(o,0,r,s,i,n),b(e,t,o,0)}function j(e,t,r,s,i){var n;if(r<32)return -1;for(C(e,0,t,0,r,s,i),A(e,16,e,32,r-32,e),n=0;n<16;n++)e[n]=0;return 0}function I(e,t,r,s,i){var n,o=new Uint8Array(32);if(r<32||(w(o,0,32,s,i),0!==x(t,16,t,32,r-32,o)))return -1;for(C(e,0,t,0,r,s,i),n=0;n<32;n++)e[n]=0;return 0}function N(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function k(e){var t,r,s=1;for(t=0;t<16;t++)s=Math.floor((r=e[t]+s+65535)/65536),e[t]=r-65536*s;e[0]+=s-1+37*(s-1)}function M(e,t,r){for(var s,i=~(r-1),n=0;n<16;n++)s=i&(e[n]^t[n]),e[n]^=s,t[n]^=s}function T(e,t){var r,i,n,o=s(),a=s();for(r=0;r<16;r++)a[r]=t[r];for(k(a),k(a),k(a),i=0;i<2;i++){for(r=1,o[0]=a[0]-65517;r<15;r++)o[r]=a[r]-65535-(o[r-1]>>16&1),o[r-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),n=o[15]>>16&1,o[14]&=65535,M(a,o,1-n)}for(r=0;r<16;r++)e[2*r]=255&a[r],e[2*r+1]=a[r]>>8}function R(e,t){var r=new Uint8Array(32),s=new Uint8Array(32);return T(r,e),T(s,t),g(r,0,s,0)}function U(e){var t=new Uint8Array(32);return T(t,e),1&t[0]}function F(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function $(e,t,r){for(var s=0;s<16;s++)e[s]=t[s]+r[s]}function q(e,t,r){for(var s=0;s<16;s++)e[s]=t[s]-r[s]}function D(e,t,r){var s,i,n=0,o=0,a=0,c=0,u=0,l=0,h=0,d=0,f=0,p=0,m=0,y=0,b=0,g=0,v=0,_=0,E=0,S=0,P=0,w=0,C=0,O=0,A=0,x=0,j=0,I=0,N=0,k=0,M=0,T=0,R=0,U=r[0],F=r[1],$=r[2],q=r[3],D=r[4],L=r[5],B=r[6],K=r[7],H=r[8],J=r[9],z=r[10],G=r[11],V=r[12],W=r[13],Y=r[14],X=r[15];n+=(s=t[0])*U,o+=s*F,a+=s*$,c+=s*q,u+=s*D,l+=s*L,h+=s*B,d+=s*K,f+=s*H,p+=s*J,m+=s*z,y+=s*G,b+=s*V,g+=s*W,v+=s*Y,_+=s*X,o+=(s=t[1])*U,a+=s*F,c+=s*$,u+=s*q,l+=s*D,h+=s*L,d+=s*B,f+=s*K,p+=s*H,m+=s*J,y+=s*z,b+=s*G,g+=s*V,v+=s*W,_+=s*Y,E+=s*X,a+=(s=t[2])*U,c+=s*F,u+=s*$,l+=s*q,h+=s*D,d+=s*L,f+=s*B,p+=s*K,m+=s*H,y+=s*J,b+=s*z,g+=s*G,v+=s*V,_+=s*W,E+=s*Y,S+=s*X,c+=(s=t[3])*U,u+=s*F,l+=s*$,h+=s*q,d+=s*D,f+=s*L,p+=s*B,m+=s*K,y+=s*H,b+=s*J,g+=s*z,v+=s*G,_+=s*V,E+=s*W,S+=s*Y,P+=s*X,u+=(s=t[4])*U,l+=s*F,h+=s*$,d+=s*q,f+=s*D,p+=s*L,m+=s*B,y+=s*K,b+=s*H,g+=s*J,v+=s*z,_+=s*G,E+=s*V,S+=s*W,P+=s*Y,w+=s*X,l+=(s=t[5])*U,h+=s*F,d+=s*$,f+=s*q,p+=s*D,m+=s*L,y+=s*B,b+=s*K,g+=s*H,v+=s*J,_+=s*z,E+=s*G,S+=s*V,P+=s*W,w+=s*Y,C+=s*X,h+=(s=t[6])*U,d+=s*F,f+=s*$,p+=s*q,m+=s*D,y+=s*L,b+=s*B,g+=s*K,v+=s*H,_+=s*J,E+=s*z,S+=s*G,P+=s*V,w+=s*W,C+=s*Y,O+=s*X,d+=(s=t[7])*U,f+=s*F,p+=s*$,m+=s*q,y+=s*D,b+=s*L,g+=s*B,v+=s*K,_+=s*H,E+=s*J,S+=s*z,P+=s*G,w+=s*V,C+=s*W,O+=s*Y,A+=s*X,f+=(s=t[8])*U,p+=s*F,m+=s*$,y+=s*q,b+=s*D,g+=s*L,v+=s*B,_+=s*K,E+=s*H,S+=s*J,P+=s*z,w+=s*G,C+=s*V,O+=s*W,A+=s*Y,x+=s*X,p+=(s=t[9])*U,m+=s*F,y+=s*$,b+=s*q,g+=s*D,v+=s*L,_+=s*B,E+=s*K,S+=s*H,P+=s*J,w+=s*z,C+=s*G,O+=s*V,A+=s*W,x+=s*Y,j+=s*X,m+=(s=t[10])*U,y+=s*F,b+=s*$,g+=s*q,v+=s*D,_+=s*L,E+=s*B,S+=s*K,P+=s*H,w+=s*J,C+=s*z,O+=s*G,A+=s*V,x+=s*W,j+=s*Y,I+=s*X,y+=(s=t[11])*U,b+=s*F,g+=s*$,v+=s*q,_+=s*D,E+=s*L,S+=s*B,P+=s*K,w+=s*H,C+=s*J,O+=s*z,A+=s*G,x+=s*V,j+=s*W,I+=s*Y,N+=s*X,b+=(s=t[12])*U,g+=s*F,v+=s*$,_+=s*q,E+=s*D,S+=s*L,P+=s*B,w+=s*K,C+=s*H,O+=s*J,A+=s*z,x+=s*G,j+=s*V,I+=s*W,N+=s*Y,k+=s*X,g+=(s=t[13])*U,v+=s*F,_+=s*$,E+=s*q,S+=s*D,P+=s*L,w+=s*B,C+=s*K,O+=s*H,A+=s*J,x+=s*z,j+=s*G,I+=s*V,N+=s*W,k+=s*Y,M+=s*X,v+=(s=t[14])*U,_+=s*F,E+=s*$,S+=s*q,P+=s*D,w+=s*L,C+=s*B,O+=s*K,A+=s*H,x+=s*J,j+=s*z,I+=s*G,N+=s*V,k+=s*W,M+=s*Y,T+=s*X,_+=(s=t[15])*U,E+=s*F,S+=s*$,P+=s*q,w+=s*D,C+=s*L,O+=s*B,A+=s*K,x+=s*H,j+=s*J,I+=s*z,N+=s*G,k+=s*V,M+=s*W,T+=s*Y,R+=s*X,n+=38*E,o+=38*S,a+=38*P,c+=38*w,u+=38*C,l+=38*O,h+=38*A,d+=38*x,f+=38*j,p+=38*I,m+=38*N,y+=38*k,b+=38*M,g+=38*T,v+=38*R,i=Math.floor((s=n+(i=1)+65535)/65536),n=s-65536*i,i=Math.floor((s=o+i+65535)/65536),o=s-65536*i,i=Math.floor((s=a+i+65535)/65536),a=s-65536*i,i=Math.floor((s=c+i+65535)/65536),c=s-65536*i,i=Math.floor((s=u+i+65535)/65536),u=s-65536*i,i=Math.floor((s=l+i+65535)/65536),l=s-65536*i,i=Math.floor((s=h+i+65535)/65536),h=s-65536*i,i=Math.floor((s=d+i+65535)/65536),d=s-65536*i,i=Math.floor((s=f+i+65535)/65536),f=s-65536*i,i=Math.floor((s=p+i+65535)/65536),p=s-65536*i,i=Math.floor((s=m+i+65535)/65536),m=s-65536*i,i=Math.floor((s=y+i+65535)/65536),y=s-65536*i,i=Math.floor((s=b+i+65535)/65536),b=s-65536*i,i=Math.floor((s=g+i+65535)/65536),g=s-65536*i,i=Math.floor((s=v+i+65535)/65536),v=s-65536*i,i=Math.floor((s=_+i+65535)/65536),_=s-65536*i,n+=i-1+37*(i-1),i=Math.floor((s=n+(i=1)+65535)/65536),n=s-65536*i,i=Math.floor((s=o+i+65535)/65536),o=s-65536*i,i=Math.floor((s=a+i+65535)/65536),a=s-65536*i,i=Math.floor((s=c+i+65535)/65536),c=s-65536*i,i=Math.floor((s=u+i+65535)/65536),u=s-65536*i,i=Math.floor((s=l+i+65535)/65536),l=s-65536*i,i=Math.floor((s=h+i+65535)/65536),h=s-65536*i,i=Math.floor((s=d+i+65535)/65536),d=s-65536*i,i=Math.floor((s=f+i+65535)/65536),f=s-65536*i,i=Math.floor((s=p+i+65535)/65536),p=s-65536*i,i=Math.floor((s=m+i+65535)/65536),m=s-65536*i,i=Math.floor((s=y+i+65535)/65536),y=s-65536*i,i=Math.floor((s=b+i+65535)/65536),b=s-65536*i,i=Math.floor((s=g+i+65535)/65536),g=s-65536*i,i=Math.floor((s=v+i+65535)/65536),v=s-65536*i,i=Math.floor((s=_+i+65535)/65536),_=s-65536*i,n+=i-1+37*(i-1),e[0]=n,e[1]=o,e[2]=a,e[3]=c,e[4]=u,e[5]=l,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=m,e[11]=y,e[12]=b,e[13]=g,e[14]=v,e[15]=_}function L(e,t){D(e,t,t)}function B(e,t){var r,i=s();for(r=0;r<16;r++)i[r]=t[r];for(r=253;r>=0;r--)L(i,i),2!==r&&4!==r&&D(i,i,t);for(r=0;r<16;r++)e[r]=i[r]}function K(e,t){var r,i=s();for(r=0;r<16;r++)i[r]=t[r];for(r=250;r>=0;r--)L(i,i),1!==r&&D(i,i,t);for(r=0;r<16;r++)e[r]=i[r]}function H(e,t,r){var i,n,o=new Uint8Array(32),a=new Float64Array(80),c=s(),l=s(),h=s(),d=s(),f=s(),p=s();for(n=0;n<31;n++)o[n]=t[n];for(o[31]=127&t[31]|64,o[0]&=248,F(a,r),n=0;n<16;n++)l[n]=a[n],d[n]=c[n]=h[n]=0;for(n=254,c[0]=d[0]=1;n>=0;--n)M(c,l,i=o[n>>>3]>>>(7&n)&1),M(h,d,i),$(f,c,h),q(c,c,h),$(h,l,d),q(l,l,d),L(d,f),L(p,c),D(c,h,c),D(h,l,f),$(f,c,h),q(c,c,h),L(l,c),q(h,d,p),D(c,h,u),$(c,c,d),D(h,h,c),D(c,d,p),D(d,l,a),L(l,f),M(c,l,i),M(h,d,i);for(n=0;n<16;n++)a[n+16]=c[n],a[n+32]=h[n],a[n+48]=l[n],a[n+64]=d[n];var m=a.subarray(32),y=a.subarray(16);return B(m,m),D(y,y,m),T(e,y),0}function J(e,t){return H(e,t,o)}function z(e,t){return i(t,32),J(e,t)}function G(e,t,r){var s=new Uint8Array(32);return H(s,r,t),_(e,n,s,E)}O.prototype.blocks=function(e,t,r){for(var s,i,n,o,a,c,u,l,h,d,f,p,m,y,b,g,v,_,E,S=this.fin?0:2048,P=this.h[0],w=this.h[1],C=this.h[2],O=this.h[3],A=this.h[4],x=this.h[5],j=this.h[6],I=this.h[7],N=this.h[8],k=this.h[9],M=this.r[0],T=this.r[1],R=this.r[2],U=this.r[3],F=this.r[4],$=this.r[5],q=this.r[6],D=this.r[7],L=this.r[8],B=this.r[9];r>=16;)P+=8191&(s=255&e[t+0]|(255&e[t+1])<<8),w+=(s>>>13|(i=255&e[t+2]|(255&e[t+3])<<8)<<3)&8191,C+=(i>>>10|(n=255&e[t+4]|(255&e[t+5])<<8)<<6)&8191,O+=(n>>>7|(o=255&e[t+6]|(255&e[t+7])<<8)<<9)&8191,A+=(o>>>4|(a=255&e[t+8]|(255&e[t+9])<<8)<<12)&8191,x+=a>>>1&8191,j+=(a>>>14|(c=255&e[t+10]|(255&e[t+11])<<8)<<2)&8191,I+=(c>>>11|(u=255&e[t+12]|(255&e[t+13])<<8)<<5)&8191,N+=(u>>>8|(l=255&e[t+14]|(255&e[t+15])<<8)<<8)&8191,k+=l>>>5|S,h=(d=(h=0)+P*M+5*B*w+5*L*C+5*D*O+5*q*A)>>>13,d&=8191,d+=5*$*x+5*F*j+5*U*I+5*R*N+5*T*k,h+=d>>>13,d&=8191,h=(f=h+P*T+w*M+5*B*C+5*L*O+5*D*A)>>>13,f&=8191,f+=5*q*x+5*$*j+5*F*I+5*U*N+5*R*k,h+=f>>>13,f&=8191,h=(p=h+P*R+w*T+C*M+5*B*O+5*L*A)>>>13,p&=8191,p+=5*D*x+5*q*j+5*$*I+5*F*N+5*U*k,h+=p>>>13,p&=8191,h=(m=h+P*U+w*R+C*T+O*M+5*B*A)>>>13,m&=8191,m+=5*L*x+5*D*j+5*q*I+5*$*N+5*F*k,h+=m>>>13,m&=8191,h=(y=h+P*F+w*U+C*R+O*T+A*M)>>>13,y&=8191,y+=5*B*x+5*L*j+5*D*I+5*q*N+5*$*k,h+=y>>>13,y&=8191,h=(b=h+P*$+w*F+C*U+O*R+A*T)>>>13,b&=8191,b+=x*M+5*B*j+5*L*I+5*D*N+5*q*k,h+=b>>>13,b&=8191,h=(g=h+P*q+w*$+C*F+O*U+A*R)>>>13,g&=8191,g+=x*T+j*M+5*B*I+5*L*N+5*D*k,h+=g>>>13,g&=8191,h=(v=h+P*D+w*q+C*$+O*F+A*U)>>>13,v&=8191,v+=x*R+j*T+I*M+5*B*N+5*L*k,h+=v>>>13,v&=8191,h=(_=h+P*L+w*D+C*q+O*$+A*F)>>>13,_&=8191,_+=x*U+j*R+I*T+N*M+5*B*k,h+=_>>>13,_&=8191,h=(E=h+P*B+w*L+C*D+O*q+A*$)>>>13,E&=8191,E+=x*F+j*U+I*R+N*T+k*M,h+=E>>>13,E&=8191,d=8191&(h=(h=(h<<2)+h|0)+d|0),h>>>=13,f+=h,P=d,w=f,C=p,O=m,A=y,x=b,j=g,I=v,N=_,k=E,t+=16,r-=16;this.h[0]=P,this.h[1]=w,this.h[2]=C,this.h[3]=O,this.h[4]=A,this.h[5]=x,this.h[6]=j,this.h[7]=I,this.h[8]=N,this.h[9]=k},O.prototype.finish=function(e,t){var r,s,i,n,o=new Uint16Array(10);if(this.leftover){for(n=this.leftover,this.buffer[n++]=1;n<16;n++)this.buffer[n]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,n=2;n<10;n++)this.h[n]+=r,r=this.h[n]>>>13,this.h[n]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,o[0]=this.h[0]+5,r=o[0]>>>13,o[0]&=8191,n=1;n<10;n++)o[n]=this.h[n]+r,r=o[n]>>>13,o[n]&=8191;for(o[9]-=8192,s=(1^r)-1,n=0;n<10;n++)o[n]&=s;for(n=0,s=~s;n<10;n++)this.h[n]=this.h[n]&s|o[n];for(n=1,this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,i=this.h[0]+this.pad[0],this.h[0]=65535&i;n<8;n++)i=(this.h[n]+this.pad[n]|0)+(i>>>16)|0,this.h[n]=65535&i;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},O.prototype.update=function(e,t,r){var s,i;if(this.leftover){for((i=16-this.leftover)>r&&(i=r),s=0;s<i;s++)this.buffer[this.leftover+s]=e[t+s];if(r-=i,t+=i,this.leftover+=i,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(i=r-r%16,this.blocks(e,t,i),t+=i,r-=i),r){for(s=0;s<r;s++)this.buffer[this.leftover+s]=e[t+s];this.leftover+=r}};var V=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function W(e,t,r,s){for(var i,n,o,a,c,u,l,h,d,f,p,m,y,b,g,v,_,E,S,P,w,C,O,A,x,j,I=new Int32Array(16),N=new Int32Array(16),k=e[0],M=e[1],T=e[2],R=e[3],U=e[4],F=e[5],$=e[6],q=e[7],D=t[0],L=t[1],B=t[2],K=t[3],H=t[4],J=t[5],z=t[6],G=t[7],W=0;s>=128;){for(S=0;S<16;S++)P=8*S+W,I[S]=r[P+0]<<24|r[P+1]<<16|r[P+2]<<8|r[P+3],N[S]=r[P+4]<<24|r[P+5]<<16|r[P+6]<<8|r[P+7];for(S=0;S<80;S++)if(i=k,n=M,o=T,a=R,c=U,u=F,l=$,h=q,d=D,f=L,p=B,m=K,y=H,b=J,g=z,v=G,w=q,O=65535&(C=G),A=C>>>16,x=65535&w,j=w>>>16,w=(U>>>14|H<<18)^(U>>>18|H<<14)^(H>>>9|U<<23),O+=65535&(C=(H>>>14|U<<18)^(H>>>18|U<<14)^(U>>>9|H<<23)),A+=C>>>16,x+=65535&w,j+=w>>>16,w=U&F^~U&$,O+=65535&(C=H&J^~H&z),A+=C>>>16,x+=65535&w,j+=w>>>16,w=V[2*S],O+=65535&(C=V[2*S+1]),A+=C>>>16,x+=65535&w,j+=w>>>16,w=I[S%16],O+=65535&(C=N[S%16]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,_=65535&x|j<<16,E=65535&O|A<<16,w=_,O=65535&(C=E),A=C>>>16,x=65535&w,j=w>>>16,w=(k>>>28|D<<4)^(D>>>2|k<<30)^(D>>>7|k<<25),O+=65535&(C=(D>>>28|k<<4)^(k>>>2|D<<30)^(k>>>7|D<<25)),A+=C>>>16,x+=65535&w,j+=w>>>16,w=k&M^k&T^M&T,O+=65535&(C=D&L^D&B^L&B),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,h=65535&x|j<<16,v=65535&O|A<<16,w=a,O=65535&(C=m),A=C>>>16,x=65535&w,j=w>>>16,w=_,O+=65535&(C=E),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,a=65535&x|j<<16,m=65535&O|A<<16,M=i,T=n,R=o,U=a,F=c,$=u,q=l,k=h,L=d,B=f,K=p,H=m,J=y,z=b,G=g,D=v,S%16==15)for(P=0;P<16;P++)w=I[P],O=65535&(C=N[P]),A=C>>>16,x=65535&w,j=w>>>16,w=I[(P+9)%16],O+=65535&(C=N[(P+9)%16]),A+=C>>>16,x+=65535&w,j+=w>>>16,w=((_=I[(P+1)%16])>>>1|(E=N[(P+1)%16])<<31)^(_>>>8|E<<24)^_>>>7,O+=65535&(C=(E>>>1|_<<31)^(E>>>8|_<<24)^(E>>>7|_<<25)),A+=C>>>16,x+=65535&w,j+=w>>>16,w=((_=I[(P+14)%16])>>>19|(E=N[(P+14)%16])<<13)^(E>>>29|_<<3)^_>>>6,O+=65535&(C=(E>>>19|_<<13)^(_>>>29|E<<3)^(E>>>6|_<<26)),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,I[P]=65535&x|j<<16,N[P]=65535&O|A<<16;w=k,O=65535&(C=D),A=C>>>16,x=65535&w,j=w>>>16,w=e[0],O+=65535&(C=t[0]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[0]=k=65535&x|j<<16,t[0]=D=65535&O|A<<16,w=M,O=65535&(C=L),A=C>>>16,x=65535&w,j=w>>>16,w=e[1],O+=65535&(C=t[1]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[1]=M=65535&x|j<<16,t[1]=L=65535&O|A<<16,w=T,O=65535&(C=B),A=C>>>16,x=65535&w,j=w>>>16,w=e[2],O+=65535&(C=t[2]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[2]=T=65535&x|j<<16,t[2]=B=65535&O|A<<16,w=R,O=65535&(C=K),A=C>>>16,x=65535&w,j=w>>>16,w=e[3],O+=65535&(C=t[3]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[3]=R=65535&x|j<<16,t[3]=K=65535&O|A<<16,w=U,O=65535&(C=H),A=C>>>16,x=65535&w,j=w>>>16,w=e[4],O+=65535&(C=t[4]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[4]=U=65535&x|j<<16,t[4]=H=65535&O|A<<16,w=F,O=65535&(C=J),A=C>>>16,x=65535&w,j=w>>>16,w=e[5],O+=65535&(C=t[5]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[5]=F=65535&x|j<<16,t[5]=J=65535&O|A<<16,w=$,O=65535&(C=z),A=C>>>16,x=65535&w,j=w>>>16,w=e[6],O+=65535&(C=t[6]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[6]=$=65535&x|j<<16,t[6]=z=65535&O|A<<16,w=q,O=65535&(C=G),A=C>>>16,x=65535&w,j=w>>>16,w=e[7],O+=65535&(C=t[7]),A+=C>>>16,x+=65535&w,j+=w>>>16,A+=O>>>16,x+=A>>>16,j+=x>>>16,e[7]=q=65535&x|j<<16,t[7]=G=65535&O|A<<16,W+=128,s-=128}return s}function Y(e,t,r){var s,i=new Int32Array(8),n=new Int32Array(8),o=new Uint8Array(256),a=r;for(i[0]=1779033703,i[1]=3144134277,i[2]=1013904242,i[3]=2773480762,i[4]=1359893119,i[5]=2600822924,i[6]=528734635,i[7]=1541459225,n[0]=4089235720,n[1]=2227873595,n[2]=4271175723,n[3]=1595750129,n[4]=2917565137,n[5]=725511199,n[6]=4215389547,n[7]=327033209,W(i,n,t,r),r%=128,s=0;s<r;s++)o[s]=t[a-r+s];for(o[r]=128,o[(r=256-128*(r<112?1:0))-9]=0,m(o,r-8,a/536870912|0,a<<3),W(i,n,o,r),s=0;s<8;s++)m(e,8*s,i[s],n[s]);return 0}function X(e,t){var r=s(),i=s(),n=s(),o=s(),a=s(),c=s(),u=s(),l=s(),d=s();q(r,e[1],e[0]),q(d,t[1],t[0]),D(r,r,d),$(i,e[0],e[1]),$(d,t[0],t[1]),D(i,i,d),D(n,e[3],t[3]),D(n,n,h),D(o,e[2],t[2]),$(o,o,o),q(a,i,r),q(c,o,n),$(u,o,n),$(l,i,r),D(e[0],a,c),D(e[1],l,u),D(e[2],u,c),D(e[3],a,l)}function Q(e,t,r){var s;for(s=0;s<4;s++)M(e[s],t[s],r)}function Z(e,t){var r=s(),i=s(),n=s();B(n,t[2]),D(r,t[0],n),D(i,t[1],n),T(e,i),e[31]^=U(r)<<7}function ee(e,t,r){var s,i;for(N(e[0],a),N(e[1],c),N(e[2],c),N(e[3],a),i=255;i>=0;--i)Q(e,t,s=r[i/8|0]>>(7&i)&1),X(t,e),X(e,e),Q(e,t,s)}function et(e,t){var r=[s(),s(),s(),s()];N(r[0],d),N(r[1],f),N(r[2],c),D(r[3],d,f),ee(e,r,t)}function er(e,t,r){var n,o=new Uint8Array(64),a=[s(),s(),s(),s()];for(r||i(t,32),Y(o,t,32),o[0]&=248,o[31]&=127,o[31]|=64,et(a,o),Z(e,a),n=0;n<32;n++)t[n+32]=e[n];return 0}var es=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ei(e,t){var r,s,i,n;for(s=63;s>=32;--s){for(r=0,i=s-32,n=s-12;i<n;++i)t[i]+=r-16*t[s]*es[i-(s-32)],r=Math.floor((t[i]+128)/256),t[i]-=256*r;t[i]+=r,t[s]=0}for(i=0,r=0;i<32;i++)t[i]+=r-(t[31]>>4)*es[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;i++)t[i]-=r*es[i];for(s=0;s<32;s++)t[s+1]+=t[s]>>8,e[s]=255&t[s]}function en(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;ei(e,r)}function eo(e,t,r,i){var n,o,a=new Uint8Array(64),c=new Uint8Array(64),u=new Uint8Array(64),l=new Float64Array(64),h=[s(),s(),s(),s()];for(Y(a,i,32),a[0]&=248,a[31]&=127,a[31]|=64,n=0;n<r;n++)e[64+n]=t[n];for(n=0;n<32;n++)e[32+n]=a[32+n];for(Y(u,e.subarray(32),r+32),en(u),et(h,u),Z(e,h),n=32;n<64;n++)e[n]=i[n];for(Y(c,e,r+64),en(c),n=0;n<64;n++)l[n]=0;for(n=0;n<32;n++)l[n]=u[n];for(n=0;n<32;n++)for(o=0;o<32;o++)l[n+o]+=c[n]*a[o];return ei(e.subarray(32),l),r+64}function ea(e,t,r,i){var n,o,u,h,d,f,m,y,b=new Uint8Array(32),v=new Uint8Array(64),_=[s(),s(),s(),s()],E=[s(),s(),s(),s()];if(r<64||(n=s(),o=s(),u=s(),h=s(),d=s(),f=s(),m=s(),(N(E[2],c),F(E[1],i),L(u,E[1]),D(h,u,l),q(u,u,E[2]),$(h,E[2],h),L(d,h),L(f,d),D(m,f,d),D(n,m,u),D(n,n,h),K(n,n),D(n,n,u),D(n,n,h),D(n,n,h),D(E[0],n,h),L(o,E[0]),D(o,o,h),R(o,u)&&D(E[0],E[0],p),L(o,E[0]),D(o,o,h),R(o,u))?-1:(U(E[0])===i[31]>>7&&q(E[0],a,E[0]),D(E[3],E[0],E[1]),0)))return -1;for(y=0;y<r;y++)e[y]=t[y];for(y=0;y<32;y++)e[y+32]=i[y];if(Y(v,e,r),en(v),ee(_,E,v),et(E,t.subarray(32)),X(_,E),Z(b,_),r-=64,g(t,0,b,0)){for(y=0;y<r;y++)e[y]=0;return -1}for(y=0;y<r;y++)e[y]=t[y+64];return r}function ec(e,t){if(32!==e.length)throw Error("bad key size");if(24!==t.length)throw Error("bad nonce size")}function eu(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw TypeError("unexpected type, use Uint8Array")}function el(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:_,crypto_stream_xor:C,crypto_stream:w,crypto_stream_salsa20_xor:S,crypto_stream_salsa20:P,crypto_onetimeauth:A,crypto_onetimeauth_verify:x,crypto_verify_16:b,crypto_verify_32:g,crypto_secretbox:j,crypto_secretbox_open:I,crypto_scalarmult:H,crypto_scalarmult_base:J,crypto_box_beforenm:G,crypto_box_afternm:j,crypto_box:function(e,t,r,s,i,n){var o=new Uint8Array(32);return G(o,i,n),j(e,t,r,s,o)},crypto_box_open:function(e,t,r,s,i,n){var o=new Uint8Array(32);return G(o,i,n),I(e,t,r,s,o)},crypto_box_keypair:z,crypto_hash:Y,crypto_sign:eo,crypto_sign_keypair:er,crypto_sign_open:ea,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:s,D:l,L:es,pack25519:T,unpack25519:F,M:D,A:$,S:L,Z:q,pow2523:K,add:X,set25519:N,modL:ei,scalarmult:ee,scalarbase:et},e.randomBytes=function(e){var t=new Uint8Array(e);return i(t,e),t},e.secretbox=function(e,t,r){eu(e,t,r),ec(r,t);for(var s=new Uint8Array(32+e.length),i=new Uint8Array(s.length),n=0;n<e.length;n++)s[n+32]=e[n];return j(i,s,s.length,t,r),i.subarray(16)},e.secretbox.open=function(e,t,r){eu(e,t,r),ec(r,t);for(var s=new Uint8Array(16+e.length),i=new Uint8Array(s.length),n=0;n<e.length;n++)s[n+16]=e[n];return s.length<32||0!==I(i,s,s.length,t,r)?null:i.subarray(32)},e.secretbox.keyLength=32,e.secretbox.nonceLength=24,e.secretbox.overheadLength=16,e.scalarMult=function(e,t){if(eu(e,t),32!==e.length)throw Error("bad n size");if(32!==t.length)throw Error("bad p size");var r=new Uint8Array(32);return H(r,e,t),r},e.scalarMult.base=function(e){if(eu(e),32!==e.length)throw Error("bad n size");var t=new Uint8Array(32);return J(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,r,s,i){var n=e.box.before(s,i);return e.secretbox(t,r,n)},e.box.before=function(e,t){eu(e,t),function(e,t){if(32!==e.length)throw Error("bad public key size");if(32!==t.length)throw Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return G(r,e,t),r},e.box.after=e.secretbox,e.box.open=function(t,r,s,i){var n=e.box.before(s,i);return e.secretbox.open(t,r,n)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return z(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(eu(e),32!==e.length)throw Error("bad secret key size");var t=new Uint8Array(32);return J(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=32,e.box.secretKeyLength=32,e.box.sharedKeyLength=32,e.box.nonceLength=24,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(eu(e,t),64!==t.length)throw Error("bad secret key size");var r=new Uint8Array(64+e.length);return eo(r,e,e.length,t),r},e.sign.open=function(e,t){if(eu(e,t),32!==t.length)throw Error("bad public key size");var r=new Uint8Array(e.length),s=ea(r,e,e.length,t);if(s<0)return null;for(var i=new Uint8Array(s),n=0;n<i.length;n++)i[n]=r[n];return i},e.sign.detached=function(t,r){for(var s=e.sign(t,r),i=new Uint8Array(64),n=0;n<i.length;n++)i[n]=s[n];return i},e.sign.detached.verify=function(e,t,r){if(eu(e,t,r),64!==t.length)throw Error("bad signature size");if(32!==r.length)throw Error("bad public key size");var s,i=new Uint8Array(64+e.length),n=new Uint8Array(64+e.length);for(s=0;s<64;s++)i[s]=t[s];for(s=0;s<e.length;s++)i[s+64]=e[s];return ea(n,i,i.length,r)>=0},e.sign.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(64);return er(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(eu(e),64!==e.length)throw Error("bad secret key size");for(var t=new Uint8Array(32),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(eu(e),32!==e.length)throw Error("bad seed size");for(var t=new Uint8Array(32),r=new Uint8Array(64),s=0;s<32;s++)r[s]=e[s];return er(t,r,!0),{publicKey:t,secretKey:r}},e.sign.publicKeyLength=32,e.sign.secretKeyLength=64,e.sign.seedLength=32,e.sign.signatureLength=64,e.hash=function(e){eu(e);var t=new Uint8Array(64);return Y(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return eu(e,t),0!==e.length&&0!==t.length&&e.length===t.length&&0===y(e,0,t,0,e.length)},e.setPRNG=function(e){i=e},(t="undefined"!=typeof self?self.crypto||self.msCrypto:null)&&t.getRandomValues?e.setPRNG(function(e,r){var s,i=new Uint8Array(r);for(s=0;s<r;s+=65536)t.getRandomValues(i.subarray(s,s+Math.min(r-s,65536)));for(s=0;s<r;s++)e[s]=i[s];el(i)}):(t=r(84770))&&t.randomBytes&&e.setPRNG(function(e,r){var s,i=t.randomBytes(r);for(s=0;s<r;s++)e[s]=i[s];el(i)})}(e.exports?e.exports:self.nacl=self.nacl||{})}};