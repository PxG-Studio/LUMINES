"use strict";exports.id=7875,exports.ids=[7875],exports.modules={9376:(e,t,r)=>{r.d(t,{Fs:()=>l,pb:()=>h});var s={};r.r(s),r.d(s,{t:()=>i});var o=r(62197),n=r.n(o),a=r(60114);let i={url:(0,a.sQ)(),host:a.OB.REDIS_HOST,port:a.OB.REDIS_PORT,password:a.OB.REDIS_PASSWORD,db:a.OB.REDIS_DB,ttl:a.OB.REDIS_TTL,retryStrategy:e=>e>10?null:Math.min(100*e,3e3),reconnectOnError:e=>["READONLY","ECONNREFUSED","ETIMEDOUT"].some(t=>e.message.includes(t))},u=globalThis.redis??new(n())((0,s.getRedisUrl)(),{retryStrategy:i.retryStrategy,reconnectOnError:i.reconnectOnError,maxRetriesPerRequest:3,enableReadyCheck:!0,enableOfflineQueue:!1,lazyConnect:!1});u.on("connect",()=>{}),u.on("error",e=>{console.error("âŒ Redis error:",e)}),u.on("close",()=>{}),u.on("reconnecting",()=>{});let l={get:async e=>{try{return await u.get(e)}catch(t){throw console.error(`Redis GET error for key ${e}:`,t),t}},set:async(e,t,r)=>{try{r?await u.setex(e,r,t):await u.set(e,t,"EX",i.ttl)}catch(t){throw console.error(`Redis SET error for key ${e}:`,t),t}},del:async e=>{try{await u.del(e)}catch(t){throw console.error(`Redis DEL error for key ${e}:`,t),t}},exists:async e=>{try{return await u.exists(e)>0}catch(t){throw console.error(`Redis EXISTS error for key ${e}:`,t),t}},close:async()=>{try{await u.quit()}catch(e){console.error("Redis close error:",e),u.disconnect()}}};async function h(){try{let e=await u.ping();return"PONG"===e}catch(e){return console.error("Redis health check failed:",e),!1}}},97875:(e,t,r)=>{r.d(t,{mk:()=>o,MH:()=>n}),r(87070),r(93016),r(12657);var s=r(17176);async function o(e){let t=await (0,s.YR)(e);return t.error?{request:e,error:{message:t.error.message,status:t.error.status}}:{request:t.request}}function n(e,t){if(!e.user)return{request:e,error:{message:"Authentication required",status:401}};let r=e.user.roles||[];return t.some(e=>r.includes(e))?{request:e}:{request:e,error:{message:`Insufficient permissions. Required roles: ${t.join(", ")}`,status:403}}}r(9376),r(60114)},93016:(e,t,r)=>{r.d(t,{k:()=>o});class s{constructor(){this.isDevelopment=!1,this.minLevel=process.env.LOG_LEVEL||"info"}shouldLog(e){let t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(this.minLevel)}formatMessage(e,t,r){let s=new Date().toISOString(),o=r?` ${JSON.stringify(r)}`:"";return`[${s}] [${e.toUpperCase()}] ${t}${o}`}debug(e,t){this.shouldLog("debug")}info(e,t){this.shouldLog("info")}warn(e,t){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e,t))}error(e,t,r){if(this.shouldLog("error")){let s={...r,error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:String(t)};console.error(this.formatMessage("error",e,s))}}logRequest(e){this.info("HTTP Request",{requestId:e.requestId,method:e.method,path:e.path,query:e.query,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logResponse(e){this[e.statusCode>=500?"error":e.statusCode>=400?"warn":"info"]("HTTP Response",{requestId:e.requestId,statusCode:e.statusCode,statusText:e.statusText,duration:`${e.duration}ms`,...this.isDevelopment&&{headers:e.headers},...this.isDevelopment&&e.body&&{body:e.body}})}logQuery(e,t,r){this.debug("Database Query",{query:e,params:t,...r&&{duration:`${r}ms`}})}logCache(e,t,r){this.debug("Cache Operation",{operation:e,key:t,hit:r})}logEvent(e,t){this.info("Event Published",{event:e,...t&&{data:t}})}}let o=new s},12657:(e,t,r)=>{r.d(t,{qI:()=>o});class s{incrementCounter(e,t,r=1){let s=this.getMetricKey(e,t),o=this.counters.get(s);o?o.value+=r:this.counters.set(s,{name:e,value:r,labels:t})}recordHistogram(e,t,r){let s=this.getMetricKey(e,r),o=this.histograms.get(s)||[];o.push({name:e,value:t,labels:r}),o.length>1e3&&o.shift(),this.histograms.set(s,o)}setGauge(e,t,r){let s=this.getMetricKey(e,r);this.gauges.set(s,t)}getCounter(e,t){let r=this.getMetricKey(e,t);return this.counters.get(r)?.value||0}getHistogramStats(e,t){let r=this.getMetricKey(e,t),s=this.histograms.get(r)||[];if(0===s.length)return null;let o=s.map(e=>e.value),n=o.reduce((e,t)=>e+t,0);return{count:s.length,sum:n,min:Math.min(...o),max:Math.max(...o),avg:n/s.length}}exportPrometheus(){let e=[];for(let[t,r]of this.counters.entries()){let t=this.formatLabels(r.labels);e.push(`# TYPE ${r.name} counter`),e.push(`${r.name}${t} ${r.value}`)}for(let[t,r]of this.histograms.entries()){if(0===r.length)continue;let t=this.formatLabels(r[0].labels),s=this.getHistogramStats(r[0].name,r[0].labels);s&&(e.push(`# TYPE ${r[0].name} histogram`),e.push(`${r[0].name}_count${t} ${s.count}`),e.push(`${r[0].name}_sum${t} ${s.sum}`),e.push(`${r[0].name}_min${t} ${s.min}`),e.push(`${r[0].name}_max${t} ${s.max}`),e.push(`${r[0].name}_avg${t} ${s.avg}`))}for(let[t,r]of this.gauges.entries()){let s=t.split("{")[0],o=t.includes("{")?`{${t.split("{")[1]}`:"";e.push(`# TYPE ${s} gauge`),e.push(`${s}${o} ${r}`)}return e.join("\n")+"\n"}reset(){this.counters.clear(),this.histograms.clear(),this.gauges.clear()}getMetricKey(e,t){if(!t||0===Object.keys(t).length)return e;let r=Object.entries(t).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}="${t}"`).join(",");return`${e}{${r}}`}formatLabels(e){if(!e||0===Object.keys(e).length)return"";let t=Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}="${t}"`).join(",");return`{${t}}`}constructor(){this.counters=new Map,this.histograms=new Map,this.gauges=new Map}}let o=new s}};