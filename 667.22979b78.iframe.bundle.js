"use strict";(self.webpackChunklumines_wissil=self.webpackChunklumines_wissil||[]).push([[667],{"./src/design-system/primitives/Button.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>Button});var _home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_extends_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/extends.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_themes_ThemeProvider__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/design-system/themes/ThemeProvider.tsx"),_excluded=["variant","style"],__jsx=react__WEBPACK_IMPORTED_MODULE_3__.createElement;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_1__.A)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Button(_ref){var _ref$variant=_ref.variant,variant=void 0===_ref$variant?"default":_ref$variant,style=_ref.style,props=(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__.A)(_ref,_excluded),theme=(0,_themes_ThemeProvider__WEBPACK_IMPORTED_MODULE_4__.D)(),bg=theme.colors.bg1,color=theme.colors.text0,border=theme.colors.border;return"accent"===variant?(bg="var(--nv-accent-button, #4c5eff)",color="#fff"):"ghost"===variant&&(bg="transparent",border="transparent"),__jsx("button",(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_extends_js__WEBPACK_IMPORTED_MODULE_0__.A)({},props,{style:_objectSpread({padding:"".concat(theme.spacing.sm," ").concat(theme.spacing.md),borderRadius:theme.radii.md,background:bg,color,border:"1px solid ".concat(border),fontFamily:theme.typography.font,fontSize:theme.typography.size.md,cursor:"pointer",transition:"background 0.15s ease"},style)}))}Button.displayName="Button";try{Button.displayName="Button",Button.__docgenInfo={description:"",displayName:"Button",props:{variant:{defaultValue:{value:"default"},description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"default"'},{value:'"accent"'},{value:'"ghost"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/design-system/primitives/Button.tsx#Button"]={docgenInfo:Button.__docgenInfo,name:"Button",path:"src/design-system/primitives/Button.tsx#Button"})}catch(__react_docgen_typescript_loader_error){}},"./src/state/editorState.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>useEditorState});var _home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var useEditorState=(0,__webpack_require__("./node_modules/zustand/esm/index.mjs").vt)(function(set){return{files:{},activeFile:null,openFiles:[],selectedFiles:[],selectedFile:null,buildStatus:"idle",cursorLine:1,cursorCol:1,runtimeMessages:[],runtimeError:null,setFiles:function setFiles(files){var editorFiles={};Object.entries(files).forEach(function(_ref){var _ref2=(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_2__.A)(_ref,2),path=_ref2[0],file=_ref2[1],content="string"==typeof file?file:"code"in file?file.code:"";editorFiles[path]={path,content,isDirty:!1}}),set({files:editorFiles})},openFile:function openFile(path){return set(function(state){return state.openFiles.includes(path)?state:{openFiles:[].concat((0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__.A)(state.openFiles),[path]),activeFile:path}})},closeFile:function closeFile(path){return set(function(state){return{openFiles:state.openFiles.filter(function(p){return p!==path}),activeFile:state.activeFile===path?state.openFiles[state.openFiles.length-2]||null:state.activeFile}})},updateFile:function updateFile(path,content){return set(function(state){return{files:_objectSpread(_objectSpread({},state.files),{},(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)({},path,_objectSpread(_objectSpread({},state.files[path]),{},{content,isDirty:!0})))}})},createFile:function createFile(path,content){return set(function(state){return{files:_objectSpread(_objectSpread({},state.files),{},(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)({},path,{path,content,isDirty:!1})),openFiles:[].concat((0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__.A)(state.openFiles),[path]),activeFile:path}})},deleteFile:function deleteFile(path){return set(function(state){var newFiles=_objectSpread({},state.files);return delete newFiles[path],{files:newFiles,openFiles:state.openFiles.filter(function(p){return p!==path}),activeFile:state.activeFile===path?null:state.activeFile}})},setActiveFile:function setActiveFile(path){return set(function(state){return{activeFile:path,openFiles:state.openFiles.includes(path)?state.openFiles:[].concat((0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__.A)(state.openFiles),[path])}})},selectFiles:function selectFiles(paths){return set({selectedFiles:paths})},setSelectedFile:function setSelectedFile(path){return set({selectedFile:path})},setBuildStatus:function setBuildStatus(status){return set({buildStatus:status})},setCursorPosition:function setCursorPosition(line,col){return set({cursorLine:line,cursorCol:col})},pushMessage:function pushMessage(msg){return set(function(s){return{runtimeMessages:[].concat((0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__.A)(s.runtimeMessages),[msg])}})},setRuntimeError:function setRuntimeError(msg){return set({runtimeError:msg})},markDirty:function markDirty(path,isDirty){return set(function(state){return{files:_objectSpread(_objectSpread({},state.files),{},(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)({},path,_objectSpread(_objectSpread({},state.files[path]),{},{isDirty})))}})}}})},"./src/wissil/IgnisWebGL/unityBridge.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>UnityBridge});var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),loaderLoaded=!1,loaderPromise=null;function loadUnityLoader(buildUrl){return loaderPromise||(loaderLoaded&&window.createUnityInstance?Promise.resolve():loaderPromise=new Promise(function(resolve,reject){var loaderPaths=["".concat(buildUrl,"/Build/build.loader.js"),"".concat(buildUrl,"/Build/Build.loader.js"),"".concat(buildUrl,"/Build/UnityLoader.js"),"".concat(buildUrl,"/Build/[ProjectName].loader.js")],maxAttempts=loaderPaths.length,_tryLoad=function tryLoad(index){if(index>=maxAttempts)return reject(new Error("Failed to load Unity loader. Tried ".concat(maxAttempts," paths."))),void(loaderPromise=null);var script=document.createElement("script");script.src=loaderPaths[index],script.onload=function(){loaderLoaded=!0,loaderPromise=null,window.createUnityInstance?resolve():_tryLoad(index+1)},script.onerror=function(){_tryLoad(index+1)},document.head.appendChild(script)};_tryLoad(0)}))}var console=__webpack_require__("./node_modules/console-browserify/index.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,defineProperty.A)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var UnityBridge=function(){return(0,createClass.A)(function UnityBridge(){(0,classCallCheck.A)(this,UnityBridge)},null,[{key:"loadInto",value:(_loadInto=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee2(container,buildUrl,config){var createUnityInstance,defaultConfig,finalConfig,_t2,_this=this;return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(this.instance){try{"function"==typeof this.instance.Quit&&this.instance.Quit()}catch(err){console.warn("Error quitting Unity instance:",err)}this.instance=null}return this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),container.innerHTML="",this.canvas=document.createElement("canvas"),this.canvas.id="unity-canvas",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",container.appendChild(this.canvas),this.buildUrl=buildUrl,_context2.next=1,loadUnityLoader(buildUrl);case 1:if(createUnityInstance=window.createUnityInstance){_context2.next=2;break}throw new Error("Unity loader did not register createUnityInstance. Make sure the loader script loaded correctly.");case 2:return defaultConfig={dataUrl:"".concat(buildUrl,"/Build/build.data"),frameworkUrl:"".concat(buildUrl,"/Build/build.framework.js"),codeUrl:"".concat(buildUrl,"/Build/build.wasm"),streamingAssetsUrl:"".concat(buildUrl,"/StreamingAssets"),companyName:"WISSIL",productName:"Unity WebGL Build",productVersion:"1.0.0"},finalConfig=_objectSpread(_objectSpread({},defaultConfig),config),_context2.prev=3,_context2.next=4,createUnityInstance(this.canvas,finalConfig);case 4:return this.instance=_context2.sent,"undefined"!=typeof window&&setTimeout((0,asyncToGenerator.A)(regenerator_default().mark(function _callee(){var _t;return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=1,__webpack_require__.e(9559).then(__webpack_require__.bind(__webpack_require__,"./src/wissil/runtime/unityBridge/UnityMessagingBus.ts"));case 1:return _context.sent.UnityMessagingBus.setUnityInstance(_this.instance),_context.next=2,__webpack_require__.e(1189).then(__webpack_require__.bind(__webpack_require__,"./src/wissil/runtime/unityBridge/RuntimeEvents.ts"));case 2:(0,_context.sent.setupUnityEventListeners)(),_context.next=4;break;case 3:_context.prev=3,_t=_context.catch(0),console.warn("[UnityBridge] Failed to set up messaging bus:",_t);case 4:case"end":return _context.stop()}},_callee,null,[[0,3]])})),0),_context2.abrupt("return",this.instance);case 5:throw _context2.prev=5,_t2=_context2.catch(3),this.instance=null,this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),_t2;case 6:case"end":return _context2.stop()}},_callee2,this,[[3,5]])})),function loadInto(_x,_x2,_x3){return _loadInto.apply(this,arguments)})},{key:"postMessageToUnity",value:function postMessageToUnity(gameObject,method,message){if(this.instance)try{var messageStr="string"==typeof message?message:JSON.stringify(message);"function"==typeof this.instance.SendMessage?this.instance.SendMessage(gameObject,method,messageStr):console.warn("Unity instance does not support SendMessage")}catch(err){console.error("Error sending message to Unity:",err)}else console.warn("Unity instance not loaded. Cannot send message.")}},{key:"getInstance",value:function getInstance(){return this.instance}},{key:"isLoaded",value:function isLoaded(){return null!==this.instance}},{key:"destroy",value:function destroy(){if("undefined"!=typeof window&&Promise.all([__webpack_require__.e(9559).then(__webpack_require__.bind(__webpack_require__,"./src/wissil/runtime/unityBridge/UnityMessagingBus.ts")).then(function(_ref2){_ref2.UnityMessagingBus.reset()}).catch(function(){}),__webpack_require__.e(1189).then(__webpack_require__.bind(__webpack_require__,"./src/wissil/runtime/unityBridge/RuntimeEvents.ts")).then(function(_ref3){(0,_ref3.cleanupUnityEventListeners)()}).catch(function(){})]).catch(function(){}),this.instance){try{"function"==typeof this.instance.Quit&&this.instance.Quit()}catch(err){console.warn("Error quitting Unity instance:",err)}this.instance=null}this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.buildUrl=null}},{key:"getBuildUrl",value:function getBuildUrl(){return this.buildUrl}}]);var _loadInto}();(0,defineProperty.A)(UnityBridge,"instance",null),(0,defineProperty.A)(UnityBridge,"canvas",null),(0,defineProperty.A)(UnityBridge,"buildUrl",null)},"./src/wissil/runtime/fs/pathUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function splitPath(path){return path.replace(/^\//,"").split("/").filter(Boolean)}function normalizePath(path){var _step,resolved=[],_iterator=_createForOfIteratorHelper(splitPath(path));try{for(_iterator.s();!(_step=_iterator.n()).done;){var part=_step.value;"."!==part&&(".."===part?resolved.pop():resolved.push(part))}}catch(err){_iterator.e(err)}finally{_iterator.f()}return resolved.join("/")}function joinPath(){for(var _len=arguments.length,segments=new Array(_len),_key=0;_key<_len;_key++)segments[_key]=arguments[_key];return segments.filter(Boolean).join("/").replace(/\/+/g,"/")}__webpack_require__.d(__webpack_exports__,{Fd:()=>normalizePath,Uf:()=>splitPath,uJ:()=>joinPath})},"./src/wissil/runtime/fs/wissilFs.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>useWissilFS});var _home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toArray_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toArray.js"),_pathUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/wissil/runtime/fs/pathUtils.ts");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.A)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function ensureFolder(folder,parts){if(0===parts.length)return folder;var _parts=(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_toArray_js__WEBPACK_IMPORTED_MODULE_1__.A)(parts),head=_parts[0],rest=_arrayLikeToArray(_parts).slice(1);folder.children[head]||(folder.children[head]={type:"folder",children:{}});var next=folder.children[head];if("folder"!==next.type)throw new Error("Cannot create folder: ".concat(head," already exists as a file"));return ensureFolder(next,rest)}function navigateToFolder(root,parts){var _step,current=root,_iterator=_createForOfIteratorHelper(parts);try{for(_iterator.s();!(_step=_iterator.n()).done;){var part=_step.value;if("folder"!==current.type)return null;var next=current.children[part];if(!next||"folder"!==next.type)return null;current=next}}catch(err){_iterator.e(err)}finally{_iterator.f()}return"folder"===current.type?current:null}var useWissilFS=(0,__webpack_require__("./node_modules/zustand/esm/index.mjs").vt)(function(set,get){return{root:{type:"folder",children:{}},writeFile:function writeFile(path,content){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);if(0===parts.length)throw new Error("Cannot write to root path");var fileName=parts.pop();ensureFolder(get().root,parts).children[fileName]={type:"file",content},set({root:_objectSpread({},get().root)})},readFile:function readFile(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);if(0===parts.length)return null;var fileName=parts.pop(),folder=navigateToFolder(get().root,parts);if(!folder)return null;var node=folder.children[fileName];return node&&"file"===node.type?node.content:null},deleteFile:function deleteFile(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);if(0!==parts.length){var fileName=parts.pop(),folder=navigateToFolder(get().root,parts);folder&&(delete folder.children[fileName],set({root:_objectSpread({},get().root)}))}},exists:function exists(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);if(0===parts.length)return!0;var fileName=parts.pop(),folder=navigateToFolder(get().root,parts);return!!folder&&fileName in folder.children},createFolder:function createFolder(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);0!==parts.length&&(ensureFolder(get().root,parts),set({root:_objectSpread({},get().root)}))},deleteFolder:function deleteFolder(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path);if(0!==parts.length){var folderName=parts.pop(),parent=navigateToFolder(get().root,parts);if(parent){var folder=parent.children[folderName];folder&&"folder"===folder.type&&(delete parent.children[folderName],set({root:_objectSpread({},get().root)}))}}else set({root:{type:"folder",children:{}}})},listDirectory:function listDirectory(path){var parts=(0,_pathUtils__WEBPACK_IMPORTED_MODULE_2__.Uf)(path),folder=navigateToFolder(get().root,parts);return folder?Object.keys(folder.children):[]},getSnapshot:function getSnapshot(){return JSON.parse(JSON.stringify(get().root))},hydrate:function hydrate(tree){set({root:tree})},clear:function clear(){set({root:{type:"folder",children:{}}})}}})},"./src/wissil/runtime/ignition/ignitionController.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>IgnitionController});var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),wissilFs=__webpack_require__("./src/wissil/runtime/fs/wissilFs.ts"),pathUtils=__webpack_require__("./src/wissil/runtime/fs/pathUtils.ts"),importRegex=/import\s+(?:[^"']+from\s+)?["']([^"']+)["']/g,requireRegex=/require\s*\(\s*["']([^"']+)["']\s*\)/g;function buildDependencyGraph(entryFile){var fs=wissilFs.C.getState(),visited=new Set,graph={};var normalizedEntry=(0,pathUtils.Fd)(entryFile);return fs.exists(normalizedEntry)&&function dfs(file){var normalizedFile=(0,pathUtils.Fd)(file);if(!visited.has(normalizedFile)){visited.add(normalizedFile);var code=fs.readFile(normalizedFile);if(code){var match,deps=[];for(importRegex.lastIndex=0;null!==(match=importRegex.exec(code));){var resolved=resolveRelative(normalizedFile,match[1]);resolved&&deps.push(resolved)}for(requireRegex.lastIndex=0;null!==(match=requireRegex.exec(code));){var _resolved=resolveRelative(normalizedFile,match[1]);_resolved&&deps.push(_resolved)}graph[normalizedFile]=deps,deps.forEach(function(d){fs.exists(d)&&dfs(d)})}else graph[normalizedFile]=[]}}(normalizedEntry),graph}function resolveRelative(from,importPath){if(!importPath.startsWith(".")&&!importPath.startsWith("/"))return null;if(importPath.startsWith(".")){var base=from.split("/").slice(0,-1).join("/"),resolved=(0,pathUtils.uJ)(base,importPath);resolved=resolved.replace(/\.(js|ts|tsx|jsx)$/,"");for(var fs=wissilFs.C.getState(),_i=0,_extensions=["",".ts",".tsx",".js",".jsx","/index.ts","/index.js"];_i<_extensions.length;_i++){var candidate=resolved+_extensions[_i];if(fs.exists(candidate))return(0,pathUtils.Fd)(candidate)}return(0,pathUtils.Fd)(resolved)}return importPath.startsWith("/")?(0,pathUtils.Fd)(importPath.slice(1)):null}function getDependencyOrder(graph){var visited=new Set,result=[];function visit(file){visited.has(file)||(visited.add(file),(graph[file]||[]).forEach(function(dep){graph[dep]&&visit(dep)}),result.push(file))}return Object.keys(graph).forEach(function(file){return visit(file)}),result}var browser=__webpack_require__("./node_modules/esbuild-wasm/lib/browser.js"),console=__webpack_require__("./node_modules/console-browserify/index.js"),initialized=!1,initPromise=null;function initEsbuild(){return _initEsbuild.apply(this,arguments)}function _initEsbuild(){return(_initEsbuild=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee2(){return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!initialized){_context2.next=1;break}return _context2.abrupt("return");case 1:if(!initPromise){_context2.next=2;break}return _context2.abrupt("return",initPromise);case 2:return initPromise=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee(){var _t;return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=1,browser.initialize({wasmURL:"https://unpkg.com/esbuild-wasm@0.19.12/esbuild.wasm"});case 1:initialized=!0,_context.next=3;break;case 2:throw _context.prev=2,_t=_context.catch(0),console.error("Failed to initialize esbuild:",_t),_t;case 3:case"end":return _context.stop()}},_callee,null,[[0,2]])}))(),_context2.abrupt("return",initPromise);case 3:case"end":return _context2.stop()}},_callee2)}))).apply(this,arguments)}function getLoader(path){return path.endsWith(".tsx")?"tsx":path.endsWith(".ts")?"ts":path.endsWith(".jsx")?"jsx":path.endsWith(".js")?"js":path.endsWith(".json")?"json":path.endsWith(".css")?"css":"ts"}function transformFile(_x){return _transformFile.apply(this,arguments)}function _transformFile(){return(_transformFile=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee3(path){var fs,code,loader,result,error,_t2;return regenerator_default().wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(fs=wissilFs.C.getState(),code=fs.readFile(path)){_context3.next=1;break}return _context3.abrupt("return",{code:""});case 1:return loader=getLoader(path),_context3.prev=2,_context3.next=3,browser.transform(code,{loader,format:"esm",target:"es2020",sourcemap:!1,jsx:"tsx"===loader||"jsx"===loader?"automatic":void 0});case 3:return result=_context3.sent,_context3.abrupt("return",{code:result.code,map:result.map});case 4:throw _context3.prev=4,_t2=_context3.catch(2),(error=_t2).file=path,error;case 5:case"end":return _context3.stop()}},_callee3,null,[[2,4]])}))).apply(this,arguments)}function transformFiles(_x2){return _transformFiles.apply(this,arguments)}function _transformFiles(){return _transformFiles=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee5(paths){var results,transformed;return regenerator_default().wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=1,initEsbuild();case 1:return _context5.next=2,Promise.all(paths.map(function(){var _ref2=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee4(path){var _yield$transformFile,code;return regenerator_default().wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=1,transformFile(path);case 1:return _yield$transformFile=_context4.sent,code=_yield$transformFile.code,_context4.abrupt("return",{path,code});case 2:throw _context4.prev=2,_context4.catch(0);case 3:case"end":return _context4.stop()}},_callee4,null,[[0,2]])}));return function(_x3){return _ref2.apply(this,arguments)}}()));case 2:return results=_context5.sent,transformed={},results.forEach(function(_ref3){var path=_ref3.path,code=_ref3.code;transformed[path]=code}),_context5.abrupt("return",transformed);case 3:case"end":return _context5.stop()}},_callee5)})),_transformFiles.apply(this,arguments)}function formatBuildError(err){return err?err.errors&&Array.isArray(err.errors)?err.errors.map(function(e){var location=e.location;return location?"".concat(e.text,"\n  at ").concat(location.file,":").concat(location.line,":").concat(location.column):e.text}).join("\n\n"):err.message?err.message:String(err):"Unknown build error"}var editorState=__webpack_require__("./src/state/editorState.ts");function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function wissilBuild(_x){return _wissilBuild.apply(this,arguments)}function _wissilBuild(){return(_wissilBuild=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee(entry){var setBuildStatus,setRuntimeError,pushMessage,graph,orderedFiles,transformed,bundle,_iterator,_step,file,code,errorMessage,_t;return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return setBuildStatus=editorState.e.getState().setBuildStatus,setRuntimeError=editorState.e.getState().setRuntimeError,pushMessage=editorState.e.getState().pushMessage,_context.prev=1,setBuildStatus("running"),pushMessage("[Build] Starting build for entry: ".concat(entry)),_context.next=2,initEsbuild();case 2:if(pushMessage("[Build] esbuild initialized"),graph=buildDependencyGraph(entry),pushMessage("[Build] Dependency graph built: ".concat(Object.keys(graph).length," files")),0!==Object.keys(graph).length){_context.next=3;break}throw new Error("No files found for entry: ".concat(entry));case 3:return orderedFiles=getDependencyOrder(graph),pushMessage("[Build] Transforming ".concat(orderedFiles.length," files...")),_context.next=4,transformFiles(orderedFiles);case 4:transformed=_context.sent,pushMessage("[Build] All files transformed successfully"),bundle="// WISSIL Build Output\n// Entry: ".concat(entry,"\n// Files: ").concat(orderedFiles.length,"\n\n"),_iterator=_createForOfIteratorHelper(orderedFiles);try{for(_iterator.s();!(_step=_iterator.n()).done;)file=_step.value,code=transformed[file]||"",bundle+="// ===== FILE: ".concat(file," =====\n"),bundle+="(function() {\n",bundle+=code,bundle+="\n})();\n\n"}catch(err){_iterator.e(err)}finally{_iterator.f()}return setBuildStatus("idle"),pushMessage("[Build] Build completed successfully"),_context.abrupt("return",{bundle,graph,transformed,success:!0});case 5:return _context.prev=5,_t=_context.catch(1),errorMessage=formatBuildError(_t),setBuildStatus("error"),setRuntimeError(errorMessage),pushMessage("[Build] Build failed: ".concat(errorMessage)),_context.abrupt("return",{bundle:"",graph:{},transformed:{},success:!1,error:errorMessage});case 6:case"end":return _context.stop()}},_callee,null,[[1,5]])}))).apply(this,arguments)}var messageBus_console=__webpack_require__("./node_modules/console-browserify/index.js"),handlers=new Set;"undefined"!=typeof window&&window.addEventListener("message",function(event){var data=event.data;data&&data.wissil&&"string"==typeof data.type&&"string"==typeof data.payload&&handlers.forEach(function(handler){try{handler(data)}catch(err){messageBus_console.error("Error in sandbox message handler:",err)}})});var sandboxManager_console=__webpack_require__("./node_modules/console-browserify/index.js"),iframe=null,isReady=!1;function createSandbox(){return iframe&&iframe.isConnected||(iframe&&(iframe.remove(),iframe=null),(iframe=document.createElement("iframe")).sandbox.add("allow-scripts"),iframe.src="/wissil-sandbox.html",iframe.style.display="none",iframe.style.width="0",iframe.style.height="0",iframe.style.border="none",iframe.onload=function(){isReady=!0},document.body.appendChild(iframe)),iframe}function resetSandbox(){if(iframe){isReady=!1;try{iframe.contentWindow&&iframe.contentWindow.postMessage({wissil:!0,type:"reset"},"*")}catch(err){sandboxManager_console.error("Error resetting sandbox:",err)}iframe.remove(),iframe=null,createSandbox()}}function executeBundle(bundle){createSandbox();var _waitForReady=function waitForReady(){if(iframe&&isReady)try{iframe.contentWindow&&iframe.contentWindow.postMessage({wissil:!0,type:"execute",bundle},"*")}catch(err){sandboxManager_console.error("Error executing bundle:",err),(0,editorState.e.getState().setRuntimeError)("Sandbox execution error: ".concat(err))}else setTimeout(_waitForReady,100)};_waitForReady()}!function addSandboxHandler(handler){handlers.add(handler)}(function(msg){var _useEditorState$getSt2=editorState.e.getState(),pushMessage=_useEditorState$getSt2.pushMessage,setRuntimeError=_useEditorState$getSt2.setRuntimeError;switch(msg.type){case"log":pushMessage("[Runtime] ".concat(msg.payload));break;case"warn":pushMessage("⚠️ [Runtime] ".concat(msg.payload));break;case"error":case"runtime-error":setRuntimeError(msg.payload),pushMessage("❌ [Runtime Error] ".concat(msg.payload));break;case"ready":"Sandbox initialized"===msg.payload?pushMessage("✓ Sandbox ready"):pushMessage("✓ ".concat(msg.payload))}});var unityBridge=__webpack_require__("./src/wissil/IgnisWebGL/unityBridge.ts"),IgnitionController=function(){return(0,createClass.A)(function IgnitionController(){(0,classCallCheck.A)(this,IgnitionController)},null,[{key:"run",value:(_run=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee(){var entry,state,result,_t,_args=arguments;return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return entry=_args.length>0&&void 0!==_args[0]?_args[0]:"src/main.ts",(state=editorState.e.getState()).setBuildStatus("running"),state.setRuntimeError(null),state.runtimeMessages=[],state.pushMessage("[Ignition] Starting build for ".concat(entry,"...")),_context.prev=1,_context.next=2,wissilBuild(entry);case 2:if((result=_context.sent).success&&result.bundle&&""!==result.bundle.trim()){_context.next=3;break}return state.setBuildStatus("error"),state.setRuntimeError(result.error||"Build produced an empty bundle."),_context.abrupt("return");case 3:state.setBuildStatus("idle"),state.pushMessage("[Ignition] Build successful, executing..."),executeBundle(result.bundle),_context.next=5;break;case 4:_context.prev=4,_t=_context.catch(1),state.setBuildStatus("error"),state.setRuntimeError((null==_t?void 0:_t.message)||String(_t)),state.pushMessage("[Ignition] Build failed: ".concat((null==_t?void 0:_t.message)||String(_t)));case 5:case"end":return _context.stop()}},_callee,null,[[1,4]])})),function run(){return _run.apply(this,arguments)})},{key:"restart",value:(_restart=(0,asyncToGenerator.A)(regenerator_default().mark(function _callee2(){var entry,state,result,_t2,_args2=arguments;return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return entry=_args2.length>0&&void 0!==_args2[0]?_args2[0]:"src/main.ts",(state=editorState.e.getState()).setBuildStatus("running"),state.setRuntimeError(null),state.runtimeMessages=[],state.pushMessage("[Ignition] Restarting runtime..."),unityBridge.D.destroy(),resetSandbox(),_context2.next=1,new Promise(function(resolve){return setTimeout(resolve,200)});case 1:return _context2.prev=1,_context2.next=2,wissilBuild(entry);case 2:if((result=_context2.sent).success&&result.bundle&&""!==result.bundle.trim()){_context2.next=3;break}return state.setBuildStatus("error"),state.setRuntimeError(result.error||"Restart build error."),_context2.abrupt("return");case 3:state.setBuildStatus("idle"),state.pushMessage("[Ignition] Restart complete, executing..."),executeBundle(result.bundle),_context2.next=5;break;case 4:_context2.prev=4,_t2=_context2.catch(1),state.setBuildStatus("error"),state.setRuntimeError((null==_t2?void 0:_t2.message)||String(_t2)),state.pushMessage("[Ignition] Restart failed: ".concat((null==_t2?void 0:_t2.message)||String(_t2)));case 5:case"end":return _context2.stop()}},_callee2,null,[[1,4]])})),function restart(){return _restart.apply(this,arguments)})},{key:"stop",value:function stop(){var state=editorState.e.getState();state.setBuildStatus("idle"),state.setRuntimeError(null),state.runtimeMessages=[],state.pushMessage("[Ignition] Runtime stopped"),unityBridge.D.destroy(),resetSandbox()}},{key:"clearLogs",value:function clearLogs(){editorState.e.getState().runtimeMessages=[]}}]);var _restart,_run}()}}]);