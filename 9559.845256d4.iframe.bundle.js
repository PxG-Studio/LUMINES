"use strict";(self.webpackChunklumines_wissil=self.webpackChunklumines_wissil||[]).push([[9559],{"./src/wissil/runtime/unityBridge/UnityMessagingBus.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UnityMessagingBus:()=>UnityMessagingBus});var _home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),console=__webpack_require__("./node_modules/console-browserify/index.js"),UnityMessagingBus=function(){return(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_1__.A)(function UnityMessagingBus(){(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_0__.A)(this,UnityMessagingBus)},null,[{key:"setUnityInstance",value:function setUnityInstance(instance){this.unityInstance=instance,window.UnityBridge={receive:this.receive.bind(this)},this.processQueue()}},{key:"getUnityInstance",value:function getUnityInstance(){return this.unityInstance}},{key:"isConnected",value:function isConnected(){return null!==this.unityInstance}},{key:"receive",value:function receive(message){var parsed;if("string"==typeof message)try{parsed=JSON.parse(message)}catch(err){return void console.error("[UnityBridge] Failed to parse message:",err)}else parsed=message;parsed.type?(parsed.timestamp=parsed.timestamp||Date.now(),(this.listeners[parsed.type]||[]).forEach(function(fn){try{fn(parsed.payload||{},parsed)}catch(err){console.error("[UnityBridge] Listener error for ".concat(parsed.type,":"),err)}}),(this.listeners["*"]||[]).forEach(function(fn){try{fn(parsed.payload||{},parsed)}catch(err){console.error("[UnityBridge] Wildcard listener error:",err)}})):console.warn("[UnityBridge] Message missing type:",parsed)}},{key:"send",value:function send(type,payload){if(!this.unityInstance)return this.messageQueue.push({type,payload,timestamp:Date.now()}),console.warn("[UnityBridge] Unity not loaded, queued message: ".concat(type)),!1;var message={type,payload,timestamp:Date.now()};try{return"function"==typeof this.unityInstance.SendMessage?(this.unityInstance.SendMessage("JSBridge","ReceiveMessage",JSON.stringify(message)),!0):(console.warn("[UnityBridge] Unity instance does not support SendMessage"),!1)}catch(err){return console.error("[UnityBridge] Error sending message ".concat(type,":"),err),!1}}},{key:"on",value:function on(type,listener){var _this=this;return this.listeners[type]||(this.listeners[type]=[]),this.listeners[type].push(listener),function(){var _this$listeners$type,index=null===(_this$listeners$type=_this.listeners[type])||void 0===_this$listeners$type?void 0:_this$listeners$type.indexOf(listener);void 0!==index&&index>=0&&_this.listeners[type].splice(index,1)}}},{key:"off",value:function off(type,listener){if(this.listeners[type]){var index=this.listeners[type].indexOf(listener);index>=0&&this.listeners[type].splice(index,1)}}},{key:"removeAllListeners",value:function removeAllListeners(type){type?delete this.listeners[type]:this.listeners={}}},{key:"processQueue",value:function processQueue(){for(;this.messageQueue.length>0&&this.unityInstance;){var _message=this.messageQueue.shift();_message&&this.send(_message.type,_message.payload)}}},{key:"reset",value:function reset(){this.unityInstance=null,this.listeners={},this.messageQueue=[],delete window.UnityBridge}}])}();(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(UnityMessagingBus,"unityInstance",null),(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(UnityMessagingBus,"listeners",{}),(0,_home_runner_work_LUMINES_LUMINES_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.A)(UnityMessagingBus,"messageQueue",[])}}]);