import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import { BPGraphCanvas } from '@/ignis/blueprint/canvas/BPGraphCanvas';
import { NodeRenderer } from '@/ignis/blueprint/canvas/NodeRenderer';
import { NodePalette } from '@/ignis/blueprint/palette/NodePalette';

<Meta
  title="Lumenforge.io Design System/WIS2L Framework/Ignis/Documentation/Blueprint Editor"
  id="wis2l-ignis-blueprint-docs-stories"
  name="Blueprint Editor WIS2L Docs"
/>

# Blueprint Editor

The **Blueprint Editor** is the visual scripting environment for WISSIL, equivalent to Unreal Engine Blueprints or Unity Visual Scripting.

It runs fully in-browser, supports drag-and-drop nodes, wires, panning, zooming, execution preview, and code generation.

## Overview

The Ignis Blueprint Editor provides a complete visual scripting solution for game development, allowing developers to create game logic without writing code directly. It features:

- **Node-based visual programming** - Drag and drop nodes to create logic flows
- **Real-time execution** - Execute and debug blueprints in the browser
- **Unity integration** - Direct connection to Unity WebGL runtime
- **Code generation** - Automatically generate Unity C# scripts
- **AI assistance** - LUNA-powered graph generation and optimization

## Components

### `BPGraphCanvas`

The main canvas container for an entire node graph. Supports panning, zooming, node dragging, wire connections, and multi-selection.

**Features:**
- Pan with middle mouse or Shift+Left click
- Zoom with mouse wheel
- Drag nodes to reposition
- Connect nodes by clicking sockets
- Multi-select with Shift+Click
- Keyboard shortcuts (Delete, Ctrl+D to duplicate)

<Canvas>
  <Story name="Canvas">
    {() => <BPGraphCanvas />}
  </Story>
</Canvas>

### `NodeRenderer`

Renders individual nodes, including title bar, sockets, and data fields.

**Features:**
- Color-coded by category
- Draggable with snap-to-grid
- Socket connections (input/output)
- Type-safe socket connections
- Visual feedback on hover and selection

<Canvas>
  <Story name="NodeRenderer">
    {() => (
      <div style={{ position: "relative", width: 400, height: 300 }}>
        <NodeRenderer
          node={{
            id: "test",
            type: "Print",
            nodeType: "exec",
            title: "Print",
            position: { x: 50, y: 50 },
            inputs: [
              {
                id: "exec_in",
                name: "Exec",
                type: "exec",
                direction: "input"
              },
              {
                id: "message_in",
                name: "Message",
                type: "string",
                direction: "input",
                required: true
              }
            ],
            outputs: [
              {
                id: "exec_out",
                name: "Exec",
                type: "exec",
                direction: "output"
              }
            ],
            data: { message: "Hello World" }
          }}
        />
      </div>
    )}
  </Story>
</Canvas>

### `NodePalette`

Searchable menu for discovering and adding nodes to the canvas.

**Features:**
- Search nodes by name or category
- Filter by category
- Node descriptions and icons
- One-click node creation

<Canvas>
  <Story name="NodePalette">
    {() => (
      <div style={{ width: 300, height: 500 }}>
        <NodePalette onSelectNode={(type) => console.log("Selected:", type)} />
      </div>
    )}
  </Story>
</Canvas>

## Node Types

### Flow Control Nodes

- **Branch** - Conditional execution based on boolean value
- **Delay** - Wait for specified duration
- **Sequence** - Execute multiple outputs in sequence

### Math Nodes

- **Add** - Add two numbers
- **Subtract** - Subtract two numbers
- **Multiply** - Multiply two numbers
- **Divide** - Divide two numbers

### Unity API Nodes

- **GetPosition** - Get GameObject position
- **SetPosition** - Set GameObject position
- **PlaySound** - Play audio clip
- **SpawnPrefab** - Instantiate prefab
- **DestroyObject** - Destroy GameObject

### Event Nodes

- **Start** - Called when script starts
- **Update** - Called every frame
- **OnTriggerEnter** - Called on collision enter

## Usage Example

```typescript
import { useBPGraphStore } from '@/ignis/blueprint/store/BPGraphStore';
import { NodeLibrary } from '@/ignis/blueprint/library/NodeLibrary';
import { BPInterpreter } from '@/ignis/blueprint/runtime/BPInterpreter';

// Create a new blueprint graph
const graphId = useBPGraphStore.getState().createGraph("My Blueprint");

// Add nodes
const startDef = NodeLibrary.get("Start");
const startNode = startDef.create();
startNode.id = "start1";
startNode.position = { x: 100, y: 100 };
useBPGraphStore.getState().addNode(graphId, startNode);

// Execute graph
const graph = useBPGraphStore.getState().getCurrentGraph();
const interpreter = new BPInterpreter(graph);
interpreter.execute();
```

## API Reference

<ArgsTable of={BPGraphCanvas} />

## Integration

The Blueprint Editor integrates with:

- **WISSIL File System** - Save/load blueprints as JSON files
- **Unity Runtime** - Execute blueprints in Unity WebGL
- **LUNA AI** - AI-assisted graph generation and optimization
- **Code Generator** - Export to Unity C# scripts
- **Ignition** - Runtime execution and debugging

## Next Steps

- Explore the [Node Library](/ignis/blueprint/node-library)
- Learn about [Runtime Execution](/ignis/blueprint/runtime)
- See [Unity Integration](/ignis/blueprint/unity-integration)

