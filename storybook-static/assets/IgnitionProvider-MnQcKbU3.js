import{u as g,j as i,r as x}from"./iframe-BXkX_8oL.js";import{B as f}from"./Button-CDJro0XR.js";import{u as o}from"./editorState-BZUma5kk.js";import{I as u}from"./ignitionController-DqNioivO.js";function h({className:t,style:r}){const e=g(),s=o(n=>n.buildStatus),a=s==="running"?e.colors.accent:s==="error"?e.colors.error:e.colors.text2;return i.jsxs("div",{className:t,style:{display:"flex",alignItems:"center",gap:e.spacing.xs,fontSize:e.typography.size.sm,color:e.colors.text2,...r},children:[i.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:a,transition:"background 0.2s ease"}}),i.jsx("span",{children:s.toUpperCase()})]})}try{h.displayName="IgnitionStatusIndicator",h.__docgenInfo={description:"",displayName:"IgnitionStatusIndicator",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | undefined"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties | undefined"}}}}}catch{}const m=class m{static setUnityInstance(r){this.unityInstance=r,window.UnityBridge={receive:this.receive.bind(this)},this.processQueue()}static getUnityInstance(){return this.unityInstance}static isConnected(){return this.unityInstance!==null}static receive(r){let e;if(typeof r=="string")try{e=JSON.parse(r)}catch(n){console.error("[UnityBridge] Failed to parse message:",n);return}else e=r;if(!e.type){console.warn("[UnityBridge] Message missing type:",e);return}e.timestamp=e.timestamp||Date.now(),(this.listeners[e.type]||[]).forEach(n=>{try{n(e.payload||{},e)}catch(c){console.error(`[UnityBridge] Listener error for ${e.type}:`,c)}}),(this.listeners["*"]||[]).forEach(n=>{try{n(e.payload||{},e)}catch(c){console.error("[UnityBridge] Wildcard listener error:",c)}})}static send(r,e){if(!this.unityInstance)return this.messageQueue.push({type:r,payload:e,timestamp:Date.now()}),console.warn(`[UnityBridge] Unity not loaded, queued message: ${r}`),!1;const s={type:r,payload:e,timestamp:Date.now()};try{return typeof this.unityInstance.SendMessage=="function"?(this.unityInstance.SendMessage("JSBridge","ReceiveMessage",JSON.stringify(s)),!0):(console.warn("[UnityBridge] Unity instance does not support SendMessage"),!1)}catch(a){return console.error(`[UnityBridge] Error sending message ${r}:`,a),!1}}static on(r,e){return this.listeners[r]||(this.listeners[r]=[]),this.listeners[r].push(e),()=>{var a;const s=(a=this.listeners[r])==null?void 0:a.indexOf(e);s!==void 0&&s>=0&&this.listeners[r].splice(s,1)}}static off(r,e){if(!this.listeners[r])return;const s=this.listeners[r].indexOf(e);s>=0&&this.listeners[r].splice(s,1)}static removeAllListeners(r){r?delete this.listeners[r]:this.listeners={}}static processQueue(){for(;this.messageQueue.length>0&&this.unityInstance;){const r=this.messageQueue.shift();r&&this.send(r.type,r.payload)}}static reset(){this.unityInstance=null,this.listeners={},this.messageQueue=[],delete window.UnityBridge}};m.unityInstance=null,m.listeners={},m.messageQueue=[];let l=m;const y={run:t=>{var r;l.send("run",{}),(r=t==null?void 0:t.onSuccess)==null||r.call(t)},reload:t=>{var r;l.send("reload",{}),(r=t==null?void 0:t.onSuccess)==null||r.call(t)},stop:t=>{var r;l.send("stop",{}),(r=t==null?void 0:t.onSuccess)==null||r.call(t)},evaluate:(t,r)=>{var e;l.send("evaluate",{code:t}),(e=r==null?void 0:r.onSuccess)==null||e.call(r)},playAnimation:(t,r)=>{var e;l.send("playAnimation",{id:t}),(e=r==null?void 0:r.onSuccess)==null||e.call(r)},setValue:(t,r,e)=>{var s;l.send("setValue",{path:t,value:r}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)},call:(t,r,e)=>{var s;l.send("call",{method:t,args:r||[]}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)},setValues:(t,r)=>{var e;l.send("setValues",{values:t}),(e=r==null?void 0:r.onSuccess)==null||e.call(r)}};function S({onRun:t,onRestart:r,onStop:e,className:s,style:a}){const n=g();o(d=>d.setBuildStatus),o(d=>d.setRuntimeError);const c=o(d=>d.pushMessage),_=()=>{l.isConnected()?y.run({onSuccess:()=>c("[Unity] Runtime started via LiveCommand"),onError:d=>{c(`❌ [Unity] Run failed: ${d}`),t?t():u.run()}}):t?t():u.run()},w=()=>{l.isConnected()?y.reload({onSuccess:()=>c("[Unity] Runtime restarted via LiveCommand"),onError:d=>{c(`❌ [Unity] Restart failed: ${d}`),r?r():u.restart()}}):r?r():u.restart()},N=()=>{l.isConnected()&&y.stop({onSuccess:()=>c("[Unity] Runtime stopped via LiveCommand")}),e?e():u.stop()};return i.jsxs("div",{className:s,style:{display:"flex",gap:n.spacing.sm,alignItems:"center",marginLeft:"auto",marginRight:n.spacing.md,...a},children:[i.jsx(h,{}),i.jsx(f,{variant:"accent",onClick:_,style:{padding:"6px 12px",fontSize:n.typography.size.sm},children:"Run"}),i.jsx(f,{variant:"ghost",onClick:w,style:{padding:"6px 12px",fontSize:n.typography.size.sm},children:"Restart"}),i.jsx(f,{variant:"ghost",onClick:N,style:{padding:"6px 12px",fontSize:n.typography.size.sm},children:"Stop"})]})}try{S.displayName="IgnitionRuntimeBar",S.__docgenInfo={description:"",displayName:"IgnitionRuntimeBar",props:{onRun:{defaultValue:null,description:"",name:"onRun",required:!1,type:{name:"(() => void) | undefined"}},onRestart:{defaultValue:null,description:"",name:"onRestart",required:!1,type:{name:"(() => void) | undefined"}},onStop:{defaultValue:null,description:"",name:"onStop",required:!1,type:{name:"(() => void) | undefined"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | undefined"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties | undefined"}}}}}catch{}function p({className:t,style:r}){const e=g(),s=o(n=>n.runtimeError),a=o(n=>n.setRuntimeError);return s?i.jsxs("div",{className:t,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",color:e.colors.error,padding:e.spacing.xl,zIndex:9999,overflowY:"auto",display:"flex",flexDirection:"column",...r},onClick:()=>a(null),children:[i.jsx("h2",{style:{marginTop:0,marginBottom:e.spacing.lg,fontSize:e.typography.size.xl,color:e.colors.error,fontWeight:e.typography.weight.semibold},children:"Runtime Error"}),i.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:e.typography.size.md,fontFamily:"monospace",background:e.colors.bg1,padding:e.spacing.lg,borderRadius:e.radii.md,border:`1px solid ${e.colors.border}`,color:e.colors.text1,overflowX:"auto",flex:1},children:s}),i.jsx("div",{style:{opacity:.6,marginTop:e.spacing.lg,fontSize:e.typography.size.sm,color:e.colors.text2,textAlign:"center"},children:"(Click anywhere to dismiss)"})]}):null}try{p.displayName="IgnitionErrorOverlay",p.__docgenInfo={description:"",displayName:"IgnitionErrorOverlay",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | undefined"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties | undefined"}}}}}catch{}function I({className:t,style:r}){const e=g(),s=o(n=>n.runtimeMessages),a=x.useRef(null);return x.useEffect(()=>{const n=a.current;n&&(n.scrollTop=n.scrollHeight)},[s]),i.jsxs("div",{ref:a,className:t,style:{padding:e.spacing.sm,height:"100%",overflowY:"auto",overflowX:"hidden",...r},children:[s.length===0&&i.jsx("div",{style:{opacity:.7,color:e.colors.text1,fontSize:e.typography.size.sm},children:"No runtime logs — run a program to begin."}),s.map((n,c)=>i.jsx("pre",{style:{margin:0,marginBottom:e.spacing.xs,fontSize:e.typography.size.sm,color:e.colors.text1,fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n},c))]})}try{I.displayName="IgnitionMessageStream",I.__docgenInfo={description:"",displayName:"IgnitionMessageStream",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | undefined"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties | undefined"}}}}}catch{}function v({children:t}){return i.jsxs(i.Fragment,{children:[t,i.jsx(p,{})]})}try{v.displayName="IgnitionProvider",v.__docgenInfo={description:"",displayName:"IgnitionProvider",props:{}}}catch{}export{S as I,h as a,I as b,v as c,p as d};
